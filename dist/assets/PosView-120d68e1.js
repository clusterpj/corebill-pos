var fy=Object.defineProperty;var my=(s,u,o)=>u in s?fy(s,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[u]=o;var Io=(s,u,o)=>(my(s,typeof u!="symbol"?u+"":u,o),o);import{T as So,n as d,U as Hn,W as Tt,X as py,Y as Bi,Z as Bn,$ as St,_ as _t,a0 as xe,q as na,m as pe,Q as vy,N as Yt,I as lr,p as hn,j as ft,v as Ir,e as Ze,A as Rn,h as ht,w as wn,x as It,z as Vt,y as dr,a1 as ur,g as Te,a2 as ln,a3 as un,H as Nn,R as ji,t as Gu,G as Co,D as Hu,C as gy,F as Eo,a4 as Pa,a5 as yy,a6 as hy,l as sn,c as Ee,d as we,V as bn,a7 as _y,o as Ln,O as kr,a8 as Qi,a9 as _n,aa as wy,ab as Xi,M as by,ac as Iy,ad as Py,ae as Wi,af as Cy,i as xy,B as es,r as xa,ag as ts,ah as Ca,ai as Bu,s as Au,aj as Wu,b as Sy,ak as Oy,u as Ty,a as Dy,S as Ey,al as Ay}from"./index-cee48f53.js";import{w as Be,j as _e,L as B,bh as he,F as a,N as i,a8 as gt,bl as en,M as Se,bn as Gt,bk as y,bi as te,r as z,u as oe,be as q,bm as Ne,a as Sa,H as cr,aL as Ku,c4 as Ny,c5 as $y,a1 as Wn,c6 as Vy,bj as Rr,a6 as ns,a9 as Fy,T as Oo,bg as Yu,d as Pr,n as ky,c1 as Ry,c2 as Ly}from"./vuetify-3f7b308f.js";import{interpret as Uy,createMachine as My}from"xstate";const qt=[];for(let s=0;s<256;++s)qt.push((s+256).toString(16).slice(1));function zy(s,u=0){return(qt[s[u+0]]+qt[s[u+1]]+qt[s[u+2]]+qt[s[u+3]]+"-"+qt[s[u+4]]+qt[s[u+5]]+"-"+qt[s[u+6]]+qt[s[u+7]]+"-"+qt[s[u+8]]+qt[s[u+9]]+"-"+qt[s[u+10]]+qt[s[u+11]]+qt[s[u+12]]+qt[s[u+13]]+qt[s[u+14]]+qt[s[u+15]]).toLowerCase()}let Ki;const qy=new Uint8Array(16);function Gy(){if(!Ki){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ki=crypto.getRandomValues.bind(crypto)}return Ki(qy)}const Hy=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Nu={randomUUID:Hy};function By(s,u,o){if(Nu.randomUUID&&!u&&!s)return Nu.randomUUID();s=s||{};const v=s.random||(s.rng||Gy)();if(v[6]=v[6]&15|64,v[8]=v[8]&63|128,u){o=o||0;for(let m=0;m<16;++m)u[o+m]=v[m];return u}return zy(v)}const $u=s=>{if(!s||!s.id)throw new Error("Invalid hold order data");if(s.status==="inactive")throw new Error("Hold order is not active");if(!s.hold_items||!s.hold_items.length)throw new Error("Hold order has no items");if(s.paid_status||(s.paid_status=So.UNPAID,d.debug("Setting default paid_status:",s.paid_status)),s.type||(s.type=Hn.DINE_IN,d.debug("Setting default type:",s.type)),s.paid_status&&!Object.values(So).includes(s.paid_status))throw new Error("Invalid paid status. Must be either PAID or UNPAID");if(s.type&&!Object.values(Hn).includes(s.type))throw new Error("Invalid order type. Must be one of: DINE IN, TO-GO, DELIVERY, PICKUP");if(s.hold_items.reduce((o,v)=>o+Number(v.price)*Number(v.quantity),0)!==s.total)throw new Error("Hold order total mismatch")},ba=s=>{var u;return s&&((u=s.hold_invoices)!=null&&u.data?(s.hold_invoices.data=s.hold_invoices.data.map(o=>({...o,paid_status:o.paid_status||So.UNPAID,type:o.type||Hn.DINE_IN})),s):s.id?{...s,paid_status:s.paid_status||So.UNPAID,type:s.type||Hn.DINE_IN}:s)},Wy=()=>`pos_${Date.now()}_${By()}`,Xt=s=>{var o;const u={success:!1,message:s.message,errors:{}};if(s.response){switch(s.response.status){case 400:u.message="Invalid request parameters";break;case 401:u.message="Authentication required";break;case 404:u.message="Resource not found";break;case 422:u.message="Validation failed",u.errors=s.response.data.errors||{};break;case 500:u.message="Internal server error";break;default:u.message="An unexpected error occurred"}u.statusCode=s.response.status}throw d.error("API Error:",{message:u.message,status:(o=s.response)==null?void 0:o.status,errors:u.errors,originalError:s.message}),u},Ky={async getCompanySettings(){d.startGroup("POS Operations: Get Company Settings");try{const s=["invoice_auto_generate","invoice_issuance_period","payment_auto_generate","allow_invoice_form_pos","allow_partial_pay","pdf_format_pos"];d.debug("Requesting company settings with params:",{settings:s});const u=await Tt.get("company/settings",{params:{"settings[]":s}});return d.debug("Company settings response:",u.data),d.info("Company settings fetched successfully"),{success:!0,data:u.data}}catch(s){return Xt(s)}finally{d.endGroup()}},async getNextNumber(s){d.startGroup(`POS Operations: Get Next ${s} Number`);try{d.debug(`Requesting next ${s} number`);const u=await Tt.get("next-number",{params:{key:s}});if(!u.data.nextNumber||!u.data.prefix)throw new Error("Invalid next number response");return d.debug(`Next ${s} number response:`,u.data),d.info(`Next ${s} number fetched successfully`),{nextNumber:u.data.nextNumber,prefix:u.data.prefix}}catch(u){return Xt(u)}finally{d.endGroup()}},async getTables(s){var u,o;d.startGroup("POS Operations: Get Tables");try{if(!s)throw new Error("Cash register ID is required");d.debug("Requesting tables for cash register:",s);const v=localStorage.getItem("companyId"),m=`${py("pos.tables")}/${s}`,x={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json",Accept:"application/json",company:v}};d.debug("Tables request config:",{endpoint:m,config:x});const w=await Tt.get(m,x);if(!w.data)throw new Error("Invalid response structure");const p=Array.isArray(w.data)?w.data:w.data.data&&Array.isArray(w.data.data)?w.data.data:[];return d.debug("Tables response processed:",{rawResponse:w.data,processedTables:p,tableCount:p.length}),{success:!0,data:p.map(V=>({id:V.id,name:V.name||`Table ${V.id}`,is_occupied:!!V.is_occupied,quantity:V.quantity||0,items:V.items||0}))}}catch(v){return d.error("Failed to fetch tables",{error:v.message,response:(u=v.response)==null?void 0:u.data,status:(o=v.response)==null?void 0:o.status,cashRegisterId:s}),{success:!1,error:v.message,data:[]}}finally{d.endGroup()}}},Yy={async getHoldInvoices(){var s;d.startGroup("POS Operations: Get Hold Invoices");try{d.debug("Requesting hold invoices");const u=await Bi.holdInvoice.getAll();if(!u.data)throw new Error("Invalid hold invoices response");const o=ba(u.data);return(s=o.hold_invoices)!=null&&s.data&&o.hold_invoices.data.forEach(v=>{try{$u(v)}catch(m){d.warn(`Invalid hold order ${v.id}:`,m.message)}}),d.debug("Hold invoices response:",o),d.info("Hold invoices fetched successfully"),{success:!0,...o}}catch(u){return Xt(u)}finally{d.endGroup()}},async getHoldInvoice(s){var u,o;d.startGroup("POS Operations: Get Hold Invoice");try{if(!s)throw d.error("Invalid hold invoice ID:",s),new Error("Hold invoice ID is required");d.debug("Requesting hold invoice:",s);const v=await Bi.holdInvoice.getById(s);if(!(v!=null&&v.data))throw d.error("Empty response from hold invoice API:",v),new Error("Empty response from hold invoice API");const m=((u=v.data)==null?void 0:u.data)||((o=v.data)==null?void 0:o.hold_invoice)||v.data;if(!m||!m.id&&!m.hold_invoice_id)throw d.error("Invalid hold invoice response structure:",v.data),new Error("Invalid hold invoice response structure");const x=ba(m);if(!x.id&&!x.hold_invoice_id)throw d.error("Missing required ID fields after transform:",x),new Error("Missing required invoice ID fields");return d.debug("Hold invoice response:",x),d.info("Hold invoice fetched successfully"),x}catch(v){return Xt(v)}finally{d.endGroup()}},async updateHoldInvoice(s,u){d.startGroup("POS Operations: Update Hold Invoice");try{d.debug("Updating hold invoice:",{id:s,data:u});const o={...u,paid_status:u.paid_status||Bn.UNPAID,type:u.type||St.DINE_IN,is_hold_invoice:!0};if(o.paid_status&&!Object.values(Bn).includes(o.paid_status))throw new Error("Invalid paid_status. Must be either PAID or UNPAID");if(o.type&&!Object.values(St).includes(o.type))throw new Error("Invalid type. Must be one of: DINE IN, TO-GO, DELIVERY, PICKUP");const v=await Bi.holdInvoice.update(s,o);return d.debug("Hold invoice update response:",v),d.info("Hold invoice updated successfully:",{invoiceId:s,total:o.total,paid_status:o.paid_status,type:o.type}),{success:!0,data:ba(v.data)}}catch(o){return Xt(o)}finally{d.endGroup()}},async createInvoice(s){var u,o;d.startGroup("POS Operations: Create Invoice");try{d.debug("Creating invoice with data:",s);const v={...s,paid_status:s.paid_status||Bn.UNPAID,type:s.type||St.DINE_IN};if(v.paid_status&&!Object.values(Bn).includes(v.paid_status))throw new Error("Invalid paid_status. Must be either PAID or UNPAID");if(v.type&&!Object.values(St).includes(v.type))throw new Error("Invalid type. Must be one of: DINE IN, TO-GO, DELIVERY, PICKUP");if(v.hold_invoice_id&&!v.is_prepared_data){const x=await this.getHoldInvoice(v.hold_invoice_id);if(!x)throw new Error("Failed to fetch hold invoice");$u(x)}const m=await Tt.post("invoices",v);return d.debug("Invoice creation response:",m.data),d.info("Invoice created successfully:",{invoiceId:(u=m.data.invoice)==null?void 0:u.id,total:(o=m.data.invoice)==null?void 0:o.total,paid_status:v.paid_status,type:v.type}),{success:!0,...ba(m.data)}}catch(v){return Xt(v)}finally{d.endGroup()}},async getInvoice(s){var u;d.startGroup("POS Operations: Get Invoice");try{d.debug("Requesting invoice:",s);const o=await Tt.get(`invoices/${s}`);if(!((u=o.data)!=null&&u.invoice))throw new Error("Invalid invoice response");return d.debug("Invoice response:",o.data),d.info("Invoice fetched successfully"),{success:!0,...ba(o.data.invoice)}}catch(o){return Xt(o)}finally{d.endGroup()}}},To={async getPaymentMethods(){var s;d.startGroup("POS Operations: Get Payment Methods");try{d.debug("Requesting payment methods");const u=await Tt.post("payments/multiple/get-payment-methods");if(!((s=u.data)!=null&&s.payment_methods))throw new Error("Invalid payment methods response");return d.debug("Payment methods response:",u.data),d.info("Payment methods fetched successfully"),{success:!0,data:u.data.payment_methods}}catch(u){return Xt(u)}finally{d.endGroup()}},async createPayment(s){var u,o;d.startGroup("POS Operations: Create Payment");try{d.debug("Creating payment with data:",s);const v=Wy();d.debug("Generated idempotency key:",v);const m=await Tt.post("payments/multiple/create",s,{headers:{"Idempotency-Key":v}});return d.debug("Payment creation response:",m.data),d.info("Payment created successfully:",{paymentId:(u=m.data.payment)==null?void 0:u.id,amount:(o=m.data.payment)==null?void 0:o.amount}),{success:!0,...m.data}}catch(v){return Xt(v)}finally{d.endGroup()}},async getTerminalSettings(){var s;d.startGroup("POS Operations: Get Terminal Settings");try{const u=await Tt.get("/v2/ipos-pays/setting");if(!((s=u.data)!=null&&s.data))throw new Error("Invalid terminal settings response");return{success:!0,data:await Promise.all(u.data.data.map(async v=>{try{const m=await this.getDefaultTerminalSetting(v.id);return{...v,details:m.data}}catch(m){return d.warn(`Failed to get details for terminal ${v.id}`,m),v}}))}}catch(u){return Xt(u)}finally{d.endGroup()}},async getDefaultTerminalSetting(s){d.startGroup(`POS Operations: Get Default Terminal Setting for ${s}`);try{const u=await Tt.get(`/v2/ipos-pays/setting/${s}/default`);if(!u.data)throw new Error("Invalid terminal details response");return{success:!0,data:u.data}}catch(u){return Xt(u)}finally{d.endGroup()}},async processTerminalPayment(s,u){d.startGroup(`POS Operations: Process Terminal Payment for Setting ${s}`);try{if(!s)throw new Error("Missing terminal setting ID");const o=new AbortController,v=setTimeout(()=>o.abort(),3e4),m=await Tt.post(`/v2/ipos-pays/setting/${s}/sale`,u,{signal:o.signal});if(clearTimeout(v),!m.data)throw new Error("Invalid terminal payment response");if(m.data.success===!1){const x=m.data.message||"Terminal payment failed",w=m.data.details||{};throw d.error("Terminal payment failed:",{error:x,details:w,settingId:s,paymentData:u}),new Error(x)}return{success:!0,data:m.data}}catch(o){if(o.name==="AbortError")throw d.error("Terminal payment timeout:",{settingId:s,duration:"30s"}),new Error("Terminal payment timed out. Please check terminal connection and try again.");if(o.response){const v=o.response.status;if(v===401)throw new Error("Terminal authentication failed. Please check terminal credentials.");if(v===404)throw new Error("Terminal not found. Please check terminal configuration.");if(v===500)throw new Error("Terminal processing error. Please try again.")}throw d.error("Terminal payment error:",{error:o.message,settingId:s,paymentData:u}),o}finally{d.endGroup()}}},Jy={async getOrders(){d.startGroup("POS Operations: Get Orders");try{d.debug("Requesting orders");const s=await Tt.get("orders");if(!s.data)throw new Error("Invalid orders response");return d.debug("Orders response:",s.data),d.info("Orders fetched successfully"),{success:!0,data:Array.isArray(s.data)?s.data:s.data.data||[]}}catch(s){return Xt(s)}finally{d.endGroup()}},async getOrderById(s){d.startGroup("POS Operations: Get Order By ID");try{d.debug("Requesting order:",s);const u=await Tt.get(`orders/${s}`);if(!u.data)throw new Error("Invalid order response");return d.debug("Order response:",u.data),d.info("Order fetched successfully"),{success:!0,data:u.data}}catch(u){return Xt(u)}finally{d.endGroup()}},async updateOrderStatus(s,u){d.startGroup("POS Operations: Update Order Status");try{d.debug("Updating order status:",{orderId:s,statusData:u});const o=await Tt.patch(`orders/${s}/status`,u);return d.debug("Order status update response:",o.data),d.info("Order status updated successfully:",{orderId:s,newStatus:u.status}),{success:!0,data:o.data}}catch(o){return Xt(o)}finally{d.endGroup()}}},Ju={...Ky,...Yy,...To,...Jy},Zu=()=>Ju,Po=Ju;class xo{static async detectScreenChanges(){if(typeof window.getScreenDetails=="function"){const u=await window.getScreenDetails();this.screenChangeHandler=()=>{const o=u.screens,v=this.settings.screen;o.some(x=>x.availLeft===(v==null?void 0:v.availLeft)&&x.availTop===(v==null?void 0:v.availTop))||(this.logger.info("Configured screen disconnected, resetting settings"),this.settings.screen=null,this.saveSettings())},u.addEventListener("screenschange",this.screenChangeHandler)}}static async loadSettings(){const u=localStorage.getItem("customerDisplaySettings");if(u)try{this.settings=JSON.parse(u)}catch(o){this.logger.warn("Failed to load display settings",o)}}static saveSettings(){localStorage.setItem("customerDisplaySettings",JSON.stringify(this.settings))}static async getSecondaryScreen(){try{if(typeof window.getScreenDetails=="function"){const o=(await window.getScreenDetails()).screens;this.logger.debug("Detected screens:",o.map((m,x)=>({index:x,left:m.availLeft,top:m.availTop,width:m.availWidth,height:m.availHeight,isPrimary:m.isPrimary})));const v=o.find(m=>!m.isPrimary);return v?(this.logger.info("Found secondary screen:",{left:v.availLeft,top:v.availTop,width:v.availWidth,height:v.availHeight}),v):(this.logger.warn("No secondary screen found, using primary screen"),o[0])}return this.logger.info("Using fallback screen detection"),this.getFallbackScreen()}catch(u){return this.logger.error("Error getting secondary screen:",u),this.getFallbackScreen()}}static getFallbackScreen(){const u=window.screen.availLeft!==0||window.screen.availTop!==0||window.screen.availWidth>window.innerWidth||window.screen.availHeight>window.innerHeight,o={availLeft:u?window.screen.availLeft:0,availTop:u?window.screen.availTop:0,availWidth:window.screen.availWidth,availHeight:window.screen.availHeight,isPrimary:!u};return this.logger.debug("Fallback screen detection:",{isMultiScreen:u,screenInfo:o}),o}static async openCustomerDisplay(){await this.loadSettings();try{const u=await this.getSecondaryScreen();if(!u)throw new Error("No secondary screen found");const{availLeft:o,availTop:v,availWidth:m,availHeight:x}=u,w=[`left=${o}`,`top=${v}`,`width=${m}`,`height=${x}`,"menubar=no","toolbar=no","location=no","status=no","resizable=no","scrollbars=no","fullscreen=yes"].join(",");d.info("🖥️ Opening customer display window with features:",w);let p=null;try{if(p=window.open("/customer-display","customerDisplay",w),!p||p.closed)throw new Error("Popup blocked or window failed to open")}catch(S){if(d.error("❌ Popup blocked or failed to open:",S),alert("Please allow popups for this site to open the customer display"),p=window.open("/customer-display","customerDisplay","width=800,height=600"),!p)throw new Error("Popup blocked even after fallback attempt")}let V=!1,C=!0;if(!p)throw d.error("❌ Window.open() returned null - check popup blocker settings"),new Error("Window.open() returned null - popup may be blocked");if(d.info("✅ Window opened successfully:",{closed:p.closed,location:p.location.href}),!p)throw new Error("Failed to open customer display window");return p.addEventListener("load",async()=>{try{if(p.closed)throw this.logger.error("❌ Window closed unexpectedly before setup"),new Error("Customer display window closed unexpectedly");this.logger.info("🖥️ Window loaded successfully, starting setup..."),this.logger.debug("📏 Target dimensions:",{left:o,top:v,width:m,height:x});try{this.logger.info("🖼️ Positioning and sizing window..."),p.moveTo(o,v),p.resizeTo(m,x),await new Promise(D=>setTimeout(D,100)),p.moveTo(o,v),p.resizeTo(m,x),this.logger.info("✅ Window positioned and sized successfully",{actualLeft:p.screenX,actualTop:p.screenY,actualWidth:p.innerWidth,actualHeight:p.innerHeight})}catch(D){this.logger.warn("⚠️ Window move/resize failed:",D),this.logger.debug("📐 Current window dimensions:",{width:p.innerWidth,height:p.innerHeight,screenX:p.screenX,screenY:p.screenY})}this.logger.info("🎨 Applying borderless styles...");const S=document.createElement("style");S.textContent=`
            html, body {
              margin: 0;
              padding: 0;
              overflow: hidden;
              width: 100vw;
              height: 100vh;
            }
            * {
              box-sizing: border-box;
            }
          `,p.document.head.appendChild(S),this.logger.info("✅ Styles applied successfully"),this.logger.debug("🖌️ Applied styles:",S.textContent),await new Promise(D=>setTimeout(D,100));try{this.logger.info("🔒 Checking fullscreen permissions..."),p.document.fullscreenEnabled?await p.document.requestFullscreen()?(V=!0,this.logger.info("✅ Fullscreen permission granted")):this.logger.warn("⚠️ Fullscreen permission denied"):this.logger.warn("⚠️ Fullscreen not enabled in document")}catch(D){this.logger.error("❌ Fullscreen permission check failed:",D),p.resizeTo(m,x),p.moveTo(o,v)}if(this.logger.debug("Permission states:",{hasFullscreenPermission:V,hasPopupPermission:C}),V){const D=document.createElement("style");D.textContent=`
              :-webkit-full-screen, :-moz-full-screen, :-ms-fullscreen, :fullscreen {
                width: 100% !important;
                height: 100% !important;
              }
            `,p.document.head.appendChild(D);try{this.logger.info("🖼️ Attempting to enter fullscreen mode..."),p.document.documentElement.requestFullscreen?(this.logger.info("🛠️ Using standard fullscreen API"),await p.document.documentElement.requestFullscreen(),this.logger.info("✅ Standard fullscreen successful")):p.document.documentElement.webkitRequestFullscreen?(this.logger.info("🛠️ Using webkit fullscreen API"),await p.document.documentElement.webkitRequestFullscreen(),this.logger.info("✅ Webkit fullscreen successful")):p.document.documentElement.mozRequestFullScreen?(this.logger.info("🛠️ Using moz fullscreen API"),await p.document.documentElement.mozRequestFullScreen(),this.logger.info("✅ Moz fullscreen successful")):p.document.documentElement.msRequestFullscreen?(this.logger.info("🛠️ Using ms fullscreen API"),await p.document.documentElement.msRequestFullscreen(),this.logger.info("✅ MS fullscreen successful")):this.logger.warn("⚠️ No fullscreen API available"),this.logger.info("📏 Verifying fullscreen dimensions..."),await new Promise(E=>setTimeout(E,100)),this.logger.debug("📐 Before adjustment:",{width:p.innerWidth,height:p.innerHeight}),p.resizeTo(m,x),p.moveTo(o,v),this.logger.debug("📐 After adjustment:",{width:p.innerWidth,height:p.innerHeight}),this.logger.info("✅ Dimensions verified")}catch(E){this.logger.warn("Fullscreen request failed, continuing in windowed mode:",E),p.resizeTo(m,x),p.moveTo(o,v)}}else this.logger.warn("Fullscreen not enabled, using windowed mode"),p.resizeTo(m,x),p.moveTo(o,v);await new Promise(D=>setTimeout(D,100)),p.resizeTo(m,x),p.moveTo(o,v),p.document.body.style.overflow="hidden",p.document.body.style.margin="0",p.document.body.style.padding="0",p.document.body.style.width="100vw",p.document.body.style.height="100vh",p.focus(),this.settings.position={left:o,top:v},this.settings.size={width:m,height:x},this.settings.screen=u,this.settings.permissions={fullscreen:V,popup:C,lastChecked:new Date().toISOString()},this.saveSettings();const G=setInterval(()=>{if(p.closed){clearInterval(G);return}V&&!p.document.fullscreenElement&&(d.warn("⚠️ Lost fullscreen permission"),V=!1)},5e3);p.addEventListener("beforeunload",()=>{p.document.fullscreenElement&&p.document.exitFullscreen()}),p.addEventListener("resize",()=>{p.resizeTo(m,x),p.moveTo(o,v)}),this.logger.info("Customer display opened successfully on secondary screen")}catch(S){this.logger.error("Error setting up customer display:",S),p.resizeTo(m,x),p.focus()}},500),p}catch(u){this.logger.error("Error opening customer display:",u);const o=window.open("/customer-display","customerDisplay",`width=${window.screen.availWidth},height=${window.screen.availHeight}`);return o&&setTimeout(()=>{try{o.resizeTo(window.screen.availWidth,window.screen.availHeight),o.document.documentElement.requestFullscreen&&o.document.documentElement.requestFullscreen(),o.focus()}catch(v){this.logger.warn("Fallback window setup error:",v)}},500),o}}}Io(xo,"screenChangeHandler",null),Io(xo,"logger",d),Io(xo,"settings",{position:null,size:null,screen:null});const Zy={class:"d-flex align-center w-100 gap-2"},Qy={class:"quantity-badge"},jy={class:"item-info flex-grow-1 min-width-0"},Xy={class:"item-name text-body-2 font-weight-medium text-truncate"},eh={class:"item-price text-caption text-grey-darken-1"},th={class:"d-flex align-center gap-1"},nh={class:"item-total text-body-2 font-weight-medium"},rh={class:"action-buttons d-flex"},ah={__name:"CartItemList",props:{items:{type:Array,required:!0}},emits:["edit","remove","updateQuantity"],setup(s,{emit:u}){const o=s,v=u;console.log("CartItemList - Initial cart state:",{itemCount:o.items.length,items:o.items.map(p=>({id:p.id,name:p.name,price:p.price,quantity:p.quantity,total:p.price*p.quantity}))}),Be(()=>o.items,(p,V)=>{console.log("CartItemList - Cart items changed:",{oldCount:(V==null?void 0:V.length)||0,newCount:p.length,items:p.map(C=>({id:C.id,name:C.name,price:C.price,formatted_price:xe.format(C.price),quantity:C.quantity,total:C.price*C.quantity,formatted_total:xe.format(C.price*C.quantity)}))})},{deep:!0});const m=p=>(console.log("CartItemList - Formatting price:",{inputCents:p,isDollarAmount:xe.isInDollars(p)}),xe.format(p));_e(()=>{const p=o.items.reduce((V,C)=>{const S=C.price*C.quantity;return console.log("CartItemList - Calculating item total:",{itemId:C.id,price:C.price,quantity:C.quantity,itemTotal:S}),V+S},0);return console.log("CartItemList - Cart total calculated:",{itemCount:o.items.length,total:p,formattedTotal:xe.format(p)}),p});const x=(p,V,C)=>{console.log("CartItemList - Updating quantity:",{itemId:p,index:C,oldQuantity:o.items[C].quantity,newQuantity:V,price:o.items[C].price,oldTotal:o.items[C].price*o.items[C].quantity,newTotal:o.items[C].price*V}),v("updateQuantity",p,V,C)},w=(p,V)=>{console.log("CartItemList - Removing item:",{itemId:p,index:V,item:o.items[V]}),v("remove",p,V)};return(p,V)=>(B(),he("div",{class:Gt(["cart-items",p.$attrs.class])},[a(vy,{class:"cart-list pa-0",density:"compact"},{default:i(()=>[(B(!0),he(gt,null,en(s.items,(C,S)=>(B(),Se(na,{key:S,class:Gt(["cart-item py-1",{"border-b":S!==s.items.length-1}])},{default:i(()=>[y("div",Zy,[y("div",Qy,te(C.quantity),1),y("div",jy,[y("div",Xy,te(C.name),1),y("div",eh,te(m(C.price))+" each ",1)]),y("div",th,[y("span",nh,te(m(C.price*C.quantity)),1),y("div",rh,[a(pe,{icon:"mdi-minus",size:"small",variant:"tonal",density:"comfortable",color:"primary",disabled:C.quantity<=1,onClick:G=>x(C.id,Math.max(0,C.quantity-1),S),class:"touch-btn"},null,8,["disabled","onClick"]),a(pe,{icon:"mdi-plus",size:"small",variant:"tonal",density:"comfortable",color:"primary",onClick:G=>x(C.id,C.quantity+1,S),class:"touch-btn"},null,8,["onClick"]),a(pe,{icon:"mdi-delete",size:"small",variant:"tonal",density:"comfortable",color:"error",onClick:G=>w(C.id,S),class:"touch-btn"},null,8,["onClick"])])])])]),_:2},1032,["class"]))),128))]),_:1})],2))}},oh=_t(ah,[["__scopeId","data-v-06c2a156"]]);function ih(){const s=Yt(),u=z(s.$state.discountType),o=z(s.$state.discountValue);return Be(()=>s.$state.discountType,m=>{u.value=m}),Be(()=>s.$state.discountValue,m=>{o.value=m}),{discountType:u,discountValue:o,updateDiscount:()=>{const m=u.value==="$"?"fixed":u.value,x=Number(o.value)||0;s.setDiscount(m,x)}}}const sh={class:"order-summary"},lh={class:"summary-row"},uh={class:"amount"},dh={class:"discount-section"},ch={class:"discount-header"},fh={class:"discount-controls"},mh={key:0,class:"summary-row discount-amount"},ph={class:"amount success-text"},vh={class:"summary-row"},gh={class:"label"},yh={class:"amount"},hh={class:"summary-row total"},_h={class:"amount"},wh={__name:"CartSummary",props:{subtotal:Number,discountAmount:Number,taxRate:Number,taxAmount:Number,total:Number},setup(s){const{discountType:u,discountValue:o,updateDiscount:v}=ih(),m=x=>Number(x/100).toFixed(2);return(x,w)=>(B(),he("div",sh,[y("div",lh,[w[2]||(w[2]=y("span",{class:"label"},"Subtotal",-1)),y("span",uh,"$"+te(m(s.subtotal)),1)]),y("div",dh,[y("div",ch,[w[4]||(w[4]=y("span",{class:"label"},"Discount",-1)),oe(o)>0?(B(),Se(lr,{key:0,color:"success",size:"small",variant:"flat",class:"discount-badge"},{default:i(()=>w[3]||(w[3]=[q(" Applied ")])),_:1})):Ne("",!0)]),y("div",fh,[a(hn,{modelValue:oe(u),"onUpdate:modelValue":[w[0]||(w[0]=p=>Sa(u)?u.value=p:null),oe(v)],items:[{title:"Percentage",value:"%"},{title:"Fixed",value:"fixed"}],"item-title":"title","item-value":"value",density:"compact","hide-details":"",variant:"outlined",class:"discount-type-select"},{selection:i(({item:p})=>[q(te(p.value==="%"?"%":"$"),1)]),_:1},8,["modelValue","onUpdate:modelValue"]),a(ft,{modelValue:oe(o),"onUpdate:modelValue":[w[1]||(w[1]=p=>Sa(o)?o.value=p:null),oe(v)],prefix:oe(u)==="fixed"?"$":"",suffix:oe(u)==="%"?"%":"",density:"compact","hide-details":"",type:"number",variant:"outlined",class:"discount-value-input"},null,8,["modelValue","prefix","suffix","onUpdate:modelValue"])])]),s.discountAmount>0?(B(),he("div",mh,[w[5]||(w[5]=y("span",{class:"label"},"Discount Applied",-1)),y("span",ph,"-$"+te(m(s.discountAmount)),1)])):Ne("",!0),y("div",vh,[y("span",gh,"Tax ("+te((s.taxRate*100).toFixed(1))+"%)",1),y("span",yh,"$"+te(m(s.taxAmount)),1)]),a(Ir,{class:"my-4"}),y("div",hh,[w[6]||(w[6]=y("span",{class:"label"},"Total",-1)),y("span",_h,"$"+te(m(s.total)),1)])]))}},bh=_t(wh,[["__scopeId","data-v-67e25db4"]]),Ih={class:"mb-4"},Ph={class:"d-flex align-center gap-2"},Ch={__name:"EditItemDialog",props:{modelValue:{type:Boolean,required:!0},item:{type:Object,default:null},index:{type:Number,default:null}},emits:["update:modelValue"],setup(s,{emit:u}){const o=s,v=u,m=Yt(),x=z(1),w=_e({get:()=>o.modelValue,set:S=>v("update:modelValue",S)}),p=_e(()=>o.item&&x.value>0&&x.value<o.item.quantity),V=()=>{p.value&&(m.splitItem(o.index,Number(x.value)),C())},C=()=>{w.value=!1,x.value=1};return(S,G)=>(B(),Se(Vt,{modelValue:w.value,"onUpdate:modelValue":G[1]||(G[1]=D=>w.value=D),"max-width":"500"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(Rn,{class:"d-flex justify-space-between align-center"},{default:i(()=>{var D;return[q(te((D=s.item)==null?void 0:D.name)+" ",1),a(lr,null,{default:i(()=>{var E;return[q("Qty: "+te(((E=s.item)==null?void 0:E.quantity)||0),1)]}),_:1})]}),_:1}),a(ht,null,{default:i(()=>{var D;return[y("div",Ih,[G[3]||(G[3]=y("div",{class:"text-subtitle-2 mb-2"},"Split Item",-1)),y("div",Ph,[a(ft,{modelValue:x.value,"onUpdate:modelValue":G[0]||(G[0]=E=>x.value=E),type:"number",label:"Quantity to split",min:1,max:((D=s.item)==null?void 0:D.quantity)-1,density:"compact","hide-details":"",style:{"max-width":"120px"}},null,8,["modelValue","max"]),a(pe,{color:"primary",variant:"outlined",disabled:!p.value,onClick:V},{default:i(()=>G[2]||(G[2]=[q(" Split ")])),_:1},8,["disabled"])])])]}),_:1}),a(wn,null,{default:i(()=>[a(It),a(pe,{color:"grey",variant:"text",onClick:C},{default:i(()=>G[4]||(G[4]=[q(" Cancel ")])),_:1}),a(pe,{color:"primary",onClick:C},{default:i(()=>G[5]||(G[5]=[q(" Save ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Kt=St;function Oa(){var h;d.info("[useOrderType] Initializing order type composable");const s=Yt(),u=dr(),o=z(null),v=z({name:"",phone:"",instructions:""}),m=z(""),x=z(!1),w=z(null);if(s.type&&(d.debug("[useOrderType] Initializing from cart store type:",s.type),o.value=s.type),s.notes)try{d.debug("[useOrderType] Parsing cart store notes");const I=JSON.parse(s.notes);I.customerNotes&&(m.value=I.customerNotes,d.debug("[useOrderType] Customer notes initialized:",m.value)),(h=I.orderInfo)!=null&&h.customer&&(v.value={...v.value,...I.orderInfo.customer},d.debug("[useOrderType] Customer info initialized:",v.value))}catch(I){d.warn("[useOrderType] Failed to initialize from cart notes:",I)}Be(m,I=>{try{d.debug("[useOrderType] Customer notes changed:",I);const F={customerNotes:I,orderInfo:{customer:v.value},timestamp:new Date().toISOString()};s.setNotes(JSON.stringify(F))}catch(F){d.error("[useOrderType] Failed to sync notes with cart store:",F)}});const p=_e(()=>{if(!o.value)return d.debug("[useOrderType] Validation failed: No order type set"),!1;const{name:I,phone:F,address:j}=v.value;switch(o.value){case Kt.DINE_IN:return d.debug("[useOrderType] Validating DINE_IN order"),!0;case Kt.TO_GO:return d.debug("[useOrderType] Validating TO_GO order:",{name:I,phone:F}),I.trim()&&F.trim();case Kt.DELIVERY:return d.debug("[useOrderType] Validating DELIVERY order:",{name:I,phone:F,address:j}),I.trim()&&F.trim()&&j.trim();case Kt.PICKUP:return d.debug("[useOrderType] Validating PICKUP order:",{name:I,phone:F}),I.trim()&&F.trim();default:return d.warn("[useOrderType] Invalid order type:",o.value),!1}}),V=_e(()=>o.value&&o.value!==Kt.DINE_IN),C=_e(()=>{const I=!s.isEmpty&&u.systemReady;return d.debug("[useOrderType] Can create order:",{canCreate:I,cartEmpty:s.isEmpty,systemReady:u.systemReady}),I}),S=_e(()=>{try{if(s.type)return d.debug("[useOrderType] Order type found in cart store:",s.type),o.value=s.type,s.type;if(s.holdInvoiceId){d.debug("[useOrderType] Determining type from held invoice:",s.holdInvoiceName);const I=s.holdInvoiceName||"";for(const F of Object.values(Kt))if(I.startsWith(F))return d.debug("[useOrderType] Type determined from invoice name:",F),o.value=F,s.setType(F),F}return s.holdInvoiceId?(d.debug("[useOrderType] No type found for held order, defaulting to TO_GO"),o.value=Kt.TO_GO,s.setType(Kt.TO_GO),Kt.TO_GO):(d.debug("[useOrderType] No order type found"),o.value||null)}catch(I){return d.error("[useOrderType] Error determining current order type:",I),o.value||null}}),G=(I,F="")=>{d.debug("[useOrderType] Updating customer notes:",{customer:I,notes:F});const j={orderInfo:{customer:{...I}},customerNotes:F};s.setNotes(JSON.stringify(j))};return{orderType:o,customerInfo:v,customerNotes:m,loading:x,error:w,isValid:p,requiresCustomerInfo:V,canCreateOrder:C,currentOrderType:S,setOrderType:I=>{if(d.info("[useOrderType] Setting order type:",I),!Object.values(Kt).includes(I))throw d.error("[useOrderType] Invalid order type:",I),new Error("Invalid order type");o.value=I,s.setType(I),v.value={name:"",phone:"",address:"",pickupTime:"",instructions:""},w.value=null;const F={orderInfo:{customer:{...v.value}},customerNotes:""};s.setNotes(JSON.stringify(F)),m.value="",d.debug("[useOrderType] Order type set, state reset")},setCustomerInfo:I=>{d.debug("[useOrderType] Setting customer info:",I),v.value={...v.value,...I},G(v.value,m.value)},setCustomerNotes:I=>{d.debug("[useOrderType] Setting customer notes:",I),m.value=I,G(v.value,I)},processOrder:async(I={})=>{if(d.info("[useOrderType] Starting order processing",{orderType:o.value,customerInfo:v.value,isValid:p.value,canCreateOrder:C.value}),!p.value)throw d.warn("[useOrderType] Invalid order information"),new Error("Invalid order information");if(!C.value)throw d.warn("[useOrderType] Cannot create order",{cartEmpty:s.isEmpty,systemReady:u.systemReady}),new Error("Cannot create order: Cart is empty or system is not ready");x.value=!0,w.value=null;try{if(G(v.value,m.value),o.value===Kt.DINE_IN)return d.info("[useOrderType] Processing DINE_IN order"),{success:!0};if(o.value===Kt.TO_GO){if(!I.storeId||!I.cashierId)throw new Error("Store and cashier IDs are required for TO-GO orders");I.customerInfo&&(v.value={name:I.customerInfo.name,phone:I.customerInfo.phone,instructions:I.customerInfo.instructions});const se=I.orderName||`${o.value}_${v.value.name}`;d.info("[useOrderType] Processing TO_GO order:",{orderName:se,storeId:I.storeId,cashierId:I.cashierId,customerInfo:v.value});const U=s.prepareHoldInvoiceData(I.storeId,I.cashierId,se),k={customer:{name:v.value.name,phone:v.value.phone,instructions:v.value.instructions}};U.notes=JSON.stringify({orderInfo:k}),U.is_prepared_data=!0,U.is_invoice_pos=1,U.is_hold_invoice=!0,d.debug("[useOrderType] TO_GO hold order data prepared:",U);const J=await u.holdOrder(U);return d.info("[useOrderType] TO_GO order created successfully:",J.data),{success:!0,data:J.data}}const F=s.prepareHoldInvoiceData(u.selectedStore,u.selectedCashier,`${o.value}_${v.value.name}`);d.debug("[useOrderType] Processing regular order:",F);const j=await u.holdOrder(F);if(!(j!=null&&j.success))throw d.error("[useOrderType] Failed to process order:",j),new Error((j==null?void 0:j.message)||"Failed to process order");return d.info("[useOrderType] Order processed successfully:",j),{success:!0,data:j.data||j}}catch(F){throw d.error("[useOrderType] Order processing failed:",{error:F,orderType:o.value,customerInfo:v.value}),w.value=F.message||"Failed to process order",F}finally{x.value=!1,d.debug("[useOrderType] Order processing completed")}},reset:()=>{d.debug("[useOrderType] Resetting state"),o.value=null,s.setType(null),v.value={name:"",phone:"",address:"",pickupTime:"",instructions:""},m.value="",w.value=null},ORDER_TYPES:Kt}}const xh={class:"order-notes px-4 py-2"},Sh={__name:"OrderNotes",setup(s){const u=Yt(),{customerNotes:o,setCustomerNotes:v}=Oa(),m=z(""),x=p=>{try{const V={customerNotes:p,timestamp:new Date().toISOString()};u.setNotes(JSON.stringify(V)),d.debug("Notes saved to cart store:",{notes:p})}catch(V){d.error("Failed to save notes to cart:",V)}},w=p=>{v(p),x(p)};return cr(()=>{try{if(u.notes){const p=ur(u.notes);p&&(m.value=p,v(p),d.debug("Notes initialized from cart store:",{notes:p}))}}catch(p){d.error("Failed to initialize notes:",p)}}),Be(()=>o.value,p=>{p!==m.value&&(m.value=p,x(p),d.debug("Notes updated from customer notes:",{newNotes:p}))}),Be(()=>u.notes,p=>{try{const V=ur(p);V!==m.value&&(m.value=V,d.debug("Notes updated from cart store:",{notes:V}))}catch(V){d.error("Failed to parse cart store notes:",V)}}),(p,V)=>(B(),he("div",xh,[a(ft,{modelValue:m.value,"onUpdate:modelValue":[V[0]||(V[0]=C=>m.value=C),w],label:"Order Notes",placeholder:"Add notes for this order...",variant:"outlined",density:"comfortable","hide-details":"",clearable:""},{"prepend-inner":i(()=>[a(Te,{size:"small",color:"grey"},{default:i(()=>V[1]||(V[1]=[q("mdi-note-text-outline")])),_:1})]),_:1},8,["modelValue"])]))}},Oh=_t(Sh,[["__scopeId","data-v-af3d3769"]]);function Th(){const s=Yt(),u=dr(),o=z(!1);return{cartStore:s,updating:o,clearOrder:()=>{var p,V;try{d.debug("Clearing order, current state:",{items:(p=s.items)==null?void 0:p.length,total:s.total}),s.clearCart()}catch(C){d.error("Error clearing order:",C),(V=window.toastr)==null||V.error("Failed to clear order")}},updateQuantity:(p,V,C)=>{s.updateItemQuantity(p,V,C)},removeItem:(p,V)=>{s.removeItem(p,V)},updateOrder:async()=>{var p,V,C;try{const S=s.holdOrderDescription;if(d.debug("Attempting to update order:",{description:S,hasDescription:!!S,cartState:{items:(p=s.items)==null?void 0:p.length,total:s.total,holdInvoiceId:s.holdInvoiceId}}),!S)throw new Error("No order description found");o.value=!0;const G=s.prepareHoldInvoiceData(u.selectedStore,u.selectedCashier,S),D=await u.updateHoldInvoice(S,G);if(D.success)(V=window.toastr)==null||V.success("Order updated successfully"),s.setHoldInvoiceId(null),s.clearCart();else throw new Error(D.message||"Failed to update order")}catch(S){d.error("Failed to update order:",S),(C=window.toastr)==null||C.error(S.message||"Failed to update order")}finally{o.value=!1}}}}const Dh={class:"pos-cart-container",style:{"max-width":"none"}},Eh={key:0,class:"px-4 py-2 bg-warning-lighten-4"},Ah={class:"d-flex align-center"},Nh={class:"text-warning text-body-2 font-weight-medium"},$h={key:0,class:"empty-state pa-8 text-center"},Vh={__name:"PosCart",setup(s){const{cartStore:u,updating:o,clearOrder:v,updateQuantity:m,removeItem:x,updateOrder:w,splitItem:p}=Th(),V=async()=>{var E,P;try{if(!u.items||u.items.length===0){(E=window.toastr)==null||E.error("Cannot update invoice: Cart is empty");return}const g=u.currentInvoice||{},b={...u.currentInvoice,contact_id:g.contact_id||g.customer_id,company_id:g.company_id,first_name:g.first_name,last_name:g.last_name,email:g.email,phone:g.phone};b.company_id||(console.warn("No company_id found in original invoice"),b.company_id=u.currentCompanyId),b.contact_id||console.warn("No contact_id found in original invoice"),await u.updateInvoice(b),v()}catch(g){console.error("Failed to update invoice:",g),(P=window.toastr)==null||P.error("Failed to update invoice: "+(g.message||"Unknown error"))}},C=z(!1),S=z(null),G=z(null),D=(E,P)=>{S.value={...E},G.value=P,C.value=!0};return(E,P)=>(B(),he("div",Dh,[a(Ze,{class:"cart-header",flat:""},{default:i(()=>[a(ln,{density:"comfortable",color:"primary",class:"rounded-t-lg"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>[q(te(oe(u).isEditingInvoice?"Edit Invoice":"Current Order"),1)]),_:1}),a(It),oe(u).canUpdateInvoice?(B(),Se(pe,{key:0,color:"white",variant:"text",loading:oe(o),onClick:V,"prepend-icon":"mdi-content-save",class:"text-none"},{default:i(()=>P[3]||(P[3]=[q(" Update Invoice ")])),_:1},8,["loading"])):oe(u).isHoldOrder?(B(),Se(pe,{key:1,color:"white",variant:"text",loading:oe(o),onClick:oe(w),"prepend-icon":"mdi-content-save",class:"text-none"},{default:i(()=>P[4]||(P[4]=[q(" Update ")])),_:1},8,["loading","onClick"])):Ne("",!0),a(pe,{color:"white",variant:"text",disabled:oe(u).isEmpty,onClick:oe(v),"prepend-icon":"mdi-delete-outline",class:"text-none ml-2"},{default:i(()=>P[5]||(P[5]=[q(" Clear ")])),_:1},8,["disabled","onClick"])]),_:1}),oe(u).isHoldOrder?(B(),he("div",Eh,[y("div",Ah,[a(Te,{icon:"mdi-clock-outline",color:"warning",class:"mr-2"}),y("span",Nh," Held Order: "+te(oe(u).holdOrderDescription||"No Description"),1)])])):Ne("",!0)]),_:1}),a(Ze,{class:Gt(["cart-scrollable-content mx-2 mt-2",{"empty-cart":oe(u).isEmpty}]),variant:"flat"},{default:i(()=>[oe(u).isEmpty?(B(),he("div",$h,[a(Te,{icon:"mdi-cart-outline",size:"64",color:"grey-lighten-1",class:"mb-4"}),P[6]||(P[6]=y("h3",{class:"text-h6 font-weight-medium text-grey-darken-1"},"Cart is Empty",-1)),P[7]||(P[7]=y("p",{class:"text-body-2 text-grey-darken-1 mt-2"}," Add items from the product list to get started. ",-1))])):(B(),Se(oh,{key:1,items:oe(u).items,onEdit:D,onRemove:oe(x),onUpdateQuantity:oe(m),class:"cart-items-list"},null,8,["items","onRemove","onUpdateQuantity"]))]),_:1},8,["class"]),oe(u).isEmpty?Ne("",!0):(B(),Se(Ze,{key:0,class:"mx-2 mt-2",variant:"flat"},{default:i(()=>[a(Oh)]),_:1})),a(Ze,{class:"cart-summary-wrapper mx-2 mt-2 mb-2",elevation:"2",rounded:"lg"},{default:i(()=>[a(ht,{class:"pa-4"},{default:i(()=>[a(bh,{subtotal:oe(u).subtotal,"discount-amount":oe(u).discountAmount,"tax-rate":oe(u).taxRate,"tax-amount":oe(u).taxAmount,total:oe(u).total},null,8,["subtotal","discount-amount","tax-rate","tax-amount","total"])]),_:1})]),_:1}),a(Ch,{modelValue:C.value,"onUpdate:modelValue":P[2]||(P[2]=g=>C.value=g),item:S.value,index:G.value,"max-width":"500",transition:"dialog-bottom-transition",persistent:""},{default:i(()=>[a(Ze,null,{default:i(()=>[a(Rn,{class:"text-h6 pa-4"},{default:i(()=>[P[8]||(P[8]=q(" Edit Item ")),a(pe,{icon:"mdi-close",variant:"text",size:"small",onClick:P[0]||(P[0]=g=>C.value=!1),class:"float-right"})]),_:1}),a(ht,{class:"pa-4"}),a(wn,{class:"pa-4"},{default:i(()=>[a(It),a(pe,{color:"grey-darken-1",variant:"text",onClick:P[1]||(P[1]=g=>C.value=!1),class:"text-none"},{default:i(()=>P[9]||(P[9]=[q(" Cancel ")])),_:1}),a(pe,{color:"primary",onClick:E.saveChanges,class:"text-none",loading:E.saving},{default:i(()=>P[10]||(P[10]=[q(" Save Changes ")])),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","item","index"]),a(ji,{"model-value":oe(u).loading,class:"align-center justify-center"},{default:i(()=>[a(Nn,{size:"64",color:"primary",indeterminate:""})]),_:1},8,["model-value"])]))}},Fh=_t(Vh,[["__scopeId","data-v-fb1db8bc"]]);var sr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kh(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Do={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Do.exports;(function(s,u){(function(){var o,v="4.17.21",m=200,x="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",w="Expected a function",p="Invalid `variable` option passed into `_.template`",V="__lodash_hash_undefined__",C=500,S="__lodash_placeholder__",G=1,D=2,E=4,P=1,g=2,b=1,h=2,I=4,F=8,j=16,se=32,U=64,k=128,J=256,K=512,T=30,re="...",M=800,ve=16,me=1,$=2,ge=3,ye=1/0,Pe=9007199254740991,Ae=17976931348623157e292,ie=0/0,Z=4294967295,$e=Z-1,Ce=Z>>>1,Xe=[["ary",k],["bind",b],["bindKey",h],["curry",F],["curryRight",j],["flip",K],["partial",se],["partialRight",U],["rearg",J]],ne="[object Arguments]",Y="[object Array]",de="[object AsyncFunction]",Ve="[object Boolean]",Pt="[object Date]",At="[object DOMException]",tt="[object Error]",dt="[object Function]",mt="[object GeneratorFunction]",lt="[object Map]",Ke="[object Number]",qe="[object Null]",Ct="[object Object]",ce="[object Promise]",le="[object Proxy]",Ue="[object RegExp]",Ie="[object Set]",wt="[object String]",pt="[object Symbol]",tn="[object Undefined]",ue="[object WeakMap]",H="[object WeakSet]",L="[object ArrayBuffer]",N="[object DataView]",fe="[object Float32Array]",nt="[object Float64Array]",Jt="[object Int8Array]",Nt="[object Int16Array]",dn="[object Int32Array]",Lt="[object Uint8Array]",Un="[object Uint8ClampedArray]",Kn="[object Uint16Array]",Yn="[object Uint32Array]",Cr=/\b__p \+= '';/g,ot=/\b(__p \+=) '' \+/g,cn=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ht=/&(?:amp|lt|gt|quot|#39);/g,Jn=/[&<>"']/g,ra=RegExp(Ht.source),fr=RegExp(Jn.source),Zn=/<%-([\s\S]+?)%>/g,Mn=/<%([\s\S]+?)%>/g,Qn=/<%=([\s\S]+?)%>/g,xr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,rt=/^\w*$/,$t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Lr=/[\\^$.*+?()[\]{}|]/g,Ta=RegExp(Lr.source),Ur=/^\s+/,Da=/\s/,Ea=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Aa=/\{\n\/\* \[wrapped with (.+)\] \*/,Sr=/,? & /,je=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Mr=/[()=,{}\[\]\/\s]/,Vo=/\\(\\)?/g,Na=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,zr=/\w*$/,at=/^[-+]0x[0-9a-f]+$/i,aa=/^0b[01]+$/i,os=/^\[object .+?Constructor\]$/,Le=/^0o[0-7]+$/i,$a=/^(?:0|[1-9]\d*)$/,Va=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,et=/($^)/,Ut=/['\n\r\u2028\u2029\\]/g,In="\\ud800-\\udfff",Pn="\\u0300-\\u036f",oa="\\ufe20-\\ufe2f",id="\\u20d0-\\u20ff",is=Pn+oa+id,ss="\\u2700-\\u27bf",ls="a-z\\xdf-\\xf6\\xf8-\\xff",sd="\\xac\\xb1\\xd7\\xf7",ld="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ud="\\u2000-\\u206f",dd=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",us="A-Z\\xc0-\\xd6\\xd8-\\xde",ds="\\ufe0e\\ufe0f",cs=sd+ld+ud+dd,Fo="['’]",cd="["+In+"]",fs="["+cs+"]",Fa="["+is+"]",ms="\\d+",fd="["+ss+"]",ps="["+ls+"]",vs="[^"+In+cs+ms+ss+ls+us+"]",ko="\\ud83c[\\udffb-\\udfff]",md="(?:"+Fa+"|"+ko+")",gs="[^"+In+"]",Ro="(?:\\ud83c[\\udde6-\\uddff]){2}",Lo="[\\ud800-\\udbff][\\udc00-\\udfff]",qr="["+us+"]",ys="\\u200d",hs="(?:"+ps+"|"+vs+")",pd="(?:"+qr+"|"+vs+")",_s="(?:"+Fo+"(?:d|ll|m|re|s|t|ve))?",ws="(?:"+Fo+"(?:D|LL|M|RE|S|T|VE))?",bs=md+"?",Is="["+ds+"]?",vd="(?:"+ys+"(?:"+[gs,Ro,Lo].join("|")+")"+Is+bs+")*",gd="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",yd="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ps=Is+bs+vd,hd="(?:"+[fd,Ro,Lo].join("|")+")"+Ps,_d="(?:"+[gs+Fa+"?",Fa,Ro,Lo,cd].join("|")+")",wd=RegExp(Fo,"g"),bd=RegExp(Fa,"g"),Uo=RegExp(ko+"(?="+ko+")|"+_d+Ps,"g"),Id=RegExp([qr+"?"+ps+"+"+_s+"(?="+[fs,qr,"$"].join("|")+")",pd+"+"+ws+"(?="+[fs,qr+hs,"$"].join("|")+")",qr+"?"+hs+"+"+_s,qr+"+"+ws,yd,gd,ms,hd].join("|"),"g"),Pd=RegExp("["+ys+In+is+ds+"]"),Cd=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,xd=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Sd=-1,yt={};yt[fe]=yt[nt]=yt[Jt]=yt[Nt]=yt[dn]=yt[Lt]=yt[Un]=yt[Kn]=yt[Yn]=!0,yt[ne]=yt[Y]=yt[L]=yt[Ve]=yt[N]=yt[Pt]=yt[tt]=yt[dt]=yt[lt]=yt[Ke]=yt[Ct]=yt[Ue]=yt[Ie]=yt[wt]=yt[ue]=!1;var vt={};vt[ne]=vt[Y]=vt[L]=vt[N]=vt[Ve]=vt[Pt]=vt[fe]=vt[nt]=vt[Jt]=vt[Nt]=vt[dn]=vt[lt]=vt[Ke]=vt[Ct]=vt[Ue]=vt[Ie]=vt[wt]=vt[pt]=vt[Lt]=vt[Un]=vt[Kn]=vt[Yn]=!0,vt[tt]=vt[dt]=vt[ue]=!1;var Od={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Td={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Dd={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ed={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Ad=parseFloat,Nd=parseInt,Cs=typeof sr=="object"&&sr&&sr.Object===Object&&sr,$d=typeof self=="object"&&self&&self.Object===Object&&self,Mt=Cs||$d||Function("return this")(),Mo=u&&!u.nodeType&&u,Or=Mo&&!0&&s&&!s.nodeType&&s,xs=Or&&Or.exports===Mo,zo=xs&&Cs.process,Cn=function(){try{var A=Or&&Or.require&&Or.require("util").types;return A||zo&&zo.binding&&zo.binding("util")}catch{}}(),Ss=Cn&&Cn.isArrayBuffer,Os=Cn&&Cn.isDate,Ts=Cn&&Cn.isMap,Ds=Cn&&Cn.isRegExp,Es=Cn&&Cn.isSet,As=Cn&&Cn.isTypedArray;function fn(A,Q,W){switch(W.length){case 0:return A.call(Q);case 1:return A.call(Q,W[0]);case 2:return A.call(Q,W[0],W[1]);case 3:return A.call(Q,W[0],W[1],W[2])}return A.apply(Q,W)}function Vd(A,Q,W,Oe){for(var Me=-1,it=A==null?0:A.length;++Me<it;){var Ft=A[Me];Q(Oe,Ft,W(Ft),A)}return Oe}function xn(A,Q){for(var W=-1,Oe=A==null?0:A.length;++W<Oe&&Q(A[W],W,A)!==!1;);return A}function Fd(A,Q){for(var W=A==null?0:A.length;W--&&Q(A[W],W,A)!==!1;);return A}function Ns(A,Q){for(var W=-1,Oe=A==null?0:A.length;++W<Oe;)if(!Q(A[W],W,A))return!1;return!0}function mr(A,Q){for(var W=-1,Oe=A==null?0:A.length,Me=0,it=[];++W<Oe;){var Ft=A[W];Q(Ft,W,A)&&(it[Me++]=Ft)}return it}function ka(A,Q){var W=A==null?0:A.length;return!!W&&Gr(A,Q,0)>-1}function qo(A,Q,W){for(var Oe=-1,Me=A==null?0:A.length;++Oe<Me;)if(W(Q,A[Oe]))return!0;return!1}function bt(A,Q){for(var W=-1,Oe=A==null?0:A.length,Me=Array(Oe);++W<Oe;)Me[W]=Q(A[W],W,A);return Me}function pr(A,Q){for(var W=-1,Oe=Q.length,Me=A.length;++W<Oe;)A[Me+W]=Q[W];return A}function Go(A,Q,W,Oe){var Me=-1,it=A==null?0:A.length;for(Oe&&it&&(W=A[++Me]);++Me<it;)W=Q(W,A[Me],Me,A);return W}function kd(A,Q,W,Oe){var Me=A==null?0:A.length;for(Oe&&Me&&(W=A[--Me]);Me--;)W=Q(W,A[Me],Me,A);return W}function Ho(A,Q){for(var W=-1,Oe=A==null?0:A.length;++W<Oe;)if(Q(A[W],W,A))return!0;return!1}var Rd=Bo("length");function Ld(A){return A.split("")}function Ud(A){return A.match(je)||[]}function $s(A,Q,W){var Oe;return W(A,function(Me,it,Ft){if(Q(Me,it,Ft))return Oe=it,!1}),Oe}function Ra(A,Q,W,Oe){for(var Me=A.length,it=W+(Oe?1:-1);Oe?it--:++it<Me;)if(Q(A[it],it,A))return it;return-1}function Gr(A,Q,W){return Q===Q?Qd(A,Q,W):Ra(A,Vs,W)}function Md(A,Q,W,Oe){for(var Me=W-1,it=A.length;++Me<it;)if(Oe(A[Me],Q))return Me;return-1}function Vs(A){return A!==A}function Fs(A,Q){var W=A==null?0:A.length;return W?Ko(A,Q)/W:ie}function Bo(A){return function(Q){return Q==null?o:Q[A]}}function Wo(A){return function(Q){return A==null?o:A[Q]}}function ks(A,Q,W,Oe,Me){return Me(A,function(it,Ft,ct){W=Oe?(Oe=!1,it):Q(W,it,Ft,ct)}),W}function zd(A,Q){var W=A.length;for(A.sort(Q);W--;)A[W]=A[W].value;return A}function Ko(A,Q){for(var W,Oe=-1,Me=A.length;++Oe<Me;){var it=Q(A[Oe]);it!==o&&(W=W===o?it:W+it)}return W}function Yo(A,Q){for(var W=-1,Oe=Array(A);++W<A;)Oe[W]=Q(W);return Oe}function qd(A,Q){return bt(Q,function(W){return[W,A[W]]})}function Rs(A){return A&&A.slice(0,zs(A)+1).replace(Ur,"")}function mn(A){return function(Q){return A(Q)}}function Jo(A,Q){return bt(Q,function(W){return A[W]})}function ia(A,Q){return A.has(Q)}function Ls(A,Q){for(var W=-1,Oe=A.length;++W<Oe&&Gr(Q,A[W],0)>-1;);return W}function Us(A,Q){for(var W=A.length;W--&&Gr(Q,A[W],0)>-1;);return W}function Gd(A,Q){for(var W=A.length,Oe=0;W--;)A[W]===Q&&++Oe;return Oe}var Hd=Wo(Od),Bd=Wo(Td);function Wd(A){return"\\"+Ed[A]}function Kd(A,Q){return A==null?o:A[Q]}function Hr(A){return Pd.test(A)}function Yd(A){return Cd.test(A)}function Jd(A){for(var Q,W=[];!(Q=A.next()).done;)W.push(Q.value);return W}function Zo(A){var Q=-1,W=Array(A.size);return A.forEach(function(Oe,Me){W[++Q]=[Me,Oe]}),W}function Ms(A,Q){return function(W){return A(Q(W))}}function vr(A,Q){for(var W=-1,Oe=A.length,Me=0,it=[];++W<Oe;){var Ft=A[W];(Ft===Q||Ft===S)&&(A[W]=S,it[Me++]=W)}return it}function La(A){var Q=-1,W=Array(A.size);return A.forEach(function(Oe){W[++Q]=Oe}),W}function Zd(A){var Q=-1,W=Array(A.size);return A.forEach(function(Oe){W[++Q]=[Oe,Oe]}),W}function Qd(A,Q,W){for(var Oe=W-1,Me=A.length;++Oe<Me;)if(A[Oe]===Q)return Oe;return-1}function jd(A,Q,W){for(var Oe=W+1;Oe--;)if(A[Oe]===Q)return Oe;return Oe}function Br(A){return Hr(A)?ec(A):Rd(A)}function $n(A){return Hr(A)?tc(A):Ld(A)}function zs(A){for(var Q=A.length;Q--&&Da.test(A.charAt(Q)););return Q}var Xd=Wo(Dd);function ec(A){for(var Q=Uo.lastIndex=0;Uo.test(A);)++Q;return Q}function tc(A){return A.match(Uo)||[]}function nc(A){return A.match(Id)||[]}var rc=function A(Q){Q=Q==null?Mt:Wr.defaults(Mt.Object(),Q,Wr.pick(Mt,xd));var W=Q.Array,Oe=Q.Date,Me=Q.Error,it=Q.Function,Ft=Q.Math,ct=Q.Object,Qo=Q.RegExp,ac=Q.String,Sn=Q.TypeError,Ua=W.prototype,oc=it.prototype,Kr=ct.prototype,Ma=Q["__core-js_shared__"],za=oc.toString,ut=Kr.hasOwnProperty,ic=0,qs=function(){var e=/[^.]+$/.exec(Ma&&Ma.keys&&Ma.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),qa=Kr.toString,sc=za.call(ct),lc=Mt._,uc=Qo("^"+za.call(ut).replace(Lr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ga=xs?Q.Buffer:o,gr=Q.Symbol,Ha=Q.Uint8Array,Gs=Ga?Ga.allocUnsafe:o,Ba=Ms(ct.getPrototypeOf,ct),Hs=ct.create,Bs=Kr.propertyIsEnumerable,Wa=Ua.splice,Ws=gr?gr.isConcatSpreadable:o,sa=gr?gr.iterator:o,Tr=gr?gr.toStringTag:o,Ka=function(){try{var e=$r(ct,"defineProperty");return e({},"",{}),e}catch{}}(),dc=Q.clearTimeout!==Mt.clearTimeout&&Q.clearTimeout,cc=Oe&&Oe.now!==Mt.Date.now&&Oe.now,fc=Q.setTimeout!==Mt.setTimeout&&Q.setTimeout,Ya=Ft.ceil,Ja=Ft.floor,jo=ct.getOwnPropertySymbols,mc=Ga?Ga.isBuffer:o,Ks=Q.isFinite,pc=Ua.join,vc=Ms(ct.keys,ct),kt=Ft.max,Bt=Ft.min,gc=Oe.now,yc=Q.parseInt,Ys=Ft.random,hc=Ua.reverse,Xo=$r(Q,"DataView"),la=$r(Q,"Map"),ei=$r(Q,"Promise"),Yr=$r(Q,"Set"),ua=$r(Q,"WeakMap"),da=$r(ct,"create"),Za=ua&&new ua,Jr={},_c=Vr(Xo),wc=Vr(la),bc=Vr(ei),Ic=Vr(Yr),Pc=Vr(ua),Qa=gr?gr.prototype:o,ca=Qa?Qa.valueOf:o,Js=Qa?Qa.toString:o;function c(e){if(Ot(e)&&!ze(e)&&!(e instanceof Je)){if(e instanceof On)return e;if(ut.call(e,"__wrapped__"))return Zl(e)}return new On(e)}var Zr=function(){function e(){}return function(t){if(!xt(t))return{};if(Hs)return Hs(t);e.prototype=t;var n=new e;return e.prototype=o,n}}();function ja(){}function On(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=o}c.templateSettings={escape:Zn,evaluate:Mn,interpolate:Qn,variable:"",imports:{_:c}},c.prototype=ja.prototype,c.prototype.constructor=c,On.prototype=Zr(ja.prototype),On.prototype.constructor=On;function Je(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Z,this.__views__=[]}function Cc(){var e=new Je(this.__wrapped__);return e.__actions__=nn(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=nn(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=nn(this.__views__),e}function xc(){if(this.__filtered__){var e=new Je(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Sc(){var e=this.__wrapped__.value(),t=this.__dir__,n=ze(e),r=t<0,l=n?e.length:0,f=Uf(0,l,this.__views__),_=f.start,O=f.end,R=O-_,X=r?O:_-1,ee=this.__iteratees__,ae=ee.length,be=0,De=Bt(R,this.__takeCount__);if(!n||!r&&l==R&&De==R)return _l(e,this.__actions__);var ke=[];e:for(;R--&&be<De;){X+=t;for(var He=-1,Re=e[X];++He<ae;){var Ye=ee[He],Qe=Ye.iteratee,gn=Ye.type,jt=Qe(Re);if(gn==$)Re=jt;else if(!jt){if(gn==me)continue e;break e}}ke[be++]=Re}return ke}Je.prototype=Zr(ja.prototype),Je.prototype.constructor=Je;function Dr(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Oc(){this.__data__=da?da(null):{},this.size=0}function Tc(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Dc(e){var t=this.__data__;if(da){var n=t[e];return n===V?o:n}return ut.call(t,e)?t[e]:o}function Ec(e){var t=this.__data__;return da?t[e]!==o:ut.call(t,e)}function Ac(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=da&&t===o?V:t,this}Dr.prototype.clear=Oc,Dr.prototype.delete=Tc,Dr.prototype.get=Dc,Dr.prototype.has=Ec,Dr.prototype.set=Ac;function jn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Nc(){this.__data__=[],this.size=0}function $c(e){var t=this.__data__,n=Xa(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Wa.call(t,n,1),--this.size,!0}function Vc(e){var t=this.__data__,n=Xa(t,e);return n<0?o:t[n][1]}function Fc(e){return Xa(this.__data__,e)>-1}function kc(e,t){var n=this.__data__,r=Xa(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}jn.prototype.clear=Nc,jn.prototype.delete=$c,jn.prototype.get=Vc,jn.prototype.has=Fc,jn.prototype.set=kc;function Xn(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Rc(){this.size=0,this.__data__={hash:new Dr,map:new(la||jn),string:new Dr}}function Lc(e){var t=fo(this,e).delete(e);return this.size-=t?1:0,t}function Uc(e){return fo(this,e).get(e)}function Mc(e){return fo(this,e).has(e)}function zc(e,t){var n=fo(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}Xn.prototype.clear=Rc,Xn.prototype.delete=Lc,Xn.prototype.get=Uc,Xn.prototype.has=Mc,Xn.prototype.set=zc;function Er(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new Xn;++t<n;)this.add(e[t])}function qc(e){return this.__data__.set(e,V),this}function Gc(e){return this.__data__.has(e)}Er.prototype.add=Er.prototype.push=qc,Er.prototype.has=Gc;function Vn(e){var t=this.__data__=new jn(e);this.size=t.size}function Hc(){this.__data__=new jn,this.size=0}function Bc(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Wc(e){return this.__data__.get(e)}function Kc(e){return this.__data__.has(e)}function Yc(e,t){var n=this.__data__;if(n instanceof jn){var r=n.__data__;if(!la||r.length<m-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Xn(r)}return n.set(e,t),this.size=n.size,this}Vn.prototype.clear=Hc,Vn.prototype.delete=Bc,Vn.prototype.get=Wc,Vn.prototype.has=Kc,Vn.prototype.set=Yc;function Zs(e,t){var n=ze(e),r=!n&&Fr(e),l=!n&&!r&&br(e),f=!n&&!r&&!l&&ea(e),_=n||r||l||f,O=_?Yo(e.length,ac):[],R=O.length;for(var X in e)(t||ut.call(e,X))&&!(_&&(X=="length"||l&&(X=="offset"||X=="parent")||f&&(X=="buffer"||X=="byteLength"||X=="byteOffset")||rr(X,R)))&&O.push(X);return O}function Qs(e){var t=e.length;return t?e[ci(0,t-1)]:o}function Jc(e,t){return mo(nn(e),Ar(t,0,e.length))}function Zc(e){return mo(nn(e))}function ti(e,t,n){(n!==o&&!Fn(e[t],n)||n===o&&!(t in e))&&er(e,t,n)}function fa(e,t,n){var r=e[t];(!(ut.call(e,t)&&Fn(r,n))||n===o&&!(t in e))&&er(e,t,n)}function Xa(e,t){for(var n=e.length;n--;)if(Fn(e[n][0],t))return n;return-1}function Qc(e,t,n,r){return yr(e,function(l,f,_){t(r,l,n(l),_)}),r}function js(e,t){return e&&qn(t,Rt(t),e)}function jc(e,t){return e&&qn(t,an(t),e)}function er(e,t,n){t=="__proto__"&&Ka?Ka(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function ni(e,t){for(var n=-1,r=t.length,l=W(r),f=e==null;++n<r;)l[n]=f?o:ki(e,t[n]);return l}function Ar(e,t,n){return e===e&&(n!==o&&(e=e<=n?e:n),t!==o&&(e=e>=t?e:t)),e}function Tn(e,t,n,r,l,f){var _,O=t&G,R=t&D,X=t&E;if(n&&(_=l?n(e,r,l,f):n(e)),_!==o)return _;if(!xt(e))return e;var ee=ze(e);if(ee){if(_=zf(e),!O)return nn(e,_)}else{var ae=Wt(e),be=ae==dt||ae==mt;if(br(e))return Il(e,O);if(ae==Ct||ae==ne||be&&!l){if(_=R||be?{}:zl(e),!O)return R?Ef(e,jc(_,e)):Df(e,js(_,e))}else{if(!vt[ae])return l?e:{};_=qf(e,ae,O)}}f||(f=new Vn);var De=f.get(e);if(De)return De;f.set(e,_),gu(e)?e.forEach(function(Re){_.add(Tn(Re,t,n,Re,e,f))}):pu(e)&&e.forEach(function(Re,Ye){_.set(Ye,Tn(Re,t,n,Ye,e,f))});var ke=X?R?Ii:bi:R?an:Rt,He=ee?o:ke(e);return xn(He||e,function(Re,Ye){He&&(Ye=Re,Re=e[Ye]),fa(_,Ye,Tn(Re,t,n,Ye,e,f))}),_}function Xc(e){var t=Rt(e);return function(n){return Xs(n,e,t)}}function Xs(e,t,n){var r=n.length;if(e==null)return!r;for(e=ct(e);r--;){var l=n[r],f=t[l],_=e[l];if(_===o&&!(l in e)||!f(_))return!1}return!0}function el(e,t,n){if(typeof e!="function")throw new Sn(w);return _a(function(){e.apply(o,n)},t)}function ma(e,t,n,r){var l=-1,f=ka,_=!0,O=e.length,R=[],X=t.length;if(!O)return R;n&&(t=bt(t,mn(n))),r?(f=qo,_=!1):t.length>=m&&(f=ia,_=!1,t=new Er(t));e:for(;++l<O;){var ee=e[l],ae=n==null?ee:n(ee);if(ee=r||ee!==0?ee:0,_&&ae===ae){for(var be=X;be--;)if(t[be]===ae)continue e;R.push(ee)}else f(t,ae,r)||R.push(ee)}return R}var yr=Ol(zn),tl=Ol(ai,!0);function ef(e,t){var n=!0;return yr(e,function(r,l,f){return n=!!t(r,l,f),n}),n}function eo(e,t,n){for(var r=-1,l=e.length;++r<l;){var f=e[r],_=t(f);if(_!=null&&(O===o?_===_&&!vn(_):n(_,O)))var O=_,R=f}return R}function tf(e,t,n,r){var l=e.length;for(n=Ge(n),n<0&&(n=-n>l?0:l+n),r=r===o||r>l?l:Ge(r),r<0&&(r+=l),r=n>r?0:hu(r);n<r;)e[n++]=t;return e}function nl(e,t){var n=[];return yr(e,function(r,l,f){t(r,l,f)&&n.push(r)}),n}function zt(e,t,n,r,l){var f=-1,_=e.length;for(n||(n=Hf),l||(l=[]);++f<_;){var O=e[f];t>0&&n(O)?t>1?zt(O,t-1,n,r,l):pr(l,O):r||(l[l.length]=O)}return l}var ri=Tl(),rl=Tl(!0);function zn(e,t){return e&&ri(e,t,Rt)}function ai(e,t){return e&&rl(e,t,Rt)}function to(e,t){return mr(t,function(n){return ar(e[n])})}function Nr(e,t){t=_r(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[Gn(t[n++])];return n&&n==r?e:o}function al(e,t,n){var r=t(e);return ze(e)?r:pr(r,n(e))}function Zt(e){return e==null?e===o?tn:qe:Tr&&Tr in ct(e)?Lf(e):Qf(e)}function oi(e,t){return e>t}function nf(e,t){return e!=null&&ut.call(e,t)}function rf(e,t){return e!=null&&t in ct(e)}function af(e,t,n){return e>=Bt(t,n)&&e<kt(t,n)}function ii(e,t,n){for(var r=n?qo:ka,l=e[0].length,f=e.length,_=f,O=W(f),R=1/0,X=[];_--;){var ee=e[_];_&&t&&(ee=bt(ee,mn(t))),R=Bt(ee.length,R),O[_]=!n&&(t||l>=120&&ee.length>=120)?new Er(_&&ee):o}ee=e[0];var ae=-1,be=O[0];e:for(;++ae<l&&X.length<R;){var De=ee[ae],ke=t?t(De):De;if(De=n||De!==0?De:0,!(be?ia(be,ke):r(X,ke,n))){for(_=f;--_;){var He=O[_];if(!(He?ia(He,ke):r(e[_],ke,n)))continue e}be&&be.push(ke),X.push(De)}}return X}function of(e,t,n,r){return zn(e,function(l,f,_){t(r,n(l),f,_)}),r}function pa(e,t,n){t=_r(t,e),e=Bl(e,t);var r=e==null?e:e[Gn(En(t))];return r==null?o:fn(r,e,n)}function ol(e){return Ot(e)&&Zt(e)==ne}function sf(e){return Ot(e)&&Zt(e)==L}function lf(e){return Ot(e)&&Zt(e)==Pt}function va(e,t,n,r,l){return e===t?!0:e==null||t==null||!Ot(e)&&!Ot(t)?e!==e&&t!==t:uf(e,t,n,r,va,l)}function uf(e,t,n,r,l,f){var _=ze(e),O=ze(t),R=_?Y:Wt(e),X=O?Y:Wt(t);R=R==ne?Ct:R,X=X==ne?Ct:X;var ee=R==Ct,ae=X==Ct,be=R==X;if(be&&br(e)){if(!br(t))return!1;_=!0,ee=!1}if(be&&!ee)return f||(f=new Vn),_||ea(e)?Ll(e,t,n,r,l,f):kf(e,t,R,n,r,l,f);if(!(n&P)){var De=ee&&ut.call(e,"__wrapped__"),ke=ae&&ut.call(t,"__wrapped__");if(De||ke){var He=De?e.value():e,Re=ke?t.value():t;return f||(f=new Vn),l(He,Re,n,r,f)}}return be?(f||(f=new Vn),Rf(e,t,n,r,l,f)):!1}function df(e){return Ot(e)&&Wt(e)==lt}function si(e,t,n,r){var l=n.length,f=l,_=!r;if(e==null)return!f;for(e=ct(e);l--;){var O=n[l];if(_&&O[2]?O[1]!==e[O[0]]:!(O[0]in e))return!1}for(;++l<f;){O=n[l];var R=O[0],X=e[R],ee=O[1];if(_&&O[2]){if(X===o&&!(R in e))return!1}else{var ae=new Vn;if(r)var be=r(X,ee,R,e,t,ae);if(!(be===o?va(ee,X,P|g,r,ae):be))return!1}}return!0}function il(e){if(!xt(e)||Wf(e))return!1;var t=ar(e)?uc:os;return t.test(Vr(e))}function cf(e){return Ot(e)&&Zt(e)==Ue}function ff(e){return Ot(e)&&Wt(e)==Ie}function mf(e){return Ot(e)&&_o(e.length)&&!!yt[Zt(e)]}function sl(e){return typeof e=="function"?e:e==null?on:typeof e=="object"?ze(e)?dl(e[0],e[1]):ul(e):Du(e)}function li(e){if(!ha(e))return vc(e);var t=[];for(var n in ct(e))ut.call(e,n)&&n!="constructor"&&t.push(n);return t}function pf(e){if(!xt(e))return Zf(e);var t=ha(e),n=[];for(var r in e)r=="constructor"&&(t||!ut.call(e,r))||n.push(r);return n}function ui(e,t){return e<t}function ll(e,t){var n=-1,r=rn(e)?W(e.length):[];return yr(e,function(l,f,_){r[++n]=t(l,f,_)}),r}function ul(e){var t=Ci(e);return t.length==1&&t[0][2]?Gl(t[0][0],t[0][1]):function(n){return n===e||si(n,e,t)}}function dl(e,t){return Si(e)&&ql(t)?Gl(Gn(e),t):function(n){var r=ki(n,e);return r===o&&r===t?Ri(n,e):va(t,r,P|g)}}function no(e,t,n,r,l){e!==t&&ri(t,function(f,_){if(l||(l=new Vn),xt(f))vf(e,t,_,n,no,r,l);else{var O=r?r(Ti(e,_),f,_+"",e,t,l):o;O===o&&(O=f),ti(e,_,O)}},an)}function vf(e,t,n,r,l,f,_){var O=Ti(e,n),R=Ti(t,n),X=_.get(R);if(X){ti(e,n,X);return}var ee=f?f(O,R,n+"",e,t,_):o,ae=ee===o;if(ae){var be=ze(R),De=!be&&br(R),ke=!be&&!De&&ea(R);ee=R,be||De||ke?ze(O)?ee=O:Dt(O)?ee=nn(O):De?(ae=!1,ee=Il(R,!0)):ke?(ae=!1,ee=Pl(R,!0)):ee=[]:wa(R)||Fr(R)?(ee=O,Fr(O)?ee=_u(O):(!xt(O)||ar(O))&&(ee=zl(R))):ae=!1}ae&&(_.set(R,ee),l(ee,R,r,f,_),_.delete(R)),ti(e,n,ee)}function cl(e,t){var n=e.length;if(n)return t+=t<0?n:0,rr(t,n)?e[t]:o}function fl(e,t,n){t.length?t=bt(t,function(f){return ze(f)?function(_){return Nr(_,f.length===1?f[0]:f)}:f}):t=[on];var r=-1;t=bt(t,mn(Fe()));var l=ll(e,function(f,_,O){var R=bt(t,function(X){return X(f)});return{criteria:R,index:++r,value:f}});return zd(l,function(f,_){return Tf(f,_,n)})}function gf(e,t){return ml(e,t,function(n,r){return Ri(e,r)})}function ml(e,t,n){for(var r=-1,l=t.length,f={};++r<l;){var _=t[r],O=Nr(e,_);n(O,_)&&ga(f,_r(_,e),O)}return f}function yf(e){return function(t){return Nr(t,e)}}function di(e,t,n,r){var l=r?Md:Gr,f=-1,_=t.length,O=e;for(e===t&&(t=nn(t)),n&&(O=bt(e,mn(n)));++f<_;)for(var R=0,X=t[f],ee=n?n(X):X;(R=l(O,ee,R,r))>-1;)O!==e&&Wa.call(O,R,1),Wa.call(e,R,1);return e}function pl(e,t){for(var n=e?t.length:0,r=n-1;n--;){var l=t[n];if(n==r||l!==f){var f=l;rr(l)?Wa.call(e,l,1):pi(e,l)}}return e}function ci(e,t){return e+Ja(Ys()*(t-e+1))}function hf(e,t,n,r){for(var l=-1,f=kt(Ya((t-e)/(n||1)),0),_=W(f);f--;)_[r?f:++l]=e,e+=n;return _}function fi(e,t){var n="";if(!e||t<1||t>Pe)return n;do t%2&&(n+=e),t=Ja(t/2),t&&(e+=e);while(t);return n}function We(e,t){return Di(Hl(e,t,on),e+"")}function _f(e){return Qs(ta(e))}function wf(e,t){var n=ta(e);return mo(n,Ar(t,0,n.length))}function ga(e,t,n,r){if(!xt(e))return e;t=_r(t,e);for(var l=-1,f=t.length,_=f-1,O=e;O!=null&&++l<f;){var R=Gn(t[l]),X=n;if(R==="__proto__"||R==="constructor"||R==="prototype")return e;if(l!=_){var ee=O[R];X=r?r(ee,R,O):o,X===o&&(X=xt(ee)?ee:rr(t[l+1])?[]:{})}fa(O,R,X),O=O[R]}return e}var vl=Za?function(e,t){return Za.set(e,t),e}:on,bf=Ka?function(e,t){return Ka(e,"toString",{configurable:!0,enumerable:!1,value:Ui(t),writable:!0})}:on;function If(e){return mo(ta(e))}function Dn(e,t,n){var r=-1,l=e.length;t<0&&(t=-t>l?0:l+t),n=n>l?l:n,n<0&&(n+=l),l=t>n?0:n-t>>>0,t>>>=0;for(var f=W(l);++r<l;)f[r]=e[r+t];return f}function Pf(e,t){var n;return yr(e,function(r,l,f){return n=t(r,l,f),!n}),!!n}function ro(e,t,n){var r=0,l=e==null?r:e.length;if(typeof t=="number"&&t===t&&l<=Ce){for(;r<l;){var f=r+l>>>1,_=e[f];_!==null&&!vn(_)&&(n?_<=t:_<t)?r=f+1:l=f}return l}return mi(e,t,on,n)}function mi(e,t,n,r){var l=0,f=e==null?0:e.length;if(f===0)return 0;t=n(t);for(var _=t!==t,O=t===null,R=vn(t),X=t===o;l<f;){var ee=Ja((l+f)/2),ae=n(e[ee]),be=ae!==o,De=ae===null,ke=ae===ae,He=vn(ae);if(_)var Re=r||ke;else X?Re=ke&&(r||be):O?Re=ke&&be&&(r||!De):R?Re=ke&&be&&!De&&(r||!He):De||He?Re=!1:Re=r?ae<=t:ae<t;Re?l=ee+1:f=ee}return Bt(f,$e)}function gl(e,t){for(var n=-1,r=e.length,l=0,f=[];++n<r;){var _=e[n],O=t?t(_):_;if(!n||!Fn(O,R)){var R=O;f[l++]=_===0?0:_}}return f}function yl(e){return typeof e=="number"?e:vn(e)?ie:+e}function pn(e){if(typeof e=="string")return e;if(ze(e))return bt(e,pn)+"";if(vn(e))return Js?Js.call(e):"";var t=e+"";return t=="0"&&1/e==-ye?"-0":t}function hr(e,t,n){var r=-1,l=ka,f=e.length,_=!0,O=[],R=O;if(n)_=!1,l=qo;else if(f>=m){var X=t?null:Vf(e);if(X)return La(X);_=!1,l=ia,R=new Er}else R=t?[]:O;e:for(;++r<f;){var ee=e[r],ae=t?t(ee):ee;if(ee=n||ee!==0?ee:0,_&&ae===ae){for(var be=R.length;be--;)if(R[be]===ae)continue e;t&&R.push(ae),O.push(ee)}else l(R,ae,n)||(R!==O&&R.push(ae),O.push(ee))}return O}function pi(e,t){return t=_r(t,e),e=Bl(e,t),e==null||delete e[Gn(En(t))]}function hl(e,t,n,r){return ga(e,t,n(Nr(e,t)),r)}function ao(e,t,n,r){for(var l=e.length,f=r?l:-1;(r?f--:++f<l)&&t(e[f],f,e););return n?Dn(e,r?0:f,r?f+1:l):Dn(e,r?f+1:0,r?l:f)}function _l(e,t){var n=e;return n instanceof Je&&(n=n.value()),Go(t,function(r,l){return l.func.apply(l.thisArg,pr([r],l.args))},n)}function vi(e,t,n){var r=e.length;if(r<2)return r?hr(e[0]):[];for(var l=-1,f=W(r);++l<r;)for(var _=e[l],O=-1;++O<r;)O!=l&&(f[l]=ma(f[l]||_,e[O],t,n));return hr(zt(f,1),t,n)}function wl(e,t,n){for(var r=-1,l=e.length,f=t.length,_={};++r<l;){var O=r<f?t[r]:o;n(_,e[r],O)}return _}function gi(e){return Dt(e)?e:[]}function yi(e){return typeof e=="function"?e:on}function _r(e,t){return ze(e)?e:Si(e,t)?[e]:Jl(st(e))}var Cf=We;function wr(e,t,n){var r=e.length;return n=n===o?r:n,!t&&n>=r?e:Dn(e,t,n)}var bl=dc||function(e){return Mt.clearTimeout(e)};function Il(e,t){if(t)return e.slice();var n=e.length,r=Gs?Gs(n):new e.constructor(n);return e.copy(r),r}function hi(e){var t=new e.constructor(e.byteLength);return new Ha(t).set(new Ha(e)),t}function xf(e,t){var n=t?hi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Sf(e){var t=new e.constructor(e.source,zr.exec(e));return t.lastIndex=e.lastIndex,t}function Of(e){return ca?ct(ca.call(e)):{}}function Pl(e,t){var n=t?hi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Cl(e,t){if(e!==t){var n=e!==o,r=e===null,l=e===e,f=vn(e),_=t!==o,O=t===null,R=t===t,X=vn(t);if(!O&&!X&&!f&&e>t||f&&_&&R&&!O&&!X||r&&_&&R||!n&&R||!l)return 1;if(!r&&!f&&!X&&e<t||X&&n&&l&&!r&&!f||O&&n&&l||!_&&l||!R)return-1}return 0}function Tf(e,t,n){for(var r=-1,l=e.criteria,f=t.criteria,_=l.length,O=n.length;++r<_;){var R=Cl(l[r],f[r]);if(R){if(r>=O)return R;var X=n[r];return R*(X=="desc"?-1:1)}}return e.index-t.index}function xl(e,t,n,r){for(var l=-1,f=e.length,_=n.length,O=-1,R=t.length,X=kt(f-_,0),ee=W(R+X),ae=!r;++O<R;)ee[O]=t[O];for(;++l<_;)(ae||l<f)&&(ee[n[l]]=e[l]);for(;X--;)ee[O++]=e[l++];return ee}function Sl(e,t,n,r){for(var l=-1,f=e.length,_=-1,O=n.length,R=-1,X=t.length,ee=kt(f-O,0),ae=W(ee+X),be=!r;++l<ee;)ae[l]=e[l];for(var De=l;++R<X;)ae[De+R]=t[R];for(;++_<O;)(be||l<f)&&(ae[De+n[_]]=e[l++]);return ae}function nn(e,t){var n=-1,r=e.length;for(t||(t=W(r));++n<r;)t[n]=e[n];return t}function qn(e,t,n,r){var l=!n;n||(n={});for(var f=-1,_=t.length;++f<_;){var O=t[f],R=r?r(n[O],e[O],O,n,e):o;R===o&&(R=e[O]),l?er(n,O,R):fa(n,O,R)}return n}function Df(e,t){return qn(e,xi(e),t)}function Ef(e,t){return qn(e,Ul(e),t)}function oo(e,t){return function(n,r){var l=ze(n)?Vd:Qc,f=t?t():{};return l(n,e,Fe(r,2),f)}}function Qr(e){return We(function(t,n){var r=-1,l=n.length,f=l>1?n[l-1]:o,_=l>2?n[2]:o;for(f=e.length>3&&typeof f=="function"?(l--,f):o,_&&Qt(n[0],n[1],_)&&(f=l<3?o:f,l=1),t=ct(t);++r<l;){var O=n[r];O&&e(t,O,r,f)}return t})}function Ol(e,t){return function(n,r){if(n==null)return n;if(!rn(n))return e(n,r);for(var l=n.length,f=t?l:-1,_=ct(n);(t?f--:++f<l)&&r(_[f],f,_)!==!1;);return n}}function Tl(e){return function(t,n,r){for(var l=-1,f=ct(t),_=r(t),O=_.length;O--;){var R=_[e?O:++l];if(n(f[R],R,f)===!1)break}return t}}function Af(e,t,n){var r=t&b,l=ya(e);function f(){var _=this&&this!==Mt&&this instanceof f?l:e;return _.apply(r?n:this,arguments)}return f}function Dl(e){return function(t){t=st(t);var n=Hr(t)?$n(t):o,r=n?n[0]:t.charAt(0),l=n?wr(n,1).join(""):t.slice(1);return r[e]()+l}}function jr(e){return function(t){return Go(Ou(Su(t).replace(wd,"")),e,"")}}function ya(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Zr(e.prototype),r=e.apply(n,t);return xt(r)?r:n}}function Nf(e,t,n){var r=ya(e);function l(){for(var f=arguments.length,_=W(f),O=f,R=Xr(l);O--;)_[O]=arguments[O];var X=f<3&&_[0]!==R&&_[f-1]!==R?[]:vr(_,R);if(f-=X.length,f<n)return Vl(e,t,io,l.placeholder,o,_,X,o,o,n-f);var ee=this&&this!==Mt&&this instanceof l?r:e;return fn(ee,this,_)}return l}function El(e){return function(t,n,r){var l=ct(t);if(!rn(t)){var f=Fe(n,3);t=Rt(t),n=function(O){return f(l[O],O,l)}}var _=e(t,n,r);return _>-1?l[f?t[_]:_]:o}}function Al(e){return nr(function(t){var n=t.length,r=n,l=On.prototype.thru;for(e&&t.reverse();r--;){var f=t[r];if(typeof f!="function")throw new Sn(w);if(l&&!_&&co(f)=="wrapper")var _=new On([],!0)}for(r=_?r:n;++r<n;){f=t[r];var O=co(f),R=O=="wrapper"?Pi(f):o;R&&Oi(R[0])&&R[1]==(k|F|se|J)&&!R[4].length&&R[9]==1?_=_[co(R[0])].apply(_,R[3]):_=f.length==1&&Oi(f)?_[O]():_.thru(f)}return function(){var X=arguments,ee=X[0];if(_&&X.length==1&&ze(ee))return _.plant(ee).value();for(var ae=0,be=n?t[ae].apply(this,X):ee;++ae<n;)be=t[ae].call(this,be);return be}})}function io(e,t,n,r,l,f,_,O,R,X){var ee=t&k,ae=t&b,be=t&h,De=t&(F|j),ke=t&K,He=be?o:ya(e);function Re(){for(var Ye=arguments.length,Qe=W(Ye),gn=Ye;gn--;)Qe[gn]=arguments[gn];if(De)var jt=Xr(Re),yn=Gd(Qe,jt);if(r&&(Qe=xl(Qe,r,l,De)),f&&(Qe=Sl(Qe,f,_,De)),Ye-=yn,De&&Ye<X){var Et=vr(Qe,jt);return Vl(e,t,io,Re.placeholder,n,Qe,Et,O,R,X-Ye)}var kn=ae?n:this,ir=be?kn[e]:e;return Ye=Qe.length,O?Qe=jf(Qe,O):ke&&Ye>1&&Qe.reverse(),ee&&R<Ye&&(Qe.length=R),this&&this!==Mt&&this instanceof Re&&(ir=He||ya(ir)),ir.apply(kn,Qe)}return Re}function Nl(e,t){return function(n,r){return of(n,e,t(r),{})}}function so(e,t){return function(n,r){var l;if(n===o&&r===o)return t;if(n!==o&&(l=n),r!==o){if(l===o)return r;typeof n=="string"||typeof r=="string"?(n=pn(n),r=pn(r)):(n=yl(n),r=yl(r)),l=e(n,r)}return l}}function _i(e){return nr(function(t){return t=bt(t,mn(Fe())),We(function(n){var r=this;return e(t,function(l){return fn(l,r,n)})})})}function lo(e,t){t=t===o?" ":pn(t);var n=t.length;if(n<2)return n?fi(t,e):t;var r=fi(t,Ya(e/Br(t)));return Hr(t)?wr($n(r),0,e).join(""):r.slice(0,e)}function $f(e,t,n,r){var l=t&b,f=ya(e);function _(){for(var O=-1,R=arguments.length,X=-1,ee=r.length,ae=W(ee+R),be=this&&this!==Mt&&this instanceof _?f:e;++X<ee;)ae[X]=r[X];for(;R--;)ae[X++]=arguments[++O];return fn(be,l?n:this,ae)}return _}function $l(e){return function(t,n,r){return r&&typeof r!="number"&&Qt(t,n,r)&&(n=r=o),t=or(t),n===o?(n=t,t=0):n=or(n),r=r===o?t<n?1:-1:or(r),hf(t,n,r,e)}}function uo(e){return function(t,n){return typeof t=="string"&&typeof n=="string"||(t=An(t),n=An(n)),e(t,n)}}function Vl(e,t,n,r,l,f,_,O,R,X){var ee=t&F,ae=ee?_:o,be=ee?o:_,De=ee?f:o,ke=ee?o:f;t|=ee?se:U,t&=~(ee?U:se),t&I||(t&=~(b|h));var He=[e,t,l,De,ae,ke,be,O,R,X],Re=n.apply(o,He);return Oi(e)&&Wl(Re,He),Re.placeholder=r,Kl(Re,e,t)}function wi(e){var t=Ft[e];return function(n,r){if(n=An(n),r=r==null?0:Bt(Ge(r),292),r&&Ks(n)){var l=(st(n)+"e").split("e"),f=t(l[0]+"e"+(+l[1]+r));return l=(st(f)+"e").split("e"),+(l[0]+"e"+(+l[1]-r))}return t(n)}}var Vf=Yr&&1/La(new Yr([,-0]))[1]==ye?function(e){return new Yr(e)}:qi;function Fl(e){return function(t){var n=Wt(t);return n==lt?Zo(t):n==Ie?Zd(t):qd(t,e(t))}}function tr(e,t,n,r,l,f,_,O){var R=t&h;if(!R&&typeof e!="function")throw new Sn(w);var X=r?r.length:0;if(X||(t&=~(se|U),r=l=o),_=_===o?_:kt(Ge(_),0),O=O===o?O:Ge(O),X-=l?l.length:0,t&U){var ee=r,ae=l;r=l=o}var be=R?o:Pi(e),De=[e,t,n,r,l,ee,ae,f,_,O];if(be&&Jf(De,be),e=De[0],t=De[1],n=De[2],r=De[3],l=De[4],O=De[9]=De[9]===o?R?0:e.length:kt(De[9]-X,0),!O&&t&(F|j)&&(t&=~(F|j)),!t||t==b)var ke=Af(e,t,n);else t==F||t==j?ke=Nf(e,t,O):(t==se||t==(b|se))&&!l.length?ke=$f(e,t,n,r):ke=io.apply(o,De);var He=be?vl:Wl;return Kl(He(ke,De),e,t)}function kl(e,t,n,r){return e===o||Fn(e,Kr[n])&&!ut.call(r,n)?t:e}function Rl(e,t,n,r,l,f){return xt(e)&&xt(t)&&(f.set(t,e),no(e,t,o,Rl,f),f.delete(t)),e}function Ff(e){return wa(e)?o:e}function Ll(e,t,n,r,l,f){var _=n&P,O=e.length,R=t.length;if(O!=R&&!(_&&R>O))return!1;var X=f.get(e),ee=f.get(t);if(X&&ee)return X==t&&ee==e;var ae=-1,be=!0,De=n&g?new Er:o;for(f.set(e,t),f.set(t,e);++ae<O;){var ke=e[ae],He=t[ae];if(r)var Re=_?r(He,ke,ae,t,e,f):r(ke,He,ae,e,t,f);if(Re!==o){if(Re)continue;be=!1;break}if(De){if(!Ho(t,function(Ye,Qe){if(!ia(De,Qe)&&(ke===Ye||l(ke,Ye,n,r,f)))return De.push(Qe)})){be=!1;break}}else if(!(ke===He||l(ke,He,n,r,f))){be=!1;break}}return f.delete(e),f.delete(t),be}function kf(e,t,n,r,l,f,_){switch(n){case N:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case L:return!(e.byteLength!=t.byteLength||!f(new Ha(e),new Ha(t)));case Ve:case Pt:case Ke:return Fn(+e,+t);case tt:return e.name==t.name&&e.message==t.message;case Ue:case wt:return e==t+"";case lt:var O=Zo;case Ie:var R=r&P;if(O||(O=La),e.size!=t.size&&!R)return!1;var X=_.get(e);if(X)return X==t;r|=g,_.set(e,t);var ee=Ll(O(e),O(t),r,l,f,_);return _.delete(e),ee;case pt:if(ca)return ca.call(e)==ca.call(t)}return!1}function Rf(e,t,n,r,l,f){var _=n&P,O=bi(e),R=O.length,X=bi(t),ee=X.length;if(R!=ee&&!_)return!1;for(var ae=R;ae--;){var be=O[ae];if(!(_?be in t:ut.call(t,be)))return!1}var De=f.get(e),ke=f.get(t);if(De&&ke)return De==t&&ke==e;var He=!0;f.set(e,t),f.set(t,e);for(var Re=_;++ae<R;){be=O[ae];var Ye=e[be],Qe=t[be];if(r)var gn=_?r(Qe,Ye,be,t,e,f):r(Ye,Qe,be,e,t,f);if(!(gn===o?Ye===Qe||l(Ye,Qe,n,r,f):gn)){He=!1;break}Re||(Re=be=="constructor")}if(He&&!Re){var jt=e.constructor,yn=t.constructor;jt!=yn&&"constructor"in e&&"constructor"in t&&!(typeof jt=="function"&&jt instanceof jt&&typeof yn=="function"&&yn instanceof yn)&&(He=!1)}return f.delete(e),f.delete(t),He}function nr(e){return Di(Hl(e,o,Xl),e+"")}function bi(e){return al(e,Rt,xi)}function Ii(e){return al(e,an,Ul)}var Pi=Za?function(e){return Za.get(e)}:qi;function co(e){for(var t=e.name+"",n=Jr[t],r=ut.call(Jr,t)?n.length:0;r--;){var l=n[r],f=l.func;if(f==null||f==e)return l.name}return t}function Xr(e){var t=ut.call(c,"placeholder")?c:e;return t.placeholder}function Fe(){var e=c.iteratee||Mi;return e=e===Mi?sl:e,arguments.length?e(arguments[0],arguments[1]):e}function fo(e,t){var n=e.__data__;return Bf(t)?n[typeof t=="string"?"string":"hash"]:n.map}function Ci(e){for(var t=Rt(e),n=t.length;n--;){var r=t[n],l=e[r];t[n]=[r,l,ql(l)]}return t}function $r(e,t){var n=Kd(e,t);return il(n)?n:o}function Lf(e){var t=ut.call(e,Tr),n=e[Tr];try{e[Tr]=o;var r=!0}catch{}var l=qa.call(e);return r&&(t?e[Tr]=n:delete e[Tr]),l}var xi=jo?function(e){return e==null?[]:(e=ct(e),mr(jo(e),function(t){return Bs.call(e,t)}))}:Gi,Ul=jo?function(e){for(var t=[];e;)pr(t,xi(e)),e=Ba(e);return t}:Gi,Wt=Zt;(Xo&&Wt(new Xo(new ArrayBuffer(1)))!=N||la&&Wt(new la)!=lt||ei&&Wt(ei.resolve())!=ce||Yr&&Wt(new Yr)!=Ie||ua&&Wt(new ua)!=ue)&&(Wt=function(e){var t=Zt(e),n=t==Ct?e.constructor:o,r=n?Vr(n):"";if(r)switch(r){case _c:return N;case wc:return lt;case bc:return ce;case Ic:return Ie;case Pc:return ue}return t});function Uf(e,t,n){for(var r=-1,l=n.length;++r<l;){var f=n[r],_=f.size;switch(f.type){case"drop":e+=_;break;case"dropRight":t-=_;break;case"take":t=Bt(t,e+_);break;case"takeRight":e=kt(e,t-_);break}}return{start:e,end:t}}function Mf(e){var t=e.match(Aa);return t?t[1].split(Sr):[]}function Ml(e,t,n){t=_r(t,e);for(var r=-1,l=t.length,f=!1;++r<l;){var _=Gn(t[r]);if(!(f=e!=null&&n(e,_)))break;e=e[_]}return f||++r!=l?f:(l=e==null?0:e.length,!!l&&_o(l)&&rr(_,l)&&(ze(e)||Fr(e)))}function zf(e){var t=e.length,n=new e.constructor(t);return t&&typeof e[0]=="string"&&ut.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function zl(e){return typeof e.constructor=="function"&&!ha(e)?Zr(Ba(e)):{}}function qf(e,t,n){var r=e.constructor;switch(t){case L:return hi(e);case Ve:case Pt:return new r(+e);case N:return xf(e,n);case fe:case nt:case Jt:case Nt:case dn:case Lt:case Un:case Kn:case Yn:return Pl(e,n);case lt:return new r;case Ke:case wt:return new r(e);case Ue:return Sf(e);case Ie:return new r;case pt:return Of(e)}}function Gf(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(Ea,`{
/* [wrapped with `+t+`] */
`)}function Hf(e){return ze(e)||Fr(e)||!!(Ws&&e&&e[Ws])}function rr(e,t){var n=typeof e;return t=t??Pe,!!t&&(n=="number"||n!="symbol"&&$a.test(e))&&e>-1&&e%1==0&&e<t}function Qt(e,t,n){if(!xt(n))return!1;var r=typeof t;return(r=="number"?rn(n)&&rr(t,n.length):r=="string"&&t in n)?Fn(n[t],e):!1}function Si(e,t){if(ze(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||vn(e)?!0:rt.test(e)||!xr.test(e)||t!=null&&e in ct(t)}function Bf(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Oi(e){var t=co(e),n=c[t];if(typeof n!="function"||!(t in Je.prototype))return!1;if(e===n)return!0;var r=Pi(n);return!!r&&e===r[0]}function Wf(e){return!!qs&&qs in e}var Kf=Ma?ar:Hi;function ha(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||Kr;return e===n}function ql(e){return e===e&&!xt(e)}function Gl(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==o||e in ct(n))}}function Yf(e){var t=yo(e,function(r){return n.size===C&&n.clear(),r}),n=t.cache;return t}function Jf(e,t){var n=e[1],r=t[1],l=n|r,f=l<(b|h|k),_=r==k&&n==F||r==k&&n==J&&e[7].length<=t[8]||r==(k|J)&&t[7].length<=t[8]&&n==F;if(!(f||_))return e;r&b&&(e[2]=t[2],l|=n&b?0:I);var O=t[3];if(O){var R=e[3];e[3]=R?xl(R,O,t[4]):O,e[4]=R?vr(e[3],S):t[4]}return O=t[5],O&&(R=e[5],e[5]=R?Sl(R,O,t[6]):O,e[6]=R?vr(e[5],S):t[6]),O=t[7],O&&(e[7]=O),r&k&&(e[8]=e[8]==null?t[8]:Bt(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=l,e}function Zf(e){var t=[];if(e!=null)for(var n in ct(e))t.push(n);return t}function Qf(e){return qa.call(e)}function Hl(e,t,n){return t=kt(t===o?e.length-1:t,0),function(){for(var r=arguments,l=-1,f=kt(r.length-t,0),_=W(f);++l<f;)_[l]=r[t+l];l=-1;for(var O=W(t+1);++l<t;)O[l]=r[l];return O[t]=n(_),fn(e,this,O)}}function Bl(e,t){return t.length<2?e:Nr(e,Dn(t,0,-1))}function jf(e,t){for(var n=e.length,r=Bt(t.length,n),l=nn(e);r--;){var f=t[r];e[r]=rr(f,n)?l[f]:o}return e}function Ti(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Wl=Yl(vl),_a=fc||function(e,t){return Mt.setTimeout(e,t)},Di=Yl(bf);function Kl(e,t,n){var r=t+"";return Di(e,Gf(r,Xf(Mf(r),n)))}function Yl(e){var t=0,n=0;return function(){var r=gc(),l=ve-(r-n);if(n=r,l>0){if(++t>=M)return arguments[0]}else t=0;return e.apply(o,arguments)}}function mo(e,t){var n=-1,r=e.length,l=r-1;for(t=t===o?r:t;++n<t;){var f=ci(n,l),_=e[f];e[f]=e[n],e[n]=_}return e.length=t,e}var Jl=Yf(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace($t,function(n,r,l,f){t.push(l?f.replace(Vo,"$1"):r||n)}),t});function Gn(e){if(typeof e=="string"||vn(e))return e;var t=e+"";return t=="0"&&1/e==-ye?"-0":t}function Vr(e){if(e!=null){try{return za.call(e)}catch{}try{return e+""}catch{}}return""}function Xf(e,t){return xn(Xe,function(n){var r="_."+n[0];t&n[1]&&!ka(e,r)&&e.push(r)}),e.sort()}function Zl(e){if(e instanceof Je)return e.clone();var t=new On(e.__wrapped__,e.__chain__);return t.__actions__=nn(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function em(e,t,n){(n?Qt(e,t,n):t===o)?t=1:t=kt(Ge(t),0);var r=e==null?0:e.length;if(!r||t<1)return[];for(var l=0,f=0,_=W(Ya(r/t));l<r;)_[f++]=Dn(e,l,l+=t);return _}function tm(e){for(var t=-1,n=e==null?0:e.length,r=0,l=[];++t<n;){var f=e[t];f&&(l[r++]=f)}return l}function nm(){var e=arguments.length;if(!e)return[];for(var t=W(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return pr(ze(n)?nn(n):[n],zt(t,1))}var rm=We(function(e,t){return Dt(e)?ma(e,zt(t,1,Dt,!0)):[]}),am=We(function(e,t){var n=En(t);return Dt(n)&&(n=o),Dt(e)?ma(e,zt(t,1,Dt,!0),Fe(n,2)):[]}),om=We(function(e,t){var n=En(t);return Dt(n)&&(n=o),Dt(e)?ma(e,zt(t,1,Dt,!0),o,n):[]});function im(e,t,n){var r=e==null?0:e.length;return r?(t=n||t===o?1:Ge(t),Dn(e,t<0?0:t,r)):[]}function sm(e,t,n){var r=e==null?0:e.length;return r?(t=n||t===o?1:Ge(t),t=r-t,Dn(e,0,t<0?0:t)):[]}function lm(e,t){return e&&e.length?ao(e,Fe(t,3),!0,!0):[]}function um(e,t){return e&&e.length?ao(e,Fe(t,3),!0):[]}function dm(e,t,n,r){var l=e==null?0:e.length;return l?(n&&typeof n!="number"&&Qt(e,t,n)&&(n=0,r=l),tf(e,t,n,r)):[]}function Ql(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var l=n==null?0:Ge(n);return l<0&&(l=kt(r+l,0)),Ra(e,Fe(t,3),l)}function jl(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var l=r-1;return n!==o&&(l=Ge(n),l=n<0?kt(r+l,0):Bt(l,r-1)),Ra(e,Fe(t,3),l,!0)}function Xl(e){var t=e==null?0:e.length;return t?zt(e,1):[]}function cm(e){var t=e==null?0:e.length;return t?zt(e,ye):[]}function fm(e,t){var n=e==null?0:e.length;return n?(t=t===o?1:Ge(t),zt(e,t)):[]}function mm(e){for(var t=-1,n=e==null?0:e.length,r={};++t<n;){var l=e[t];r[l[0]]=l[1]}return r}function eu(e){return e&&e.length?e[0]:o}function pm(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var l=n==null?0:Ge(n);return l<0&&(l=kt(r+l,0)),Gr(e,t,l)}function vm(e){var t=e==null?0:e.length;return t?Dn(e,0,-1):[]}var gm=We(function(e){var t=bt(e,gi);return t.length&&t[0]===e[0]?ii(t):[]}),ym=We(function(e){var t=En(e),n=bt(e,gi);return t===En(n)?t=o:n.pop(),n.length&&n[0]===e[0]?ii(n,Fe(t,2)):[]}),hm=We(function(e){var t=En(e),n=bt(e,gi);return t=typeof t=="function"?t:o,t&&n.pop(),n.length&&n[0]===e[0]?ii(n,o,t):[]});function _m(e,t){return e==null?"":pc.call(e,t)}function En(e){var t=e==null?0:e.length;return t?e[t-1]:o}function wm(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var l=r;return n!==o&&(l=Ge(n),l=l<0?kt(r+l,0):Bt(l,r-1)),t===t?jd(e,t,l):Ra(e,Vs,l,!0)}function bm(e,t){return e&&e.length?cl(e,Ge(t)):o}var Im=We(tu);function tu(e,t){return e&&e.length&&t&&t.length?di(e,t):e}function Pm(e,t,n){return e&&e.length&&t&&t.length?di(e,t,Fe(n,2)):e}function Cm(e,t,n){return e&&e.length&&t&&t.length?di(e,t,o,n):e}var xm=nr(function(e,t){var n=e==null?0:e.length,r=ni(e,t);return pl(e,bt(t,function(l){return rr(l,n)?+l:l}).sort(Cl)),r});function Sm(e,t){var n=[];if(!(e&&e.length))return n;var r=-1,l=[],f=e.length;for(t=Fe(t,3);++r<f;){var _=e[r];t(_,r,e)&&(n.push(_),l.push(r))}return pl(e,l),n}function Ei(e){return e==null?e:hc.call(e)}function Om(e,t,n){var r=e==null?0:e.length;return r?(n&&typeof n!="number"&&Qt(e,t,n)?(t=0,n=r):(t=t==null?0:Ge(t),n=n===o?r:Ge(n)),Dn(e,t,n)):[]}function Tm(e,t){return ro(e,t)}function Dm(e,t,n){return mi(e,t,Fe(n,2))}function Em(e,t){var n=e==null?0:e.length;if(n){var r=ro(e,t);if(r<n&&Fn(e[r],t))return r}return-1}function Am(e,t){return ro(e,t,!0)}function Nm(e,t,n){return mi(e,t,Fe(n,2),!0)}function $m(e,t){var n=e==null?0:e.length;if(n){var r=ro(e,t,!0)-1;if(Fn(e[r],t))return r}return-1}function Vm(e){return e&&e.length?gl(e):[]}function Fm(e,t){return e&&e.length?gl(e,Fe(t,2)):[]}function km(e){var t=e==null?0:e.length;return t?Dn(e,1,t):[]}function Rm(e,t,n){return e&&e.length?(t=n||t===o?1:Ge(t),Dn(e,0,t<0?0:t)):[]}function Lm(e,t,n){var r=e==null?0:e.length;return r?(t=n||t===o?1:Ge(t),t=r-t,Dn(e,t<0?0:t,r)):[]}function Um(e,t){return e&&e.length?ao(e,Fe(t,3),!1,!0):[]}function Mm(e,t){return e&&e.length?ao(e,Fe(t,3)):[]}var zm=We(function(e){return hr(zt(e,1,Dt,!0))}),qm=We(function(e){var t=En(e);return Dt(t)&&(t=o),hr(zt(e,1,Dt,!0),Fe(t,2))}),Gm=We(function(e){var t=En(e);return t=typeof t=="function"?t:o,hr(zt(e,1,Dt,!0),o,t)});function Hm(e){return e&&e.length?hr(e):[]}function Bm(e,t){return e&&e.length?hr(e,Fe(t,2)):[]}function Wm(e,t){return t=typeof t=="function"?t:o,e&&e.length?hr(e,o,t):[]}function Ai(e){if(!(e&&e.length))return[];var t=0;return e=mr(e,function(n){if(Dt(n))return t=kt(n.length,t),!0}),Yo(t,function(n){return bt(e,Bo(n))})}function nu(e,t){if(!(e&&e.length))return[];var n=Ai(e);return t==null?n:bt(n,function(r){return fn(t,o,r)})}var Km=We(function(e,t){return Dt(e)?ma(e,t):[]}),Ym=We(function(e){return vi(mr(e,Dt))}),Jm=We(function(e){var t=En(e);return Dt(t)&&(t=o),vi(mr(e,Dt),Fe(t,2))}),Zm=We(function(e){var t=En(e);return t=typeof t=="function"?t:o,vi(mr(e,Dt),o,t)}),Qm=We(Ai);function jm(e,t){return wl(e||[],t||[],fa)}function Xm(e,t){return wl(e||[],t||[],ga)}var ep=We(function(e){var t=e.length,n=t>1?e[t-1]:o;return n=typeof n=="function"?(e.pop(),n):o,nu(e,n)});function ru(e){var t=c(e);return t.__chain__=!0,t}function tp(e,t){return t(e),e}function po(e,t){return t(e)}var np=nr(function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,l=function(f){return ni(f,e)};return t>1||this.__actions__.length||!(r instanceof Je)||!rr(n)?this.thru(l):(r=r.slice(n,+n+(t?1:0)),r.__actions__.push({func:po,args:[l],thisArg:o}),new On(r,this.__chain__).thru(function(f){return t&&!f.length&&f.push(o),f}))});function rp(){return ru(this)}function ap(){return new On(this.value(),this.__chain__)}function op(){this.__values__===o&&(this.__values__=yu(this.value()));var e=this.__index__>=this.__values__.length,t=e?o:this.__values__[this.__index__++];return{done:e,value:t}}function ip(){return this}function sp(e){for(var t,n=this;n instanceof ja;){var r=Zl(n);r.__index__=0,r.__values__=o,t?l.__wrapped__=r:t=r;var l=r;n=n.__wrapped__}return l.__wrapped__=e,t}function lp(){var e=this.__wrapped__;if(e instanceof Je){var t=e;return this.__actions__.length&&(t=new Je(this)),t=t.reverse(),t.__actions__.push({func:po,args:[Ei],thisArg:o}),new On(t,this.__chain__)}return this.thru(Ei)}function up(){return _l(this.__wrapped__,this.__actions__)}var dp=oo(function(e,t,n){ut.call(e,n)?++e[n]:er(e,n,1)});function cp(e,t,n){var r=ze(e)?Ns:ef;return n&&Qt(e,t,n)&&(t=o),r(e,Fe(t,3))}function fp(e,t){var n=ze(e)?mr:nl;return n(e,Fe(t,3))}var mp=El(Ql),pp=El(jl);function vp(e,t){return zt(vo(e,t),1)}function gp(e,t){return zt(vo(e,t),ye)}function yp(e,t,n){return n=n===o?1:Ge(n),zt(vo(e,t),n)}function au(e,t){var n=ze(e)?xn:yr;return n(e,Fe(t,3))}function ou(e,t){var n=ze(e)?Fd:tl;return n(e,Fe(t,3))}var hp=oo(function(e,t,n){ut.call(e,n)?e[n].push(t):er(e,n,[t])});function _p(e,t,n,r){e=rn(e)?e:ta(e),n=n&&!r?Ge(n):0;var l=e.length;return n<0&&(n=kt(l+n,0)),wo(e)?n<=l&&e.indexOf(t,n)>-1:!!l&&Gr(e,t,n)>-1}var wp=We(function(e,t,n){var r=-1,l=typeof t=="function",f=rn(e)?W(e.length):[];return yr(e,function(_){f[++r]=l?fn(t,_,n):pa(_,t,n)}),f}),bp=oo(function(e,t,n){er(e,n,t)});function vo(e,t){var n=ze(e)?bt:ll;return n(e,Fe(t,3))}function Ip(e,t,n,r){return e==null?[]:(ze(t)||(t=t==null?[]:[t]),n=r?o:n,ze(n)||(n=n==null?[]:[n]),fl(e,t,n))}var Pp=oo(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});function Cp(e,t,n){var r=ze(e)?Go:ks,l=arguments.length<3;return r(e,Fe(t,4),n,l,yr)}function xp(e,t,n){var r=ze(e)?kd:ks,l=arguments.length<3;return r(e,Fe(t,4),n,l,tl)}function Sp(e,t){var n=ze(e)?mr:nl;return n(e,ho(Fe(t,3)))}function Op(e){var t=ze(e)?Qs:_f;return t(e)}function Tp(e,t,n){(n?Qt(e,t,n):t===o)?t=1:t=Ge(t);var r=ze(e)?Jc:wf;return r(e,t)}function Dp(e){var t=ze(e)?Zc:If;return t(e)}function Ep(e){if(e==null)return 0;if(rn(e))return wo(e)?Br(e):e.length;var t=Wt(e);return t==lt||t==Ie?e.size:li(e).length}function Ap(e,t,n){var r=ze(e)?Ho:Pf;return n&&Qt(e,t,n)&&(t=o),r(e,Fe(t,3))}var Np=We(function(e,t){if(e==null)return[];var n=t.length;return n>1&&Qt(e,t[0],t[1])?t=[]:n>2&&Qt(t[0],t[1],t[2])&&(t=[t[0]]),fl(e,zt(t,1),[])}),go=cc||function(){return Mt.Date.now()};function $p(e,t){if(typeof t!="function")throw new Sn(w);return e=Ge(e),function(){if(--e<1)return t.apply(this,arguments)}}function iu(e,t,n){return t=n?o:t,t=e&&t==null?e.length:t,tr(e,k,o,o,o,o,t)}function su(e,t){var n;if(typeof t!="function")throw new Sn(w);return e=Ge(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=o),n}}var Ni=We(function(e,t,n){var r=b;if(n.length){var l=vr(n,Xr(Ni));r|=se}return tr(e,r,t,n,l)}),lu=We(function(e,t,n){var r=b|h;if(n.length){var l=vr(n,Xr(lu));r|=se}return tr(t,r,e,n,l)});function uu(e,t,n){t=n?o:t;var r=tr(e,F,o,o,o,o,o,t);return r.placeholder=uu.placeholder,r}function du(e,t,n){t=n?o:t;var r=tr(e,j,o,o,o,o,o,t);return r.placeholder=du.placeholder,r}function cu(e,t,n){var r,l,f,_,O,R,X=0,ee=!1,ae=!1,be=!0;if(typeof e!="function")throw new Sn(w);t=An(t)||0,xt(n)&&(ee=!!n.leading,ae="maxWait"in n,f=ae?kt(An(n.maxWait)||0,t):f,be="trailing"in n?!!n.trailing:be);function De(Et){var kn=r,ir=l;return r=l=o,X=Et,_=e.apply(ir,kn),_}function ke(Et){return X=Et,O=_a(Ye,t),ee?De(Et):_}function He(Et){var kn=Et-R,ir=Et-X,Eu=t-kn;return ae?Bt(Eu,f-ir):Eu}function Re(Et){var kn=Et-R,ir=Et-X;return R===o||kn>=t||kn<0||ae&&ir>=f}function Ye(){var Et=go();if(Re(Et))return Qe(Et);O=_a(Ye,He(Et))}function Qe(Et){return O=o,be&&r?De(Et):(r=l=o,_)}function gn(){O!==o&&bl(O),X=0,r=R=l=O=o}function jt(){return O===o?_:Qe(go())}function yn(){var Et=go(),kn=Re(Et);if(r=arguments,l=this,R=Et,kn){if(O===o)return ke(R);if(ae)return bl(O),O=_a(Ye,t),De(R)}return O===o&&(O=_a(Ye,t)),_}return yn.cancel=gn,yn.flush=jt,yn}var Vp=We(function(e,t){return el(e,1,t)}),Fp=We(function(e,t,n){return el(e,An(t)||0,n)});function kp(e){return tr(e,K)}function yo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Sn(w);var n=function(){var r=arguments,l=t?t.apply(this,r):r[0],f=n.cache;if(f.has(l))return f.get(l);var _=e.apply(this,r);return n.cache=f.set(l,_)||f,_};return n.cache=new(yo.Cache||Xn),n}yo.Cache=Xn;function ho(e){if(typeof e!="function")throw new Sn(w);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Rp(e){return su(2,e)}var Lp=Cf(function(e,t){t=t.length==1&&ze(t[0])?bt(t[0],mn(Fe())):bt(zt(t,1),mn(Fe()));var n=t.length;return We(function(r){for(var l=-1,f=Bt(r.length,n);++l<f;)r[l]=t[l].call(this,r[l]);return fn(e,this,r)})}),$i=We(function(e,t){var n=vr(t,Xr($i));return tr(e,se,o,t,n)}),fu=We(function(e,t){var n=vr(t,Xr(fu));return tr(e,U,o,t,n)}),Up=nr(function(e,t){return tr(e,J,o,o,o,t)});function Mp(e,t){if(typeof e!="function")throw new Sn(w);return t=t===o?t:Ge(t),We(e,t)}function zp(e,t){if(typeof e!="function")throw new Sn(w);return t=t==null?0:kt(Ge(t),0),We(function(n){var r=n[t],l=wr(n,0,t);return r&&pr(l,r),fn(e,this,l)})}function qp(e,t,n){var r=!0,l=!0;if(typeof e!="function")throw new Sn(w);return xt(n)&&(r="leading"in n?!!n.leading:r,l="trailing"in n?!!n.trailing:l),cu(e,t,{leading:r,maxWait:t,trailing:l})}function Gp(e){return iu(e,1)}function Hp(e,t){return $i(yi(t),e)}function Bp(){if(!arguments.length)return[];var e=arguments[0];return ze(e)?e:[e]}function Wp(e){return Tn(e,E)}function Kp(e,t){return t=typeof t=="function"?t:o,Tn(e,E,t)}function Yp(e){return Tn(e,G|E)}function Jp(e,t){return t=typeof t=="function"?t:o,Tn(e,G|E,t)}function Zp(e,t){return t==null||Xs(e,t,Rt(t))}function Fn(e,t){return e===t||e!==e&&t!==t}var Qp=uo(oi),jp=uo(function(e,t){return e>=t}),Fr=ol(function(){return arguments}())?ol:function(e){return Ot(e)&&ut.call(e,"callee")&&!Bs.call(e,"callee")},ze=W.isArray,Xp=Ss?mn(Ss):sf;function rn(e){return e!=null&&_o(e.length)&&!ar(e)}function Dt(e){return Ot(e)&&rn(e)}function ev(e){return e===!0||e===!1||Ot(e)&&Zt(e)==Ve}var br=mc||Hi,tv=Os?mn(Os):lf;function nv(e){return Ot(e)&&e.nodeType===1&&!wa(e)}function rv(e){if(e==null)return!0;if(rn(e)&&(ze(e)||typeof e=="string"||typeof e.splice=="function"||br(e)||ea(e)||Fr(e)))return!e.length;var t=Wt(e);if(t==lt||t==Ie)return!e.size;if(ha(e))return!li(e).length;for(var n in e)if(ut.call(e,n))return!1;return!0}function av(e,t){return va(e,t)}function ov(e,t,n){n=typeof n=="function"?n:o;var r=n?n(e,t):o;return r===o?va(e,t,o,n):!!r}function Vi(e){if(!Ot(e))return!1;var t=Zt(e);return t==tt||t==At||typeof e.message=="string"&&typeof e.name=="string"&&!wa(e)}function iv(e){return typeof e=="number"&&Ks(e)}function ar(e){if(!xt(e))return!1;var t=Zt(e);return t==dt||t==mt||t==de||t==le}function mu(e){return typeof e=="number"&&e==Ge(e)}function _o(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Pe}function xt(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function Ot(e){return e!=null&&typeof e=="object"}var pu=Ts?mn(Ts):df;function sv(e,t){return e===t||si(e,t,Ci(t))}function lv(e,t,n){return n=typeof n=="function"?n:o,si(e,t,Ci(t),n)}function uv(e){return vu(e)&&e!=+e}function dv(e){if(Kf(e))throw new Me(x);return il(e)}function cv(e){return e===null}function fv(e){return e==null}function vu(e){return typeof e=="number"||Ot(e)&&Zt(e)==Ke}function wa(e){if(!Ot(e)||Zt(e)!=Ct)return!1;var t=Ba(e);if(t===null)return!0;var n=ut.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&za.call(n)==sc}var Fi=Ds?mn(Ds):cf;function mv(e){return mu(e)&&e>=-Pe&&e<=Pe}var gu=Es?mn(Es):ff;function wo(e){return typeof e=="string"||!ze(e)&&Ot(e)&&Zt(e)==wt}function vn(e){return typeof e=="symbol"||Ot(e)&&Zt(e)==pt}var ea=As?mn(As):mf;function pv(e){return e===o}function vv(e){return Ot(e)&&Wt(e)==ue}function gv(e){return Ot(e)&&Zt(e)==H}var yv=uo(ui),hv=uo(function(e,t){return e<=t});function yu(e){if(!e)return[];if(rn(e))return wo(e)?$n(e):nn(e);if(sa&&e[sa])return Jd(e[sa]());var t=Wt(e),n=t==lt?Zo:t==Ie?La:ta;return n(e)}function or(e){if(!e)return e===0?e:0;if(e=An(e),e===ye||e===-ye){var t=e<0?-1:1;return t*Ae}return e===e?e:0}function Ge(e){var t=or(e),n=t%1;return t===t?n?t-n:t:0}function hu(e){return e?Ar(Ge(e),0,Z):0}function An(e){if(typeof e=="number")return e;if(vn(e))return ie;if(xt(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=xt(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Rs(e);var n=aa.test(e);return n||Le.test(e)?Nd(e.slice(2),n?2:8):at.test(e)?ie:+e}function _u(e){return qn(e,an(e))}function _v(e){return e?Ar(Ge(e),-Pe,Pe):e===0?e:0}function st(e){return e==null?"":pn(e)}var wv=Qr(function(e,t){if(ha(t)||rn(t)){qn(t,Rt(t),e);return}for(var n in t)ut.call(t,n)&&fa(e,n,t[n])}),wu=Qr(function(e,t){qn(t,an(t),e)}),bo=Qr(function(e,t,n,r){qn(t,an(t),e,r)}),bv=Qr(function(e,t,n,r){qn(t,Rt(t),e,r)}),Iv=nr(ni);function Pv(e,t){var n=Zr(e);return t==null?n:js(n,t)}var Cv=We(function(e,t){e=ct(e);var n=-1,r=t.length,l=r>2?t[2]:o;for(l&&Qt(t[0],t[1],l)&&(r=1);++n<r;)for(var f=t[n],_=an(f),O=-1,R=_.length;++O<R;){var X=_[O],ee=e[X];(ee===o||Fn(ee,Kr[X])&&!ut.call(e,X))&&(e[X]=f[X])}return e}),xv=We(function(e){return e.push(o,Rl),fn(bu,o,e)});function Sv(e,t){return $s(e,Fe(t,3),zn)}function Ov(e,t){return $s(e,Fe(t,3),ai)}function Tv(e,t){return e==null?e:ri(e,Fe(t,3),an)}function Dv(e,t){return e==null?e:rl(e,Fe(t,3),an)}function Ev(e,t){return e&&zn(e,Fe(t,3))}function Av(e,t){return e&&ai(e,Fe(t,3))}function Nv(e){return e==null?[]:to(e,Rt(e))}function $v(e){return e==null?[]:to(e,an(e))}function ki(e,t,n){var r=e==null?o:Nr(e,t);return r===o?n:r}function Vv(e,t){return e!=null&&Ml(e,t,nf)}function Ri(e,t){return e!=null&&Ml(e,t,rf)}var Fv=Nl(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=qa.call(t)),e[t]=n},Ui(on)),kv=Nl(function(e,t,n){t!=null&&typeof t.toString!="function"&&(t=qa.call(t)),ut.call(e,t)?e[t].push(n):e[t]=[n]},Fe),Rv=We(pa);function Rt(e){return rn(e)?Zs(e):li(e)}function an(e){return rn(e)?Zs(e,!0):pf(e)}function Lv(e,t){var n={};return t=Fe(t,3),zn(e,function(r,l,f){er(n,t(r,l,f),r)}),n}function Uv(e,t){var n={};return t=Fe(t,3),zn(e,function(r,l,f){er(n,l,t(r,l,f))}),n}var Mv=Qr(function(e,t,n){no(e,t,n)}),bu=Qr(function(e,t,n,r){no(e,t,n,r)}),zv=nr(function(e,t){var n={};if(e==null)return n;var r=!1;t=bt(t,function(f){return f=_r(f,e),r||(r=f.length>1),f}),qn(e,Ii(e),n),r&&(n=Tn(n,G|D|E,Ff));for(var l=t.length;l--;)pi(n,t[l]);return n});function qv(e,t){return Iu(e,ho(Fe(t)))}var Gv=nr(function(e,t){return e==null?{}:gf(e,t)});function Iu(e,t){if(e==null)return{};var n=bt(Ii(e),function(r){return[r]});return t=Fe(t),ml(e,n,function(r,l){return t(r,l[0])})}function Hv(e,t,n){t=_r(t,e);var r=-1,l=t.length;for(l||(l=1,e=o);++r<l;){var f=e==null?o:e[Gn(t[r])];f===o&&(r=l,f=n),e=ar(f)?f.call(e):f}return e}function Bv(e,t,n){return e==null?e:ga(e,t,n)}function Wv(e,t,n,r){return r=typeof r=="function"?r:o,e==null?e:ga(e,t,n,r)}var Pu=Fl(Rt),Cu=Fl(an);function Kv(e,t,n){var r=ze(e),l=r||br(e)||ea(e);if(t=Fe(t,4),n==null){var f=e&&e.constructor;l?n=r?new f:[]:xt(e)?n=ar(f)?Zr(Ba(e)):{}:n={}}return(l?xn:zn)(e,function(_,O,R){return t(n,_,O,R)}),n}function Yv(e,t){return e==null?!0:pi(e,t)}function Jv(e,t,n){return e==null?e:hl(e,t,yi(n))}function Zv(e,t,n,r){return r=typeof r=="function"?r:o,e==null?e:hl(e,t,yi(n),r)}function ta(e){return e==null?[]:Jo(e,Rt(e))}function Qv(e){return e==null?[]:Jo(e,an(e))}function jv(e,t,n){return n===o&&(n=t,t=o),n!==o&&(n=An(n),n=n===n?n:0),t!==o&&(t=An(t),t=t===t?t:0),Ar(An(e),t,n)}function Xv(e,t,n){return t=or(t),n===o?(n=t,t=0):n=or(n),e=An(e),af(e,t,n)}function eg(e,t,n){if(n&&typeof n!="boolean"&&Qt(e,t,n)&&(t=n=o),n===o&&(typeof t=="boolean"?(n=t,t=o):typeof e=="boolean"&&(n=e,e=o)),e===o&&t===o?(e=0,t=1):(e=or(e),t===o?(t=e,e=0):t=or(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var l=Ys();return Bt(e+l*(t-e+Ad("1e-"+((l+"").length-1))),t)}return ci(e,t)}var tg=jr(function(e,t,n){return t=t.toLowerCase(),e+(n?xu(t):t)});function xu(e){return Li(st(e).toLowerCase())}function Su(e){return e=st(e),e&&e.replace(Va,Hd).replace(bd,"")}function ng(e,t,n){e=st(e),t=pn(t);var r=e.length;n=n===o?r:Ar(Ge(n),0,r);var l=n;return n-=t.length,n>=0&&e.slice(n,l)==t}function rg(e){return e=st(e),e&&fr.test(e)?e.replace(Jn,Bd):e}function ag(e){return e=st(e),e&&Ta.test(e)?e.replace(Lr,"\\$&"):e}var og=jr(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),ig=jr(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),sg=Dl("toLowerCase");function lg(e,t,n){e=st(e),t=Ge(t);var r=t?Br(e):0;if(!t||r>=t)return e;var l=(t-r)/2;return lo(Ja(l),n)+e+lo(Ya(l),n)}function ug(e,t,n){e=st(e),t=Ge(t);var r=t?Br(e):0;return t&&r<t?e+lo(t-r,n):e}function dg(e,t,n){e=st(e),t=Ge(t);var r=t?Br(e):0;return t&&r<t?lo(t-r,n)+e:e}function cg(e,t,n){return n||t==null?t=0:t&&(t=+t),yc(st(e).replace(Ur,""),t||0)}function fg(e,t,n){return(n?Qt(e,t,n):t===o)?t=1:t=Ge(t),fi(st(e),t)}function mg(){var e=arguments,t=st(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var pg=jr(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});function vg(e,t,n){return n&&typeof n!="number"&&Qt(e,t,n)&&(t=n=o),n=n===o?Z:n>>>0,n?(e=st(e),e&&(typeof t=="string"||t!=null&&!Fi(t))&&(t=pn(t),!t&&Hr(e))?wr($n(e),0,n):e.split(t,n)):[]}var gg=jr(function(e,t,n){return e+(n?" ":"")+Li(t)});function yg(e,t,n){return e=st(e),n=n==null?0:Ar(Ge(n),0,e.length),t=pn(t),e.slice(n,n+t.length)==t}function hg(e,t,n){var r=c.templateSettings;n&&Qt(e,t,n)&&(t=o),e=st(e),t=bo({},t,r,kl);var l=bo({},t.imports,r.imports,kl),f=Rt(l),_=Jo(l,f),O,R,X=0,ee=t.interpolate||et,ae="__p += '",be=Qo((t.escape||et).source+"|"+ee.source+"|"+(ee===Qn?Na:et).source+"|"+(t.evaluate||et).source+"|$","g"),De="//# sourceURL="+(ut.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Sd+"]")+`
`;e.replace(be,function(Re,Ye,Qe,gn,jt,yn){return Qe||(Qe=gn),ae+=e.slice(X,yn).replace(Ut,Wd),Ye&&(O=!0,ae+=`' +
__e(`+Ye+`) +
'`),jt&&(R=!0,ae+=`';
`+jt+`;
__p += '`),Qe&&(ae+=`' +
((__t = (`+Qe+`)) == null ? '' : __t) +
'`),X=yn+Re.length,Re}),ae+=`';
`;var ke=ut.call(t,"variable")&&t.variable;if(!ke)ae=`with (obj) {
`+ae+`
}
`;else if(Mr.test(ke))throw new Me(p);ae=(R?ae.replace(Cr,""):ae).replace(ot,"$1").replace(cn,"$1;"),ae="function("+(ke||"obj")+`) {
`+(ke?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(O?", __e = _.escape":"")+(R?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ae+`return __p
}`;var He=Tu(function(){return it(f,De+"return "+ae).apply(o,_)});if(He.source=ae,Vi(He))throw He;return He}function _g(e){return st(e).toLowerCase()}function wg(e){return st(e).toUpperCase()}function bg(e,t,n){if(e=st(e),e&&(n||t===o))return Rs(e);if(!e||!(t=pn(t)))return e;var r=$n(e),l=$n(t),f=Ls(r,l),_=Us(r,l)+1;return wr(r,f,_).join("")}function Ig(e,t,n){if(e=st(e),e&&(n||t===o))return e.slice(0,zs(e)+1);if(!e||!(t=pn(t)))return e;var r=$n(e),l=Us(r,$n(t))+1;return wr(r,0,l).join("")}function Pg(e,t,n){if(e=st(e),e&&(n||t===o))return e.replace(Ur,"");if(!e||!(t=pn(t)))return e;var r=$n(e),l=Ls(r,$n(t));return wr(r,l).join("")}function Cg(e,t){var n=T,r=re;if(xt(t)){var l="separator"in t?t.separator:l;n="length"in t?Ge(t.length):n,r="omission"in t?pn(t.omission):r}e=st(e);var f=e.length;if(Hr(e)){var _=$n(e);f=_.length}if(n>=f)return e;var O=n-Br(r);if(O<1)return r;var R=_?wr(_,0,O).join(""):e.slice(0,O);if(l===o)return R+r;if(_&&(O+=R.length-O),Fi(l)){if(e.slice(O).search(l)){var X,ee=R;for(l.global||(l=Qo(l.source,st(zr.exec(l))+"g")),l.lastIndex=0;X=l.exec(ee);)var ae=X.index;R=R.slice(0,ae===o?O:ae)}}else if(e.indexOf(pn(l),O)!=O){var be=R.lastIndexOf(l);be>-1&&(R=R.slice(0,be))}return R+r}function xg(e){return e=st(e),e&&ra.test(e)?e.replace(Ht,Xd):e}var Sg=jr(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Li=Dl("toUpperCase");function Ou(e,t,n){return e=st(e),t=n?o:t,t===o?Yd(e)?nc(e):Ud(e):e.match(t)||[]}var Tu=We(function(e,t){try{return fn(e,o,t)}catch(n){return Vi(n)?n:new Me(n)}}),Og=nr(function(e,t){return xn(t,function(n){n=Gn(n),er(e,n,Ni(e[n],e))}),e});function Tg(e){var t=e==null?0:e.length,n=Fe();return e=t?bt(e,function(r){if(typeof r[1]!="function")throw new Sn(w);return[n(r[0]),r[1]]}):[],We(function(r){for(var l=-1;++l<t;){var f=e[l];if(fn(f[0],this,r))return fn(f[1],this,r)}})}function Dg(e){return Xc(Tn(e,G))}function Ui(e){return function(){return e}}function Eg(e,t){return e==null||e!==e?t:e}var Ag=Al(),Ng=Al(!0);function on(e){return e}function Mi(e){return sl(typeof e=="function"?e:Tn(e,G))}function $g(e){return ul(Tn(e,G))}function Vg(e,t){return dl(e,Tn(t,G))}var Fg=We(function(e,t){return function(n){return pa(n,e,t)}}),kg=We(function(e,t){return function(n){return pa(e,n,t)}});function zi(e,t,n){var r=Rt(t),l=to(t,r);n==null&&!(xt(t)&&(l.length||!r.length))&&(n=t,t=e,e=this,l=to(t,Rt(t)));var f=!(xt(n)&&"chain"in n)||!!n.chain,_=ar(e);return xn(l,function(O){var R=t[O];e[O]=R,_&&(e.prototype[O]=function(){var X=this.__chain__;if(f||X){var ee=e(this.__wrapped__),ae=ee.__actions__=nn(this.__actions__);return ae.push({func:R,args:arguments,thisArg:e}),ee.__chain__=X,ee}return R.apply(e,pr([this.value()],arguments))})}),e}function Rg(){return Mt._===this&&(Mt._=lc),this}function qi(){}function Lg(e){return e=Ge(e),We(function(t){return cl(t,e)})}var Ug=_i(bt),Mg=_i(Ns),zg=_i(Ho);function Du(e){return Si(e)?Bo(Gn(e)):yf(e)}function qg(e){return function(t){return e==null?o:Nr(e,t)}}var Gg=$l(),Hg=$l(!0);function Gi(){return[]}function Hi(){return!1}function Bg(){return{}}function Wg(){return""}function Kg(){return!0}function Yg(e,t){if(e=Ge(e),e<1||e>Pe)return[];var n=Z,r=Bt(e,Z);t=Fe(t),e-=Z;for(var l=Yo(r,t);++n<e;)t(n);return l}function Jg(e){return ze(e)?bt(e,Gn):vn(e)?[e]:nn(Jl(st(e)))}function Zg(e){var t=++ic;return st(e)+t}var Qg=so(function(e,t){return e+t},0),jg=wi("ceil"),Xg=so(function(e,t){return e/t},1),ey=wi("floor");function ty(e){return e&&e.length?eo(e,on,oi):o}function ny(e,t){return e&&e.length?eo(e,Fe(t,2),oi):o}function ry(e){return Fs(e,on)}function ay(e,t){return Fs(e,Fe(t,2))}function oy(e){return e&&e.length?eo(e,on,ui):o}function iy(e,t){return e&&e.length?eo(e,Fe(t,2),ui):o}var sy=so(function(e,t){return e*t},1),ly=wi("round"),uy=so(function(e,t){return e-t},0);function dy(e){return e&&e.length?Ko(e,on):0}function cy(e,t){return e&&e.length?Ko(e,Fe(t,2)):0}return c.after=$p,c.ary=iu,c.assign=wv,c.assignIn=wu,c.assignInWith=bo,c.assignWith=bv,c.at=Iv,c.before=su,c.bind=Ni,c.bindAll=Og,c.bindKey=lu,c.castArray=Bp,c.chain=ru,c.chunk=em,c.compact=tm,c.concat=nm,c.cond=Tg,c.conforms=Dg,c.constant=Ui,c.countBy=dp,c.create=Pv,c.curry=uu,c.curryRight=du,c.debounce=cu,c.defaults=Cv,c.defaultsDeep=xv,c.defer=Vp,c.delay=Fp,c.difference=rm,c.differenceBy=am,c.differenceWith=om,c.drop=im,c.dropRight=sm,c.dropRightWhile=lm,c.dropWhile=um,c.fill=dm,c.filter=fp,c.flatMap=vp,c.flatMapDeep=gp,c.flatMapDepth=yp,c.flatten=Xl,c.flattenDeep=cm,c.flattenDepth=fm,c.flip=kp,c.flow=Ag,c.flowRight=Ng,c.fromPairs=mm,c.functions=Nv,c.functionsIn=$v,c.groupBy=hp,c.initial=vm,c.intersection=gm,c.intersectionBy=ym,c.intersectionWith=hm,c.invert=Fv,c.invertBy=kv,c.invokeMap=wp,c.iteratee=Mi,c.keyBy=bp,c.keys=Rt,c.keysIn=an,c.map=vo,c.mapKeys=Lv,c.mapValues=Uv,c.matches=$g,c.matchesProperty=Vg,c.memoize=yo,c.merge=Mv,c.mergeWith=bu,c.method=Fg,c.methodOf=kg,c.mixin=zi,c.negate=ho,c.nthArg=Lg,c.omit=zv,c.omitBy=qv,c.once=Rp,c.orderBy=Ip,c.over=Ug,c.overArgs=Lp,c.overEvery=Mg,c.overSome=zg,c.partial=$i,c.partialRight=fu,c.partition=Pp,c.pick=Gv,c.pickBy=Iu,c.property=Du,c.propertyOf=qg,c.pull=Im,c.pullAll=tu,c.pullAllBy=Pm,c.pullAllWith=Cm,c.pullAt=xm,c.range=Gg,c.rangeRight=Hg,c.rearg=Up,c.reject=Sp,c.remove=Sm,c.rest=Mp,c.reverse=Ei,c.sampleSize=Tp,c.set=Bv,c.setWith=Wv,c.shuffle=Dp,c.slice=Om,c.sortBy=Np,c.sortedUniq=Vm,c.sortedUniqBy=Fm,c.split=vg,c.spread=zp,c.tail=km,c.take=Rm,c.takeRight=Lm,c.takeRightWhile=Um,c.takeWhile=Mm,c.tap=tp,c.throttle=qp,c.thru=po,c.toArray=yu,c.toPairs=Pu,c.toPairsIn=Cu,c.toPath=Jg,c.toPlainObject=_u,c.transform=Kv,c.unary=Gp,c.union=zm,c.unionBy=qm,c.unionWith=Gm,c.uniq=Hm,c.uniqBy=Bm,c.uniqWith=Wm,c.unset=Yv,c.unzip=Ai,c.unzipWith=nu,c.update=Jv,c.updateWith=Zv,c.values=ta,c.valuesIn=Qv,c.without=Km,c.words=Ou,c.wrap=Hp,c.xor=Ym,c.xorBy=Jm,c.xorWith=Zm,c.zip=Qm,c.zipObject=jm,c.zipObjectDeep=Xm,c.zipWith=ep,c.entries=Pu,c.entriesIn=Cu,c.extend=wu,c.extendWith=bo,zi(c,c),c.add=Qg,c.attempt=Tu,c.camelCase=tg,c.capitalize=xu,c.ceil=jg,c.clamp=jv,c.clone=Wp,c.cloneDeep=Yp,c.cloneDeepWith=Jp,c.cloneWith=Kp,c.conformsTo=Zp,c.deburr=Su,c.defaultTo=Eg,c.divide=Xg,c.endsWith=ng,c.eq=Fn,c.escape=rg,c.escapeRegExp=ag,c.every=cp,c.find=mp,c.findIndex=Ql,c.findKey=Sv,c.findLast=pp,c.findLastIndex=jl,c.findLastKey=Ov,c.floor=ey,c.forEach=au,c.forEachRight=ou,c.forIn=Tv,c.forInRight=Dv,c.forOwn=Ev,c.forOwnRight=Av,c.get=ki,c.gt=Qp,c.gte=jp,c.has=Vv,c.hasIn=Ri,c.head=eu,c.identity=on,c.includes=_p,c.indexOf=pm,c.inRange=Xv,c.invoke=Rv,c.isArguments=Fr,c.isArray=ze,c.isArrayBuffer=Xp,c.isArrayLike=rn,c.isArrayLikeObject=Dt,c.isBoolean=ev,c.isBuffer=br,c.isDate=tv,c.isElement=nv,c.isEmpty=rv,c.isEqual=av,c.isEqualWith=ov,c.isError=Vi,c.isFinite=iv,c.isFunction=ar,c.isInteger=mu,c.isLength=_o,c.isMap=pu,c.isMatch=sv,c.isMatchWith=lv,c.isNaN=uv,c.isNative=dv,c.isNil=fv,c.isNull=cv,c.isNumber=vu,c.isObject=xt,c.isObjectLike=Ot,c.isPlainObject=wa,c.isRegExp=Fi,c.isSafeInteger=mv,c.isSet=gu,c.isString=wo,c.isSymbol=vn,c.isTypedArray=ea,c.isUndefined=pv,c.isWeakMap=vv,c.isWeakSet=gv,c.join=_m,c.kebabCase=og,c.last=En,c.lastIndexOf=wm,c.lowerCase=ig,c.lowerFirst=sg,c.lt=yv,c.lte=hv,c.max=ty,c.maxBy=ny,c.mean=ry,c.meanBy=ay,c.min=oy,c.minBy=iy,c.stubArray=Gi,c.stubFalse=Hi,c.stubObject=Bg,c.stubString=Wg,c.stubTrue=Kg,c.multiply=sy,c.nth=bm,c.noConflict=Rg,c.noop=qi,c.now=go,c.pad=lg,c.padEnd=ug,c.padStart=dg,c.parseInt=cg,c.random=eg,c.reduce=Cp,c.reduceRight=xp,c.repeat=fg,c.replace=mg,c.result=Hv,c.round=ly,c.runInContext=A,c.sample=Op,c.size=Ep,c.snakeCase=pg,c.some=Ap,c.sortedIndex=Tm,c.sortedIndexBy=Dm,c.sortedIndexOf=Em,c.sortedLastIndex=Am,c.sortedLastIndexBy=Nm,c.sortedLastIndexOf=$m,c.startCase=gg,c.startsWith=yg,c.subtract=uy,c.sum=dy,c.sumBy=cy,c.template=hg,c.times=Yg,c.toFinite=or,c.toInteger=Ge,c.toLength=hu,c.toLower=_g,c.toNumber=An,c.toSafeInteger=_v,c.toString=st,c.toUpper=wg,c.trim=bg,c.trimEnd=Ig,c.trimStart=Pg,c.truncate=Cg,c.unescape=xg,c.uniqueId=Zg,c.upperCase=Sg,c.upperFirst=Li,c.each=au,c.eachRight=ou,c.first=eu,zi(c,function(){var e={};return zn(c,function(t,n){ut.call(c.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),c.VERSION=v,xn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){c[e].placeholder=c}),xn(["drop","take"],function(e,t){Je.prototype[e]=function(n){n=n===o?1:kt(Ge(n),0);var r=this.__filtered__&&!t?new Je(this):this.clone();return r.__filtered__?r.__takeCount__=Bt(n,r.__takeCount__):r.__views__.push({size:Bt(n,Z),type:e+(r.__dir__<0?"Right":"")}),r},Je.prototype[e+"Right"]=function(n){return this.reverse()[e](n).reverse()}}),xn(["filter","map","takeWhile"],function(e,t){var n=t+1,r=n==me||n==ge;Je.prototype[e]=function(l){var f=this.clone();return f.__iteratees__.push({iteratee:Fe(l,3),type:n}),f.__filtered__=f.__filtered__||r,f}}),xn(["head","last"],function(e,t){var n="take"+(t?"Right":"");Je.prototype[e]=function(){return this[n](1).value()[0]}}),xn(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");Je.prototype[e]=function(){return this.__filtered__?new Je(this):this[n](1)}}),Je.prototype.compact=function(){return this.filter(on)},Je.prototype.find=function(e){return this.filter(e).head()},Je.prototype.findLast=function(e){return this.reverse().find(e)},Je.prototype.invokeMap=We(function(e,t){return typeof e=="function"?new Je(this):this.map(function(n){return pa(n,e,t)})}),Je.prototype.reject=function(e){return this.filter(ho(Fe(e)))},Je.prototype.slice=function(e,t){e=Ge(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Je(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==o&&(t=Ge(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},Je.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Je.prototype.toArray=function(){return this.take(Z)},zn(Je.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),l=c[r?"take"+(t=="last"?"Right":""):t],f=r||/^find/.test(t);l&&(c.prototype[t]=function(){var _=this.__wrapped__,O=r?[1]:arguments,R=_ instanceof Je,X=O[0],ee=R||ze(_),ae=function(Ye){var Qe=l.apply(c,pr([Ye],O));return r&&be?Qe[0]:Qe};ee&&n&&typeof X=="function"&&X.length!=1&&(R=ee=!1);var be=this.__chain__,De=!!this.__actions__.length,ke=f&&!be,He=R&&!De;if(!f&&ee){_=He?_:new Je(this);var Re=e.apply(_,O);return Re.__actions__.push({func:po,args:[ae],thisArg:o}),new On(Re,be)}return ke&&He?e.apply(this,O):(Re=this.thru(ae),ke?r?Re.value()[0]:Re.value():Re)})}),xn(["pop","push","shift","sort","splice","unshift"],function(e){var t=Ua[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);c.prototype[e]=function(){var l=arguments;if(r&&!this.__chain__){var f=this.value();return t.apply(ze(f)?f:[],l)}return this[n](function(_){return t.apply(ze(_)?_:[],l)})}}),zn(Je.prototype,function(e,t){var n=c[t];if(n){var r=n.name+"";ut.call(Jr,r)||(Jr[r]=[]),Jr[r].push({name:t,func:n})}}),Jr[io(o,h).name]=[{name:"wrapper",func:o}],Je.prototype.clone=Cc,Je.prototype.reverse=xc,Je.prototype.value=Sc,c.prototype.at=np,c.prototype.chain=rp,c.prototype.commit=ap,c.prototype.next=op,c.prototype.plant=sp,c.prototype.reverse=lp,c.prototype.toJSON=c.prototype.valueOf=c.prototype.value=up,c.prototype.first=c.prototype.head,sa&&(c.prototype[sa]=ip),c},Wr=rc();Or?((Or.exports=Wr)._=Wr,Mo._=Wr):Mt._=Wr}).call(sr)})(Do,Do.exports);var Rh=Do.exports;const Lh={class:"search-wrapper"},Uh={__name:"ProductSearch",emits:["search","quickAdd"],setup(s,{emit:u}){const o=z(""),v=z(!1),{mobile:m}=Ku(),x=_e(()=>m.value),w=u,p={NUMERIC:/^\d{4,}$/,ALPHANUMERIC:/^[A-Z]\d{3,}$/,DASHED:/^[A-Z0-9]+-[A-Z0-9]+$/};let V,C="",S;const G=g=>{if(!g||g.length<4)return!1;const b=g.toUpperCase();return Object.values(p).some(h=>h.test(b))},D=g=>{if(!g){E();return}v.value=!0,clearTimeout(V),clearTimeout(S),C=g,G(g)?(d.debug("Potential SKU detected:",{value:g}),S=setTimeout(()=>{d.info("Processing SKU:",{sku:C}),w("quickAdd",C),E()},1e3)):V=setTimeout(()=>{d.debug("Processing search:",{query:g}),w("search",g),v.value=!1},300)},E=()=>{o.value="",C="",clearTimeout(V),clearTimeout(S),w("search",""),v.value=!1},P=()=>{const g=o.value.trim();g&&(clearTimeout(S),G(g)?(d.info("Manual SKU entry:",{sku:g}),w("quickAdd",g)):(d.info("Manual search entry:",{query:g}),w("search",g)),E())};return(g,b)=>(B(),he("div",Lh,[a(Gu,null,{default:i(()=>[a(ft,{modelValue:o.value,"onUpdate:modelValue":[b[0]||(b[0]=h=>o.value=h),D],placeholder:x.value?"Search...":"Search products...",label:x.value?null:"Search Products",density:"comfortable",variant:"outlined","hide-details":"",class:Gt(["search-field",{"is-mobile":x.value}]),"bg-color":"white",loading:v.value,clearable:"","onClick:clear":E,onKeyup:Ny(P,["enter"])},{"prepend-inner":i(()=>[a(Te,{color:"primary",class:Gt({"search-icon-animated":v.value})},{default:i(()=>b[1]||(b[1]=[q(" mdi-magnify ")])),_:1},8,["class"])]),_:1},8,["modelValue","placeholder","label","class","loading"])]),_:1})]))}},Mh=_t(Uh,[["__scopeId","data-v-b1e13e44"]]);const zh={class:"category-tabs-wrapper"},qh={__name:"CategoryTabs",props:{categories:{type:Array,required:!0}},emits:["change"],setup(s){const u=z("all");return(o,v)=>(B(),he("div",zh,[a(Hu,{modelValue:u.value,"onUpdate:modelValue":[v[0]||(v[0]=m=>u.value=m),v[1]||(v[1]=m=>o.$emit("change",u.value))],density:"comfortable","show-arrows":"","slider-color":"primary","selected-class":"v-tab--selected",class:"category-tabs","bg-color":"white"},{default:i(()=>[(B(!0),he(gt,null,en(s.categories,m=>(B(),Se(Co,{key:m.id,value:m.id,class:"category-tab",ripple:!1},{default:i(()=>[m.icon?(B(),Se(Te,{key:0,start:"",icon:m.icon,size:"18",class:"me-1"},null,8,["icon"])):Ne("",!0),q(" "+te(m.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]))}},Gh=_t(qh,[["__scopeId","data-v-ad292143"]]);const Hh={class:"product-grid-container"},Bh={class:"product-grid-scroll"},Wh={class:"product-grid ma-0"},Kh={class:"d-flex align-center justify-center fill-height"},Yh={class:"product-info"},Jh={class:"product-title px-3 pt-3"},Zh={class:"d-flex align-center justify-space-between px-3 pb-3"},Qh={class:"text-primary price-text"},jh={key:1,class:"d-flex align-center pa-3"},Xh={class:"flex-grow-1"},e1={class:"product-title mb-1"},t1={class:"text-primary price-text"},n1={key:0,class:"pagination-wrapper"},r1={__name:"ProductGrid",props:{products:{type:Array,required:!0},gridSettings:{type:Object,required:!0}},emits:["select"],setup(s,{emit:u}){$y(E=>({b88c3364:s.gridSettings.columns,c19bd192:E.getCardHeight}));const o=s,v=u,m=z(1),x=_e(()=>o.gridSettings.rows===-1?o.products.length:o.gridSettings.rows*o.gridSettings.columns),w=_e(()=>{const E=(m.value-1)*x.value,P=E+x.value;return o.products.slice(E,P)}),p=_e(()=>o.gridSettings.rows===-1?1:Math.ceil(o.products.length/x.value));Be(()=>o.products,()=>{m.value=1},{immediate:!0});const V=E=>{m.value=E,d.debug("ProductGrid - Page changed:",{page:E,totalItems:o.products.length})},C=E=>{d.debug("ProductGrid - Product selected:",{id:E.id,name:E.name,price:E.price}),v("select",E)},S=E=>xe.format(E),G=E=>E.image_url||"/placeholder-product.png",D=_e(()=>{switch(o.gridSettings.layout){case"compact":return 120;case"comfortable":return 160;default:return 140}});return(E,P)=>(B(),he("div",Hh,[y("div",Bh,[y("div",Wh,[(B(!0),he(gt,null,en(w.value,g=>(B(),he("div",{key:g.id,class:"product-grid-item"},[a(Ze,{elevation:"0",class:Gt(["product-card",[s.gridSettings.layout,"rounded-lg"]]),onClick:b=>C(g)},{default:i(()=>[s.gridSettings.layout!=="list"?(B(),he(gt,{key:0},[a(gy,{src:G(g),height:D.value,cover:"",class:"bg-grey-lighten-2"},{placeholder:i(()=>[y("div",Kh,[a(Nn,{color:"grey-lighten-4",indeterminate:"",size:"20"})])]),_:2},1032,["src","height"]),y("div",Yh,[y("div",Jh,te(g.name),1),y("div",Zh,[y("span",Qh,te(S(g.sale_price||g.price)),1),a(pe,{density:"comfortable",variant:"tonal",color:"primary",size:"small",icon:"mdi-plus",class:"add-btn"})])])],64)):(B(),he("div",jh,[y("div",Xh,[y("div",e1,te(g.name),1),y("div",t1,te(S(g.sale_price||g.price)),1)]),a(pe,{density:"comfortable",variant:"tonal",color:"primary",size:"small",icon:"mdi-plus",class:"add-btn ms-2"})]))]),_:2},1032,["class","onClick"])]))),128))])]),o.gridSettings.rows!==-1?(B(),he("div",n1,[a(Eo,{modelValue:m.value,"onUpdate:modelValue":[P[0]||(P[0]=g=>m.value=g),V],length:p.value,"total-visible":7,density:"compact"},null,8,["modelValue","length"])])):Ne("",!0)]))}},a1=_t(r1,[["__scopeId","data-v-1da473db"]]);const o1={class:"grid-settings pa-4"},i1={class:"d-flex align-center"},s1={__name:"GridSettings",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(s,{emit:u}){const o=s,v=u;Ku();const m={layout:"comfortable",columns:4,rows:-1},x=z(o.modelValue.layout),w=z(o.modelValue.columns),p=z(o.modelValue.rows||m.rows),V=[{title:"2 Items",value:2},{title:"4 Items",value:4},{title:"6 Items",value:6},{title:"8 Items",value:8}],C=[{title:"2 Rows",value:2},{title:"3 Rows",value:3},{title:"4 Rows",value:4},{title:"Show All",value:-1}];Be(()=>o.modelValue,P=>{x.value=P.layout,w.value=P.columns,p.value=P.rows||m.rows},{deep:!0});const S=P=>{const g={...o.modelValue,layout:P};P==="list"?g.columns=2:g.columns=4,g.rows=-1,v("update:modelValue",g)},G=P=>{v("update:modelValue",{...o.modelValue,columns:P})},D=P=>{v("update:modelValue",{...o.modelValue,rows:P})},E=()=>{v("update:modelValue",{...m})};return(P,g)=>(B(),he("div",o1,[a(Ze,{flat:"",class:"mb-6"},{default:i(()=>[a(ht,{class:"text-body-1"},{default:i(()=>g[3]||(g[3]=[q(" Customize how products are displayed in your POS grid. Adjust the layout, number of items per row, and number of rows to optimize for your screen size and workflow. ")])),_:1})]),_:1}),a(hy,null,{default:i(()=>[y("div",i1,[a(Pa,{location:"top",text:"Set how many product cards appear in each row of the grid"},{activator:i(({props:b})=>[a(hn,Wn(b,{modelValue:w.value,"onUpdate:modelValue":[g[0]||(g[0]=h=>w.value=h),G],items:V,label:"Items per row",density:"compact","hide-details":"",variant:"outlined",class:"grid-select elevation-1","bg-color":"white","menu-props":{maxHeight:200}}),{"prepend-inner":i(()=>[a(Te,{size:"small",color:"primary"},{default:i(()=>g[4]||(g[4]=[q("mdi-view-grid-outline")])),_:1})]),_:2},1040,["modelValue"])]),_:1}),a(Pa,{location:"top",text:"Set how many rows of products to display before pagination"},{activator:i(({props:b})=>[a(hn,Wn(b,{modelValue:p.value,"onUpdate:modelValue":[g[1]||(g[1]=h=>p.value=h),D],items:C,label:"Rows",density:"compact","hide-details":"",variant:"outlined",class:"grid-select me-3 mb-2 elevation-1","bg-color":"white","menu-props":{maxHeight:200}}),{"prepend-inner":i(()=>[a(Te,{size:"small",color:"primary"},{default:i(()=>g[5]||(g[5]=[q("mdi-view-sequential")])),_:1})]),_:2},1040,["modelValue"])]),_:1}),a(Pa,{location:"top",text:"Choose how products are displayed: Large (spacious), Compact (smaller cards), or List view"},{activator:i(({props:b})=>[a(yy,Wn(b,{modelValue:x.value,"onUpdate:modelValue":[g[2]||(g[2]=h=>x.value=h),S],mandatory:"",density:"compact",rounded:"lg",class:"grid-toggle mb-2 elevation-1"}),{default:i(()=>[a(pe,{value:"comfortable",size:"small","prepend-icon":"mdi-view-grid",class:"grid-btn",ripple:!1},{default:i(()=>[g[7]||(g[7]=y("span",{class:"d-none d-sm-inline"},"Large",-1)),a(Te,{class:"d-sm-none"},{default:i(()=>g[6]||(g[6]=[q("mdi-view-grid")])),_:1})]),_:1}),a(pe,{value:"compact",size:"small","prepend-icon":"mdi-view-grid-compact",class:"grid-btn",ripple:!1},{default:i(()=>[g[9]||(g[9]=y("span",{class:"d-none d-sm-inline"},"Compact",-1)),a(Te,{class:"d-sm-none"},{default:i(()=>g[8]||(g[8]=[q("mdi-view-grid-compact")])),_:1})]),_:1}),a(pe,{value:"list",size:"small","prepend-icon":"mdi-view-list",class:"grid-btn",ripple:!1},{default:i(()=>[g[11]||(g[11]=y("span",{class:"d-none d-sm-inline"},"List",-1)),a(Te,{class:"d-sm-none"},{default:i(()=>g[10]||(g[10]=[q("mdi-view-list")])),_:1})]),_:1})]),_:2},1040,["modelValue"])]),_:1}),a(Pa,{location:"top",text:"Reset to default settings"},{activator:i(({props:b})=>[a(pe,Wn(b,{icon:"mdi-refresh",variant:"text",size:"small",color:"grey-darken-1",class:"ms-1",onClick:E}),null,16)]),_:1})])]),_:1})]))}},l1=_t(s1,[["__scopeId","data-v-f6d314ad"]]);const u1={class:"pos-products-container"},d1={class:"products-header"},c1={class:"search-field"},f1={class:"products-scroll-container"},m1={key:0,class:"products-preloading-state"},p1={key:1,class:"products-loading-state"},v1={key:2,class:"products-grid-container"},g1={__name:"PosProducts",setup(s){const u=z(!1);z(!1);const o=z(!1),v=z(0),m=dr(),x=Yt(),w=_e(()=>Rh.uniqBy(m.products,"id")),p=z(JSON.parse(localStorage.getItem("gridSettings"))||{layout:"comfortable",columns:4,rows:3}),V=h=>{p.value=h,localStorage.setItem("gridSettings",JSON.stringify(h)),u.value=!1};Be(p,h=>{localStorage.setItem("gridSettings",JSON.stringify(h))},{deep:!0}),cr(async()=>{d.startGroup("POS Products Component: Mount");try{await m.initialize()}catch(h){d.error("Error during initialization",h)}finally{d.endGroup()}});const C=z(1),S=z(50),G=_e(()=>Math.ceil(m.totalItems/S.value)),D=async h=>{d.startGroup("POS Products: Search");try{m.searchQuery=h,C.value=1,await m.fetchProducts(C.value,S.value)}catch(I){d.error("Search failed",I)}finally{d.endGroup()}},E=async h=>{d.startGroup("POS Products: Page Change");try{await m.fetchProducts(h,S.value)}catch(I){d.error("Page change failed",I)}finally{d.endGroup()}},P=async h=>{d.startGroup("POS Products: Category Change");try{C.value=1,await m.setCategory(h),await m.fetchProducts(C.value,S.value)}catch(I){d.error("Category change failed",I)}finally{d.endGroup()}},g=h=>{if(h.stock<=0)return;d.debug("[PosProducts] Product selected:",{id:h.id,name:h.name,price:h.price,section:{id:h.section_id,type:h.section_type,name:h.section_name},rawProduct:h});const I={...h,section_id:h.section_id,section_type:h.section_type||"other",section_name:h.section_name||"Default"};d.info("[PosProducts] Adding product to cart:",{id:I.id,name:I.name,price:I.price,section:{id:I.section_id,type:I.section_type,name:I.section_name}}),x.addItem(I,1)},b=async h=>{var I,F;d.startGroup("POS Products: Quick Add by Search");try{const j=m.products.find(U=>{var k;return((k=U.sku)==null?void 0:k.toLowerCase())===h.toLowerCase()});if(j){g(j);return}const se=m.products.find(U=>U.name.toLowerCase().includes(h.toLowerCase()));if(se)g(se);else{const U=await posApi.getItems({sku:h,is_pos:1,id:companyStore.selectedStore,limit:1});(F=(I=U.items)==null?void 0:I.data)!=null&&F[0]?g(U.items.data[0]):d.warn("No matching product found for quick add",{searchTerm:h})}}catch(j){d.error("Quick add failed",j)}finally{d.endGroup()}};return(h,I)=>(B(),he("div",u1,[oe(m).systemReady?(B(),he(gt,{key:1},[y("div",d1,[a(bn,{fluid:"",class:"pa-4"},{default:i(()=>[a(Ee,{"no-gutters":"",align:"center",class:"mb-4 flex-column flex-sm-row"},{default:i(()=>[a(we,{cols:"12",sm:"7",md:"8",lg:"9",class:"pe-sm-4 mb-3 mb-sm-0"},{default:i(()=>[y("div",c1,[a(Mh,{loading:oe(m).loading.products,onSearch:D,onQuickAdd:b},null,8,["loading"])])]),_:1}),a(we,{cols:"12",sm:"5",md:"4",lg:"3",class:"d-flex justify-end align-center"},{default:i(()=>[a(pe,{"prepend-icon":"mdi-cog",variant:"outlined",color:"primary",size:"small",class:"grid-settings-btn me-2",onClick:I[0]||(I[0]=F=>u.value=!0)},{default:i(()=>I[6]||(I[6]=[q(" Grid Settings ")])),_:1}),a(Vt,{modelValue:u.value,"onUpdate:modelValue":I[3]||(I[3]=F=>u.value=F),"max-width":"800",transition:"dialog-bottom-transition"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(Rn,{class:"d-flex justify-space-between align-center pa-4 bg-primary text-white"},{default:i(()=>[I[7]||(I[7]=y("span",{class:"text-h6"},"Grid Display Settings",-1)),a(pe,{icon:"mdi-close",variant:"text",size:"small",onClick:I[1]||(I[1]=F=>u.value=!1)})]),_:1}),a(ht,{class:"pa-6"},{default:i(()=>[a(l1,{modelValue:p.value,"onUpdate:modelValue":[I[2]||(I[2]=F=>p.value=F),V]},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(Ee,{"no-gutters":""},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(Gh,{categories:oe(m).categoriesForDisplay,onChange:P},null,8,["categories"])]),_:1})]),_:1})]),_:1})]),a(bn,{fluid:"",class:"products-content pa-0",style:{"max-width":"none"}},{default:i(()=>[y("div",f1,[o.value?(B(),he("div",m1,[a(_y,{modelValue:v.value,"onUpdate:modelValue":I[4]||(I[4]=F=>v.value=F),color:"primary",height:"25",striped:"",rounded:""},{default:i(({value:F})=>[y("strong",null,"Preloading products... "+te(Math.ceil(F))+"%",1)]),_:1},8,["modelValue"])])):Ne("",!0),oe(m).loading.products&&!o.value?(B(),he("div",p1,[a(Nn,{indeterminate:"",color:"primary",size:"32"})])):oe(m).products.length>0?(B(),he("div",v1,[a(a1,{products:w.value,"grid-settings":p.value,onSelect:g,class:"products-grid"},null,8,["products","grid-settings"]),a(Eo,{modelValue:C.value,"onUpdate:modelValue":[I[5]||(I[5]=F=>C.value=F),E],length:G.value,"total-visible":7,class:"mt-4"},null,8,["modelValue","length"])])):(B(),Se(sn,{key:3,type:"info",variant:"tonal",class:"mx-4 products-empty-state"},{prepend:i(()=>[a(Te,{icon:"mdi-information"})]),default:i(()=>[I[8]||(I[8]=q(" No items found "))]),_:1}))])]),_:1})],64)):(B(),Se(sn,{key:0,type:"warning",class:"ma-2"},{default:i(()=>[q(te(oe(m).setupMessage),1)]),_:1}))]))}},y1=_t(g1,[["__scopeId","data-v-4ab09787"]]);function Ao(){const s=z(!1),u=z([]),o=z(null),v=z(null),m=Zu(),x=async()=>{try{const P=await m.getCompanySettings();return v.value=P,P}catch(P){throw o.value=P.message,d.error("Failed to fetch company settings:",P),P}},w=async()=>{s.value=!0,o.value=null;try{const P=await m.getPaymentMethods();if(P.success&&P.data)u.value=P.data;else throw new Error("Failed to fetch payment methods");return P.data}catch(P){throw o.value=P.message,d.error("Failed to fetch payment methods:",P),P}finally{s.value=!1}},p=async(P,g)=>{var b,h,I,F,j,se,U;try{const k=E(g.method_id);if(!(k!=null&&k.settings_id))throw new Error("Terminal settings ID not found for payment method");const J=await To.getDefaultTerminalSetting(k.settings_id);if(!J.success||!((b=J.data)!=null&&b.data))throw new Error("Failed to get terminal settings");const K=J.data.data;if(K.status!==1&&K.terminal_status!=="Online")throw new Error(`Terminal ${K.name} is offline. Current status: ${K.status_label||K.terminal_status}`);const T={amount:g.amount,id:k.settings_id,invoice_ids:[P.invoice.id],payment_method_id:g.method_id,user_id:P.invoice.user_id},re=await To.processTerminalPayment(k.settings_id,T);if(!re.success)throw(I=(h=re.data)==null?void 0:h.message)!=null&&I.includes("Terminal in use")?new Error("Terminal is currently processing another transaction. Please try again in a moment."):(j=(F=re.data)==null?void 0:F.message)!=null&&j.includes("connection error")?new Error("Unable to connect to terminal. Please check the terminal connection and try again."):new Error(((se=re.data)==null?void 0:se.message)||"Terminal payment failed");return re}catch(k){throw d.error("Terminal payment error:",{error:k.message,payment:g,invoiceId:(U=P==null?void 0:P.invoice)==null?void 0:U.id}),new Error(`Terminal payment failed: ${k.message}`)}},V=async(P,g)=>{try{const b=new Date().toISOString().split("T")[0],h=`PAY-${Date.now()}-${Math.floor(Math.random()*1e3)}`,I={invoice_id:P.invoice.id,payment_method_id:g.method_id,amount:g.amount,received:g.received,returned:g.returned,fees:g.fees||0,payment_date:b,reference_number:"",notes:"",user_id:P.invoice.user_id||0,company_id:1,payment_number:h},F=await m.createPayment(I);if(!F.success)throw new Error("Failed to process regular payment");return F}catch(b){throw d.error("Failed to process regular payment:",b),b}},C=async(P,g)=>{s.value=!0,o.value=null;try{const b=g.filter(j=>{const se=E(j.method_id);return se.add_payment_gateway===1&&se.account_accepted==="T"}),h=g.filter(j=>{const se=E(j.method_id);return!(se.add_payment_gateway===1&&se.account_accepted==="T")}),I=await Promise.all(b.map(j=>p(P,j))),F=await Promise.all(h.map(j=>V(P,j)));return{success:!0,terminalResults:I,regularResults:F}}catch(b){throw b.value=b.message,d.error("Failed to create payment:",b),b}finally{s.value=!1}},S=P=>{const g=u.value.find(b=>b.id===P);return(g==null?void 0:g.only_cash)===1},G=P=>{const g=u.value.find(b=>b.id===P);return(g==null?void 0:g.pos_money)||[]},D=(P,g)=>{const b=u.value.find(F=>F.id===P);if(!(b!=null&&b.registrationdatafees))return 0;const h=b.registrationdatafees;let I=0;if(h.type==="FIXED")I=Math.round(h.value*100);else if(h.type==="PERCENTAGE")I=Math.round(g*h.value/100);else if(h.type==="FIXED_PLUS_PERCENTAGE"){const F=Math.round(h.value.fixed*100),j=Math.round(g*h.value.percentage/100);I=F+j}return I},E=P=>u.value.find(g=>g.id===P);return{loading:s,error:o,paymentMethods:u,settings:v,fetchSettings:x,fetchPaymentMethods:w,createPayment:C,getDenominations:G,calculateFees:D,getPaymentMethod:E,isCashOnly:S}}function No(){const s=z(!1),u=z(null),o=Zu(),v=dr(),m=Ln(),{holdInvoices:x}=kr(v),{selectedCashier:w,currentCashRegister:p}=kr(m),V=P=>{var g;return(g=x.value)!=null&&g.length?x.value.find(b=>{var h,I;return b.paid_status===Bn.UNPAID?((h=b.tables_selected)==null?void 0:h.some(F=>F.table_id===P))||((I=b.hold_tables)==null?void 0:I.some(F=>F.table_id===P)):!1}):null},C=P=>{var h,I;const g=V(P);if(!g)return null;const b=((h=g.tables_selected)==null?void 0:h.find(F=>F.table_id===P))||((I=g.hold_tables)==null?void 0:I.find(F=>F.table_id===P));return d.info(`Table ${P} info:`,{tableInfo:b}),{quantity:(b==null?void 0:b.quantity)||0,invoiceId:g.id}},S=async()=>{s.value=!0,u.value=null;try{const P=w.value||localStorage.getItem("selectedCashier");if(!P)throw new Error("No cashier selected");!w.value&&P&&await m.setSelectedCashier(Number(P));const g=await o.getTables(P);if(!g.success)throw new Error("Failed to fetch tables");return g.data.map(h=>{const I=G(h.id),F=I?C(h.id):null;return{...h,is_occupied:I,quantity:F?F.quantity:0,invoiceId:F?F.invoiceId:null}})}catch(P){throw u.value=P.message,d.error("Failed to get tables:",P),P}finally{s.value=!1}},G=P=>{var g;return(g=x.value)!=null&&g.length?x.value.some(b=>{var h,I;if(b.paid_status===Bn.UNPAID){if(((h=b.tables_selected)==null?void 0:h.length)>0&&b.tables_selected.some(j=>j.table_id===P))return!0;if(((I=b.hold_tables)==null?void 0:I.length)>0)return b.hold_tables.some(F=>F.table_id===P)}return!1}):!1},D=(P,g)=>{var b;(b=x.value)!=null&&b.length&&x.value.forEach(h=>{var I,F;((I=h.tables_selected)==null?void 0:I.length)>0&&h.tables_selected.forEach(j=>{j.table_id===P&&(j.in_use=g?1:0)}),((F=h.hold_tables)==null?void 0:F.length)>0&&h.hold_tables.forEach(j=>{j.table_id===P&&(j.in_use=g?1:0)})})};return{loading:s,error:u,getTables:S,isTableOccupied:G,setTableOccupancy:D,releaseTablesAfterPayment:async P=>{if(!(!P||!P.length)){s.value=!0,u.value=null;try{d.info("Releasing tables after payment:",P),P.forEach(b=>{D(b.table_id||b.id,!1)}),await v.fetchHoldInvoices();const g=P.filter(b=>G(b.table_id||b.id));g.length>0&&d.warn("Some tables still appear occupied:",g),d.info("Tables released successfully")}catch(g){throw u.value=g.message,d.error("Failed to release tables:",g),g}finally{s.value=!1}}},selectedCashier:w,currentCashRegister:p}}const Vu=s=>s.toISOString().split("T")[0],h1=s=>new Date(s).toLocaleDateString(),_1=s=>xe.format(s),w1=s=>xe.toCents(s),b1=s=>s.type&&Object.values(Hn).includes(s.type)?s.type:Hn.DINE_IN,I1=s=>({[Hn.DINE_IN]:"primary",[Hn.TO_GO]:"success",[Hn.DELIVERY]:"warning",[Hn.PICKUP]:"info"})[s]||"grey",Yi="core_pos_order_history";function P1(){const s=dr(),u=Yt(),{holdInvoices:o,holdInvoiceSettings:v}=kr(s),{fetchPaymentMethods:m}=Ao(),{releaseTablesAfterPayment:x}=No(),w=z(!1),p=z(null),V=z(null),C=z(null),S=z(""),G=z("ALL"),D=z("ALL"),E=z(!1),P=z(null),g=z(null),b=z([]),h=()=>{var M;try{const ve=localStorage.getItem(Yi);if(ve){const me=JSON.parse(ve);Array.isArray(me)?(b.value=me,d.info("Initialized order history from localStorage:",{count:b.value.length,firstItem:(M=b.value[0])==null?void 0:M.id})):(d.warn("Stored history is not an array, initializing empty array"),b.value=[])}else b.value=[],d.info("No stored history found, initialized empty array")}catch(ve){d.error("Failed to initialize order history from localStorage:",ve),b.value=[]}},I=()=>{var M,ve;try{return b.value=[],localStorage.removeItem(Yi),d.info("Order history cleared successfully"),(M=window.toastr)==null||M.success("Order history cleared successfully"),!0}catch(me){return d.error("Failed to clear order history:",me),(ve=window.toastr)==null||ve.error("Failed to clear order history"),!1}},F=[{title:"All Orders",value:"ALL"},{title:"Dine In",value:St.DINE_IN},{title:"To Go",value:St.TO_GO},{title:"Delivery",value:St.DELIVERY},{title:"Pickup",value:St.PICKUP}],j=async M=>{var ve,me,$,ge,ye;console.log("Payment completion handler called with result:",M);try{if(d.info("Payment completed successfully:",M),!((ve=g.value)!=null&&ve.id))throw new Error("Original hold invoice not found");const Pe={...g.value,paid_status:"PAID",paid_at:new Date().toISOString(),payment_details:M,tables_selected:g.value.tables_selected||[],hold_tables:g.value.hold_tables||[]};b.value.unshift(Pe);try{localStorage.setItem(Yi,JSON.stringify(b.value)),d.debug("Order history updated in localStorage")}catch(ie){d.error("Failed to persist order history:",ie)}if(!await T(g.value.id))throw new Error("Failed to delete original order");return(me=Pe.tables_selected)!=null&&me.length&&await x(Pe.tables_selected),($=Pe.hold_tables)!=null&&$.length&&await x(Pe.hold_tables),(ge=window.toastr)==null||ge.success("Payment processed successfully"),P.value=null,g.value=null,E.value=!1,!0}catch(Pe){return console.error("Failed to complete payment process:",Pe),d.error("Failed to complete payment process:",Pe),(ye=window.toastr)==null||ye.error("Failed to complete payment process"),!1}},se=async M=>{var ve;try{if(!(M!=null&&M.id))throw new Error("Invalid invoice: missing ID");return C.value=M.id,g.value=M,console.log("Fetching payment methods"),await m(),console.log("Setting up payment dialog"),P.value={invoice:M,invoicePrefix:M.invoice_prefix||"INV",nextInvoiceNumber:M.id},E.value=!0,{success:!0}}catch(me){return console.error("Failed to prepare for payment:",me),d.error("Failed to prepare for payment:",me),(ve=window.toastr)==null||ve.error(me.message||"Failed to prepare for payment"),{success:!1,error:me.message}}finally{C.value=null}},U=M=>{if(!(M!=null&&M.id))throw new Error("Invalid invoice: missing ID");if(!Array.isArray(M.hold_items))throw new Error("Invalid invoice: missing items array");if(!M.type)throw new Error("Invalid invoice: missing order type");return!0},k=M=>{if(!M.item_id||!M.name)throw new Error(`Invalid item data: missing required fields for item ${M.name||"unknown"}`);if(typeof M.price>"u"||M.price===null)throw new Error(`Invalid item data: missing price for item ${M.name}`);if(!M.quantity)throw new Error(`Invalid item data: missing quantity for item ${M.name}`);return!0},J=async M=>{var ve;d.startGroup("Processing cart properties");try{if(M.discount_type&&M.discount&&(d.debug("Setting discount:",{type:M.discount_type,amount:M.discount}),await u.setDiscount(M.discount_type,Number(M.discount))),M.tip_type&&M.tip&&(d.debug("Setting tip:",{type:M.tip_type,amount:M.tip}),await u.setTip(M.tip_type,Number(M.tip))),d.debug("Setting order type:",M.type),await u.setType(M.type),M.notes){d.debug("Processing order notes");try{const me=JSON.parse(M.notes),$=ur(M.notes),ge={orderInfo:{customer:((ve=me.orderInfo)==null?void 0:ve.customer)||me.customer||{}},customerNotes:$};await u.setNotes(JSON.stringify(ge))}catch(me){d.warn("Failed to parse notes, using raw value:",me),await u.setNotes(M.notes)}}if(d.debug("Setting reference information:",{id:M.id,description:M.description}),typeof u.setHoldInvoiceId!="function")throw new Error("setHoldInvoiceId is not defined in cart store");if(typeof u.setHoldOrderDescription!="function")throw new Error("setHoldOrderDescription is not defined in cart store");await u.setHoldInvoiceId(M.id),await u.setHoldOrderDescription(M.description),d.debug("Cart properties processed successfully")}catch(me){throw d.error("Failed to process cart properties:",me),me}finally{d.endGroup()}},K=async M=>{var me,$,ge,ye,Pe;p.value=M.id,d.startGroup("Loading held order");const ve=Ae=>{const ie=Number(Ae);if(d.debug("Normalizing price:",{original:Ae,asNumber:ie,hasDecimals:ie%1!==0,isLargeNumber:ie>1e3}),Number.isNaN(ie))return d.warn("Invalid price value:",Ae),0;if(ie>100&&Number.isInteger(ie)){const Z=ie/100;return d.debug("Normalized large integer price:",{original:ie,normalized:Z,formatted:xe.format(Z)}),Z}return ie%1!==0?(d.debug("Price already has decimals, keeping as is:",{price:ie,formatted:xe.format(ie)}),ie):(d.debug("Small integer price, keeping as is:",{price:ie,formatted:xe.format(ie)}),ie)};try{U(M),d.debug("Loading order details:",{id:M.id,description:M.description,type:M.type,itemCount:(me=M.hold_items)==null?void 0:me.length}),await u.clearCart(),d.debug("Cart cleared successfully"),d.debug(`Processing ${M.hold_items.length} items`);for(const Ae of M.hold_items){k(Ae);const ie=ve(Ae.price);d.debug("Processing item price:",{itemName:Ae.name,originalPrice:Ae.price,normalizedPrice:ie,formattedPrice:xe.format(ie)});const Z={id:Ae.item_id,name:Ae.name,description:Ae.description,price:ie,unit_name:Ae.unit_name,fromHeldOrder:!0};d.debug("Adding item to cart:",{productId:Z.id,name:Z.name,quantity:Ae.quantity,price:Z.price,formattedPrice:xe.format(Z.price)});try{await u.addItem(Z,Number(Ae.quantity))}catch($e){throw new Error(`Failed to add item ${Z.name} to cart: ${$e.message}`)}}return await J(M),d.info("Order loaded successfully:",{id:M.id,description:M.description,type:M.type,itemCount:M.hold_items.length,cartState:{items:($=u.items)==null?void 0:$.length,total:u.total,holdInvoiceId:u.holdInvoiceId}}),!0}catch(Ae){return d.error("Failed to load order:",{error:Ae.message,errorStack:Ae.stack,invoice:{id:M==null?void 0:M.id,type:M==null?void 0:M.type,itemCount:(ge=M==null?void 0:M.hold_items)==null?void 0:ge.length},cartStore:{methods:Object.keys(u),state:{items:(ye=u.items)==null?void 0:ye.length,total:u.total,holdInvoiceId:u.holdInvoiceId}}}),(Pe=window.toastr)==null||Pe.error(Ae.message||"Failed to load order"),!1}finally{p.value=null,d.endGroup()}},T=async M=>{var ve,me;try{if(!M)throw new Error("Invalid invoice ID");V.value=M,d.debug("Deleting hold invoice:",M);const $=await s.deleteHoldInvoice(M);if(!$.success)throw new Error($.message||"Failed to delete order");return(ve=window.toastr)==null||ve.success("Order deleted successfully"),!0}catch($){return d.error("Failed to delete order:",$),(me=window.toastr)==null||me.error($.message||"Failed to delete order"),!1}finally{V.value=null}},re=async()=>{var M;try{w.value=!0,await s.fetchHoldInvoices()}catch(ve){d.error("Failed to fetch hold invoices:",ve),(M=window.toastr)==null||M.error("Failed to fetch hold invoices")}finally{w.value=!1}};return cr(()=>{h()}),{loading:w,loadingOrder:p,deletingOrder:V,convertingOrder:C,search:S,selectedType:G,selectedStatus:D,orderTypes:F,holdInvoices:o,orderHistory:b,filteredInvoices:_e(()=>o.value),showPaymentDialog:E,currentInvoice:P,getOrderType:b1,getOrderTypeColor:I1,formatDate:h1,formatCurrency:_1,convertToInvoice:se,loadOrder:K,deleteOrder:T,fetchHoldInvoices:re,handlePaymentComplete:j,clearOrderHistory:I}}function C1(){const s=z(!1),u=z([]),o=z(null),v=z({total:0,currentPage:1,lastPage:1});return{loading:s,invoices:u,error:o,pagination:v,fetchInvoices:async({customerId:x="",status:w="",fromDate:p="",toDate:V="",invoiceNumber:C="",customcode:S="",unit:G="",orderByField:D="invoice_number",orderBy:E="desc",limit:P="all",page:g=1}={})=>{var b,h,I,F,j,se,U;s.value=!0,o.value=null;try{d.debug("Fetching invoices with params:",{customerId:x,status:w,fromDate:p,toDate:V,invoiceNumber:C,customcode:S,unit:G,orderByField:D,orderBy:E,limit:P,page:g});const k=await Tt.get("invoices",{params:{is_invoice_pos:1,customer_id:x,status:w,from_date:p,to_date:V,invoice_number:C,customcode:S,unit:G,orderByField:D,orderBy:E,v2:!0,page:g}});d.debug("Raw API response:",{status:k==null?void 0:k.status,hasData:!!(k!=null&&k.data),dataStructure:{hasInvoices:!!((b=k==null?void 0:k.data)!=null&&b.invoices),hasInvoicesData:!!((I=(h=k==null?void 0:k.data)==null?void 0:h.invoices)!=null&&I.data),invoicesDataType:typeof((j=(F=k==null?void 0:k.data)==null?void 0:F.invoices)==null?void 0:j.data)}});const{data:J,total:K,current_page:T,last_page:re}=((se=k==null?void 0:k.data)==null?void 0:se.invoices)||{};return d.debug("Extracted API response data:",{total:K,currentPage:T,lastPage:re,dataCount:J==null?void 0:J.length,sample:J!=null&&J[0]?{id:J[0].id,invoice_number:J[0].invoice_number,status:J[0].status,paid_status:J[0].paid_status}:null}),v.value={total:K||0,currentPage:T||1,lastPage:re||1},u.value=(J||[]).map(M=>({...M,invoice_number:M.invoice_number||"-",status:M.status||"PENDING",paid_status:M.paid_status||"UNPAID",total:Number(M.total||0),customer:M.customer||{name:"Walk-in Customer"}})),d.info("Invoices fetched successfully:",{total:u.value.length,firstInvoice:(U=u.value[0])==null?void 0:U.id}),{success:!0,data:u.value}}catch(k){const J=Xt(k);return o.value=J.message,d.error("Failed to fetch invoices:",{error:J,params}),{success:!1,message:J.message||"Failed to fetch invoices",errors:J.errors||{}}}finally{s.value=!1}}}}const x1={class:"held-orders-table"},S1={class:"filters-container"},O1={class:"filters-row"},T1={class:"search-field"},D1={class:"filter-controls"},E1={class:"table-container"},A1={key:0,class:"text-center actions-col"},N1={class:"text-center"},$1={class:"text-right"},V1={key:0,class:"text-center"},F1={class:"actions-wrapper"},k1={key:0,class:"pagination-wrapper"},R1={__name:"HeldOrdersTable",props:{invoices:{type:Array,required:!0},loadingOrder:{type:[String,Number],default:null},convertingOrder:{type:[String,Number],default:null},deletingOrder:{type:[String,Number],default:null},getOrderType:{type:Function,required:!0},getOrderTypeColor:{type:Function,required:!0},formatDate:{type:Function,required:!0},formatCurrency:{type:Function,required:!0},hideActions:{type:Boolean,default:!1},showPagination:{type:Boolean,default:!1},page:{type:Number,default:1},totalPages:{type:Number,default:1}},emits:["load","convert","delete","update:page","refresh"],setup(s,{emit:u}){const o=z(""),v=z("all"),m=[{title:"All",value:"all"},{title:"Dine In",value:"dine_in"},{title:"To Go",value:"to_go"},{title:"Delivery",value:"delivery"},{title:"Pickup",value:"pickup"}],x=z("all"),w=[{title:"All",value:"all"},{title:"Draft",value:"DRAFT"},{title:"Sent",value:"SENT"},{title:"Completed",value:"COMPLETED"},{title:"Cancelled",value:"CANCELLED"}],p=z("all"),V=[{title:"All",value:"all"},{title:"Paid",value:"PAID"},{title:"Unpaid",value:"UNPAID"},{title:"Partially Paid",value:"PARTIALLY_PAID"}],C=s,S=(P,g)=>{var b;console.log(`[HeldOrdersTable] ${P}:`,{id:g.id,type:C.getOrderType(g),description:g.description,itemCount:((b=g.hold_items)==null?void 0:b.length)||0,total:g.total,formattedTotal:C.formatCurrency(g.total/100)})};z(!1),z(!1),z(null);const G=P=>{const g=ur(P.notes);return g&&g.trim().length>0},D=P=>{const g=ur(P.notes);return g?`${P.description}

Notes: ${g}`:P.description},E=P=>{switch(P){case"PAID":return"success";case"UNPAID":return"warning";default:return"info"}};return Be(()=>C.loadingOrder,(P,g)=>{if(P){const b=C.invoices.find(h=>h.id===P);b&&S("Loading order",b)}}),Be(()=>C.convertingOrder,(P,g)=>{if(P){const b=C.invoices.find(h=>h.id===P);b&&S("Converting order",b)}}),(P,g)=>(B(),he("div",x1,[y("div",S1,[y("div",O1,[y("div",T1,[a(ft,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=b=>o.value=b),"prepend-inner-icon":"mdi-magnify",label:"Search orders",variant:"outlined",density:"compact","hide-details":"",class:"search-input"},null,8,["modelValue"])]),y("div",D1,[a(hn,{modelValue:v.value,"onUpdate:modelValue":g[1]||(g[1]=b=>v.value=b),items:m,label:"Type",variant:"outlined",density:"compact","hide-details":"",class:"filter-select","prepend-inner-icon":"mdi-filter"},null,8,["modelValue"]),a(hn,{modelValue:x.value,"onUpdate:modelValue":g[2]||(g[2]=b=>x.value=b),items:w,label:"Status",variant:"outlined",density:"compact","hide-details":"",class:"filter-select","prepend-inner-icon":"mdi-check-circle-outline"},null,8,["modelValue"]),a(hn,{modelValue:p.value,"onUpdate:modelValue":g[3]||(g[3]=b=>p.value=b),items:V,label:"Payment",variant:"outlined",density:"compact","hide-details":"",class:"filter-select","prepend-inner-icon":"mdi-cash"},null,8,["modelValue"])])])]),y("div",E1,[a(Qi,{"fixed-header":"",class:"orders-table"},{default:i(()=>[y("thead",null,[y("tr",null,[g[5]||(g[5]=y("th",{class:"text-left order-type-col"},"Order Type",-1)),g[6]||(g[6]=y("th",{class:"text-left description-col"},"Description",-1)),g[7]||(g[7]=y("th",{class:"text-left created-col"},"Created",-1)),g[8]||(g[8]=y("th",{class:"text-center items-col"},"Items",-1)),g[9]||(g[9]=y("th",{class:"text-right total-col"},"Total",-1)),g[10]||(g[10]=y("th",{class:"text-left status-col"},"Status",-1)),s.hideActions?Ne("",!0):(B(),he("th",A1,"Actions"))])]),y("tbody",null,[(B(!0),he(gt,null,en(s.invoices,b=>{var h;return B(),he("tr",{key:b.id},[y("td",null,[a(lr,{color:s.getOrderTypeColor(s.getOrderType(b)),size:"small",class:"order-type-chip",variant:"flat"},{default:i(()=>[q(te(s.getOrderType(b)),1)]),_:2},1032,["color"])]),y("td",{class:"text-truncate",style:Vy({maxWidth:P.$vuetify.display.mobile?"150px":"200px"})},[a(Pa,{text:D(b),location:"top","open-delay":"300"},{activator:i(({props:I})=>[y("span",Wn({ref_for:!0},I,{class:"cursor-help"}),[q(te(b.description)+" ",1),G(b)?(B(),Se(Te,{key:0,size:"x-small",color:"grey-darken-1",class:"ml-1"},{default:i(()=>g[11]||(g[11]=[q(" mdi-note-text-outline ")])),_:1})):Ne("",!0)],16)]),_:2},1032,["text"])],4),y("td",null,te(s.formatDate(b.created_at)),1),y("td",N1,te(((h=b.hold_items)==null?void 0:h.length)||0),1),y("td",$1,te(s.formatCurrency(b.total/100)),1),y("td",null,[a(lr,{color:E(b.paid_status),size:"small",variant:"flat",class:"status-chip"},{default:i(()=>[q(te(b.paid_status||"UNPAID"),1)]),_:2},1032,["color"])]),s.hideActions?Ne("",!0):(B(),he("td",V1,[y("div",F1,[a(pe,{size:"small",color:"info",variant:"flat",onClick:Rr(I=>P.$emit("load",b),["prevent"]),loading:s.loadingOrder===b.id,disabled:s.convertingOrder===b.id||s.deletingOrder===b.id||b.paid_status==="PAID"},{default:i(()=>[a(Te,{size:"small",class:"mr-1"},{default:i(()=>g[12]||(g[12]=[q("mdi-cart-arrow-down")])),_:1}),g[13]||(g[13]=q(" LOAD "))]),_:2},1032,["onClick","loading","disabled"]),a(pe,{size:"small",color:"success",variant:"flat",onClick:Rr(I=>P.$emit("convert",b),["prevent"]),loading:s.convertingOrder===b.id,disabled:s.loadingOrder===b.id||s.deletingOrder===b.id||b.paid_status==="PAID"},{default:i(()=>[a(Te,{size:"small",class:"mr-1"},{default:i(()=>g[14]||(g[14]=[q("mdi-cash-register")])),_:1}),g[15]||(g[15]=q(" PAY "))]),_:2},1032,["onClick","loading","disabled"]),a(pe,{size:"small",color:"error",variant:"flat",onClick:I=>P.$emit("delete",b),loading:s.deletingOrder===b.id,disabled:s.loadingOrder===b.id||s.convertingOrder===b.id||b.paid_status==="PAID"},{default:i(()=>[a(Te,{size:"small",class:"mr-1"},{default:i(()=>g[16]||(g[16]=[q("mdi-delete")])),_:1}),g[17]||(g[17]=q(" DELETE "))]),_:2},1032,["onClick","loading","disabled"])])]))])}),128))])]),_:1})]),s.showPagination?(B(),he("div",k1,[a(Eo,{"model-value":s.page,"onUpdate:modelValue":g[4]||(g[4]=b=>P.$emit("update:page",b)),length:s.totalPages,"total-visible":7,rounded:"circle"},null,8,["model-value","length"])])):Ne("",!0)]))}},L1=_t(R1,[["__scopeId","data-v-986591ae"]]);const U1={class:"text-body-2"},M1={__name:"DeleteConfirmationDialog",props:{modelValue:{type:Boolean,required:!0},loading:{type:Boolean,default:!1},orderDescription:{type:String,default:""}},emits:["update:modelValue","confirm"],setup(s){return(u,o)=>(B(),Se(Vt,{"model-value":s.modelValue,"onUpdate:modelValue":o[2]||(o[2]=v=>u.$emit("update:modelValue",v)),"max-width":"460",persistent:"",transition:"dialog-bottom-transition"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(ln,{color:"error",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>[a(Te,{start:"",icon:"mdi-alert",class:"mr-2"}),o[3]||(o[3]=q(" Confirm Delete "))]),_:1})]),_:1}),a(ht,{class:"pt-4"},{default:i(()=>[o[5]||(o[5]=y("p",{class:"text-body-1 mb-4"},"Are you sure you want to delete this order? This action cannot be undone.",-1)),s.orderDescription?(B(),Se(sn,{key:0,type:"warning",variant:"tonal",border:"start",class:"mb-0",density:"comfortable"},{prepend:i(()=>[a(Te,{icon:"mdi-information",class:"mb-1"})]),default:i(()=>[o[4]||(o[4]=y("div",{class:"text-subtitle-2 font-weight-medium mb-1"},"Order Details",-1)),y("div",U1,te(s.orderDescription),1)]),_:1})):Ne("",!0)]),_:1}),a(Ir),a(wn,{class:"pa-4"},{default:i(()=>[a(It),a(pe,{color:"grey-darken-1",variant:"text",onClick:o[0]||(o[0]=v=>u.$emit("update:modelValue",!1)),disabled:s.loading,class:"mr-2"},{default:i(()=>o[6]||(o[6]=[q(" Cancel ")])),_:1},8,["disabled"]),a(pe,{color:"error",variant:"elevated",onClick:o[1]||(o[1]=v=>u.$emit("confirm")),loading:s.loading,disabled:s.loading},{default:i(()=>[a(Te,{start:"",icon:"mdi-delete",class:"mr-1"}),o[7]||(o[7]=q(" Delete Order "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"]))}},z1=_t(M1,[["__scopeId","data-v-4daac1a8"]]),q1=s=>{d.debug("Validating invoice data:",s);const o=["invoice_number","invoice_date","due_date","total","sub_total","items","user_id","type","paid_status"].filter(v=>!s[v]);if(o.length>0)throw new Error(`Missing required fields: ${o.join(", ")}`);if(!Array.isArray(s.items)||s.items.length===0)throw new Error("Invoice must have at least one item");if(s.items.forEach((v,m)=>{if(!v.item_id||!v.name||!v.price||!v.quantity)throw new Error(`Invalid item data at index ${m}`)}),!Object.values(St).includes(s.type))throw new Error(`Invalid order type: ${s.type}. Must be one of: ${Object.values(St).join(", ")}`);if(!Object.values(Bn).includes(s.paid_status))throw new Error(`Invalid paid status: ${s.paid_status}. Must be either PAID or UNPAID`);return d.debug("Invoice data validation passed"),!0},Qu=async s=>{var u,o,v,m,x,w;if(!s||typeof s!="object")throw new Error("Invalid invoice data provided");if(s.invoice&&typeof s.invoice=="object"&&(s=s.invoice),!s.id){const p=new Error("Invalid invoice: missing ID");throw d.error("[InvoiceConverter] Invalid invoice data:",{invoice:s}),p}d.info("[InvoiceConverter] Starting conversion process:",{id:s.id,description:s.description,total:s.total,items:(u=s.hold_items)==null?void 0:u.length});try{if(!s||typeof s!="object")throw new Error("Invalid invoice data provided");d.debug("Starting invoice conversion with data:",{id:s.id,type:s.type,items:((o=s.hold_items)==null?void 0:o.length)||0}),!s.items&&s.hold_items?s.items=s.hold_items:s.items||(s.items=[]),console.log("Fetching company settings");const p=await _n.getCompanySettings();if(console.log("Company settings received:",p),!p.invoice_auto_generate)throw new Error("Invoice auto-generate setting is required but missing");const V=p.invoice_issuance_period||"7";let C;if(p.invoice_auto_generate==="YES"){console.log("Getting next invoice number");const se=await _n.invoice.getNextNumber();if(console.log("Next number response:",se),!(se!=null&&se.invoice_number))throw new Error("Failed to get next invoice number");C=`${se.prefix}-${se.nextNumber}`}else throw new Error("Manual invoice number entry is not supported");const S=new Date,G=new Date(S);G.setDate(G.getDate()+parseInt(V));let D={};try{s.notes&&(D=JSON.parse(s.notes))}catch(se){console.error("Failed to parse table data from notes:",se)}console.log("Formatting items data");const E=s.items.map(se=>{const U=Math.round(Number(se.price)),k=parseInt(se.quantity),J=U*k;return{item_id:Number(se.item_id),name:se.name,description:se.description||"",price:U,quantity:k,unit_name:se.unit_name||"units",sub_total:J,total:J,discount:"0",discount_val:0,discount_type:"fixed",tax:Math.round(Number(se.tax||0)),retention_amount:0,retention_concept:null,retention_percentage:null,retentions_id:null}}),P=s.tip?String(Math.round(Number(s.tip))):"0";console.log("Formatted tip value:",P),console.log("Preparing invoice data"),console.log("Invoice data",s);const g=Math.round(Number(s.sub_total||0)),b=Math.round(Number(s.tax||0)),h=Math.round(Number(s.total||g+b)),I={invoice_date:Vu(S),due_date:Vu(G),invoice_number:C,sub_total:g,total:h,tax:b,items:E,tables_selected:s.tables_selected||[],hold_tables:s.hold_tables||[],avalara_bool:!1,banType:!0,package_bool:!1,print_pdf:!1,save_as_draft:!1,send_email:!1,not_charge_automatically:!1,is_hold_invoice:!0,is_invoice_pos:1,is_pdf_pos:p.pdf_format_pos==="1",is_prepared_data:!0,invoice_template_id:1,invoice_pbx_modify:0,hold_invoice_id:Math.round(Number(s.id||0)),store_id:Math.round(Number(s.store_id||0)),cash_register_id:Math.round(Number(s.cash_register_id||0)),user_id:Math.round(Number(s.user_id||1)),due_amount:Math.round(Number(h)),discount:String(Math.round(Number(s.discount||0))),discount_type:s.discount_type||"fixed",discount_val:Math.round(Number(w1(s.discount_val||0))),discount_per_item:p.discount_per_item||"NO",tip:P,tip_type:s.tip_type||"fixed",tip_val:s.tip_val||0,status:"SENT",paid_status:s.paid_status||Bn.UNPAID,type:s.type||St.TO_GO,items:E,taxes:s.taxes||[],packages:[],tables_selected:D.tables||[],notes:"",description:s.description||`Order #${s.id}`};q1(I),console.log("Creating invoice with data:",I);const F=await _n.invoice.create(I);if(console.log("Invoice creation response:",F),(m=(v=F==null?void 0:F.result)==null?void 0:v.invoice)!=null&&m.id)F.invoice=F.result.invoice;else if(!((x=F==null?void 0:F.invoice)!=null&&x.id))throw new Error("Failed to create invoice: No valid invoice ID");F.invoice.hold_invoice_id=s.id,console.log("Fetching created invoice details");const j=await _n.invoice.getById(F.invoice.id);if(!j)throw new Error("Failed to fetch created invoice details");return j.tip&&(j.tip=String(Math.round(Number(j.tip)))),j.hold_invoice_id=s.id,console.log("Created invoice details:",j),d.info("Order converted to invoice successfully:",j.id),{success:!0,invoice:j}}catch(p){return console.error("Failed to convert order to invoice:",p),d.error("Failed to convert order to invoice:",p),(w=window.toastr)==null||w.error(p.message||"Failed to convert order to invoice"),{success:!1,error:p.message}}};const G1={key:0,class:"d-flex justify-center align-center pa-4"},H1=["src"],B1={__name:"PdfViewerDialog",props:{modelValue:{type:Boolean,default:!1},pdfUrl:{type:String,required:!0},title:{type:String,default:"Invoice"}},emits:["update:modelValue","closed","error"],setup(s,{emit:u}){const o=s,v=u,m=z(o.modelValue),x=z(!0);Be(()=>o.modelValue,b=>{m.value=b}),Be(m,b=>{v("update:modelValue",b),b||v("closed")});const w=()=>{try{if(!o.pdfUrl||!o.pdfUrl.includes("/pdf/"))throw new Error("Invalid PDF URL format");try{const F=document.querySelector("iframe");if(!F)throw new Error("PDF iframe not found");const j=new MessageChannel;F.contentWindow.postMessage({type:"pdf-ready-check"},"*",[j.port2]),j.port1.onmessage=se=>{if(se.data==="pdf-ready")x.value=!1;else throw new Error("PDF content not loaded correctly")}}catch(F){console.error("PDF loading error:",F),x.value=!1,v("error",{type:"pdf-load-error",message:F.message,url:o.pdfUrl})}const b=document.querySelector("iframe");if(!b)throw new Error("PDF iframe not found");const h=b.contentWindow;if(!h||h.document.readyState!=="complete")throw new Error("PDF window not ready");const I=h.document.querySelector("embed")||h.document.querySelector("object");if(!I||!I.src.includes(o.pdfUrl))throw new Error("PDF content not loaded correctly");x.value=!1,E()}catch(b){console.error("PDF loading error:",b),x.value=!1,v("error",{type:"pdf-load-error",message:b.message,url:o.pdfUrl})}};Be(()=>o.pdfUrl,b=>{try{if(!b)throw new Error("PDF URL is empty");if(!b.startsWith("http")||!b.includes("/pdf/"))throw new Error(`Invalid PDF URL format: ${b}`);x.value=!0;const h=document.querySelector("iframe");h&&(h.src=b)}catch(h){console.error("PDF URL validation error:",h),v("error",{type:"pdf-url-error",message:h.message,url:b}),x.value=!1}},{immediate:!0});const p=z(!1),V=z(!1),C=z(!1),S=z([]),G=z(null),D=z({orientation:"Portrait",paperSize:"Letter",color:!1,copies:1}),E=async()=>{C.value=!0,S.value=[];try{if(!navigator.usb)throw new Error("WebUSB API not supported in this browser");const b=await navigator.usb.requestDevice({filters:[{classCode:7},{vendorId:1008},{vendorId:1193},{vendorId:1208},{vendorId:1273}]});if(!b)throw new Error("No USB printers found");await b.open();const h={id:b.serialNumber,name:b.productName||"USB Printer",manufacturer:b.manufacturerName||"Unknown",vendorId:b.vendorId,productId:b.productId,isUSB:!0};S.value=[h],S.value.length===1&&(G.value=S.value[0]),await b.close()}catch(b){console.error("Error detecting printers:",b)}finally{C.value=!1}},P=async()=>{if(G.value){V.value=!0;try{const b=document.querySelector("iframe");if(!b||!b.contentWindow)throw new Error("PDF iframe not found");const h=b.contentWindow,I=h.document.querySelector("embed")||h.document.querySelector("object");if(!I)throw new Error("PDF content not loaded");if(G.value.isUSB){const F=await navigator.usb.requestDevice({filters:[{vendorId:G.value.vendorId}]});if(!F)throw new Error("USB printer not found");await F.open(),await F.selectConfiguration(1),await F.claimInterface(0);const se=await(await fetch(I.src)).arrayBuffer();await F.transferOut(1,se),await F.releaseInterface(0),await F.close()}else h.print();console.log("PDF printed successfully"),p.value=!1}catch(b){console.error("Error printing PDF:",b),v("error",{type:"print-error",message:b.message,printer:G.value})}finally{V.value=!1}}};Be(p,b=>{b&&E()});const g=()=>{m.value=!1};return(b,h)=>(B(),Se(Vt,{modelValue:m.value,"onUpdate:modelValue":h[7]||(h[7]=I=>m.value=I),"max-width":"1000px",persistent:""},{default:i(()=>[a(Ze,null,{default:i(()=>[a(ln,{color:"primary",dark:""},{default:i(()=>[a(un,null,{default:i(()=>[q(te(s.title),1)]),_:1}),a(It),a(pe,{icon:"",onClick:g},{default:i(()=>[a(Te,null,{default:i(()=>h[8]||(h[8]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),a(Vt,{modelValue:p.value,"onUpdate:modelValue":h[5]||(h[5]=I=>p.value=I),"max-width":"600px"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(Rn,null,{default:i(()=>h[9]||(h[9]=[q("Print Invoice")])),_:1}),a(ht,null,{default:i(()=>[a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(hn,{modelValue:G.value,"onUpdate:modelValue":h[0]||(h[0]=I=>G.value=I),items:S.value,"item-title":"name",label:"Select Printer",loading:C.value,disabled:C.value,clearable:"",hint:"Select a network printer","persistent-hint":""},null,8,["modelValue","items","loading","disabled"])]),_:1}),a(we,{cols:"6"},{default:i(()=>[a(hn,{modelValue:D.value.orientation,"onUpdate:modelValue":h[1]||(h[1]=I=>D.value.orientation=I),items:["Portrait","Landscape"],label:"Orientation"},null,8,["modelValue"])]),_:1}),a(we,{cols:"6"},{default:i(()=>[a(hn,{modelValue:D.value.paperSize,"onUpdate:modelValue":h[2]||(h[2]=I=>D.value.paperSize=I),items:["A4","Letter","Legal"],label:"Paper Size"},null,8,["modelValue"])]),_:1}),a(we,{cols:"12"},{default:i(()=>[a(wy,{modelValue:D.value.color,"onUpdate:modelValue":h[3]||(h[3]=I=>D.value.color=I),label:"Print in color"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(wn,null,{default:i(()=>[a(pe,{color:"grey",onClick:h[4]||(h[4]=I=>p.value=!1)},{default:i(()=>h[10]||(h[10]=[q("Cancel")])),_:1}),a(pe,{color:"primary",onClick:P,loading:V.value,disabled:!G.value||V.value},{default:i(()=>h[11]||(h[11]=[q(" Print ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ht,{class:"pdf-container"},{default:i(()=>[x.value?(B(),he("div",G1,[a(Nn,{indeterminate:"",color:"primary"})])):Ne("",!0),ns(y("iframe",{src:s.pdfUrl,width:"100%",height:"600",onLoad:w},null,40,H1),[[Fy,!x.value]])]),_:1}),a(wn,{class:"d-flex justify-end pa-4"},{default:i(()=>[a(pe,{color:"grey",variant:"outlined",onClick:g,class:"mr-2"},{default:i(()=>h[12]||(h[12]=[q(" Close ")])),_:1}),a(pe,{color:"primary",variant:"flat",onClick:h[6]||(h[6]=I=>p.value=!0),loading:C.value},{default:i(()=>[a(Te,{start:""},{default:i(()=>h[13]||(h[13]=[q("mdi-printer")])),_:1}),h[14]||(h[14]=q(" Print "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},$o=_t(B1,[["__scopeId","data-v-90faffc4"]]);const W1={class:"payment-dialog-wrapper"},K1={class:"payment-content"},Y1={key:0,class:"loading-state"},J1={class:"d-flex justify-space-between mb-2"},Z1={class:"d-flex justify-space-between mb-2"},Q1={key:0,class:"d-flex justify-space-between mb-2"},j1={class:"d-flex justify-space-between mb-2"},X1={key:2,class:"active-payments-section"},e_={class:"d-flex align-center mb-4"},t_={class:"text-h6"},n_={class:"amount-display"},r_={class:"amount-display__amount"},a_={key:0,class:"amount-display__error"},o_={key:0,class:"mb-4"},i_={class:"amount-display"},s_={class:"amount-display__amount"},l_=["onUpdate:modelValue","onInput"],u_={key:0,class:"amount-display__error"},d_={key:1,class:"text-caption mb-2"},c_={class:"d-flex justify-space-between"},f_={class:"text-grey"},m_={class:"d-flex justify-space-between mb-2"},p_={key:2,class:"d-flex justify-space-between mb-2"},v_={key:3,class:"d-flex justify-space-between mb-2"},g_={key:4,class:"d-flex justify-space-between"},y_={class:"process-payment-footer"},h_={class:"d-flex justify-space-between"},__={__name:"PaymentDialog",props:{modelValue:Boolean,invoice:{type:Object,required:!1,default:()=>({})}},emits:["update:modelValue","paymentComplete"],setup(s,{emit:u}){const o={track:(ue,H={})=>{window.analytics?window.analytics.track(ue,H):console.log(`[Analytics] ${ue}:`,H)}},v=new Map,m=u,x=s,w=_e(()=>{var H,L,N;const ue=((L=(H=x.invoice)==null?void 0:H.invoice)==null?void 0:L.total)||0;return console.log("PaymentDialog - Raw invoice total:",{rawTotal:ue,invoice:(N=x.invoice)==null?void 0:N.invoice,isDollarAmount:xe.isInDollars(ue),isCentsAmount:ue>100}),ue}),p=Ao(),{loading:V,error:C,paymentMethods:S,settings:G,createPayment:D,fetchPaymentMethods:E,fetchSettings:P,getDenominations:g,calculateFees:b,getPaymentMethod:h,isCashOnly:I}=p;Be(S,ue=>{console.log("Payment methods updated:",ue)},{immediate:!0}),Be(V,ue=>{console.log("Payment loading state:",ue)}),Be(C,ue=>{ue&&console.error("Payment error:",ue)});const{loading:F,error:j,releaseTablesAfterPayment:se}=No(),U=_e(()=>V.value||F.value),k=_e(()=>C.value||j.value),J=z(!1),K=z([]),T=z(!1),re=z(""),M=()=>{re.value=""},ve=z(!1),me=[15,18,20,25],$=z(null),ge=z(""),ye=z(0),Pe=z("percentage"),Ae=_e(()=>{var ue,H,L,N;return((H=(ue=x.invoice)==null?void 0:ue.invoice)==null?void 0:H.invoice_number)||`${(L=x.invoice)==null?void 0:L.invoicePrefix}-${(N=x.invoice)==null?void 0:N.nextInvoiceNumber}`||""}),ie=_e(()=>{const ue=$.value||Number(ge.value)||0,H=xe.toDollars(w.value),L=Math.round(H*(ue/100)*100);return console.log("PaymentDialog - Tip calculation:",{percent:ue,invoiceTotalInCents:w.value,invoiceTotalInDollars:H,calculatedTipInCents:L}),L}),Z=_e({get:()=>(console.log("🪟 PaymentDialog - Getting dialog value:",x.modelValue),x.modelValue),set:ue=>{var H,L,N;console.log("🪟 PaymentDialog - Setting dialog value:",ue),console.log("🪟 PaymentDialog - Current DOM state:",{dialogElement:document.querySelector(".payment-dialog"),dialogVisible:(H=document.querySelector(".payment-dialog"))==null?void 0:H.style.display,vDialogElement:document.querySelector(".v-dialog"),vDialogVisible:(L=document.querySelector(".v-dialog"))==null?void 0:L.style.display}),ue&&((N=window.navigator)!=null&&N.vibrate)&&window.navigator.vibrate(50),o.track(ue?"PaymentDialogOpened":"PaymentDialogClosed"),m("update:modelValue",ue)}}),$e=_e(()=>{const ue=K.value.reduce((L,N)=>L+N.amount,0),H=w.value+ye.value-ue;return console.log("PaymentDialog - Remaining amount:",{invoiceTotalInCents:w.value,tipAmountInCents:ye.value,totalPaidInCents:ue,remainingInCents:H}),H});_e(()=>K.value.reduce((ue,H)=>ue+H.amount,0)),_e(()=>K.value.reduce((ue,H)=>ue+(H.fees||0),0));const Ce=_e(()=>$e.value>0&&K.value.length<S.value.length),Xe=ue=>!ue.displayAmount||Number(ue.displayAmount)<=0?!1:Number(ue.displayAmount)===xe.toDollars(w.value+ye.value),ne=ue=>ue.displayReceived?Number(ue.displayReceived)>=Number(ue.displayAmount):!1,Y=_e(()=>K.value.every(ue=>!(!ue.method_id||!ue.amount||I(ue.method_id)&&!ue.received||!Xe(ue)||I(ue.method_id)&&!ne(ue)))&&$e.value===0),de=ue=>{const H=v.get(ue);if(H)return H;console.log("PaymentDialog - Formatting currency:",{inputAmount:ue,isDollarAmount:xe.isInDollars(ue),isCentsAmount:ue>100,formattedResult:xe.format(ue)});const L=xe.format(ue);return v.set(ue,L),L},Ve=ue=>{const H=h(ue);return(H==null?void 0:H.IsPaymentFeeActive)==="YES"},Pt=(ue,H)=>{const L=h(ue);if(!(L!=null&&L.registrationdatafees))return"";const N=L.registrationdatafees;switch(N.type){case"FIXED":return`Fixed fee: ${de(N.value)}`;case"PERCENTAGE":return`${N.value}% of transaction amount`;case"FIXED_PLUS_PERCENTAGE":return`${de(N.value.fixed)} + ${N.value.percentage}% of transaction amount`;default:return""}},At=ue=>({Cash:"mdi-cash","Credit Card":"mdi-credit-card","Debit Card":"mdi-credit-card-outline",Check:"mdi-checkbox-marked-circle-outline","Gift Card":"mdi-gift","Mobile Payment":"mdi-cellphone","Bank Transfer":"mdi-bank"})[ue]||"mdi-currency-usd",tt=ue=>K.value.some(H=>H.method_id===ue),dt=ue=>tt(ue)||K.value.length>=S.value.length,mt=ue=>{if(tt(ue)||dt(ue))return;const H=$e.value,L=xe.toDollars(H).toString();K.value.push({method_id:ue,amount:H,displayAmount:L,received:H,displayReceived:L,returned:0,fees:0}),qe(K.value.length-1)},lt=(ue,H)=>{var fe;const L=K.value[H],N=Number(ue.amount);L.displayReceived=N.toFixed(2),L.received=xe.toCents(L.displayReceived),Ke(H),(fe=window.navigator)!=null&&fe.vibrate&&window.navigator.vibrate(50)},Ke=ue=>{const H=K.value[ue];if(!H.displayReceived||!H.displayAmount)return;const L=xe.toCents(H.displayReceived),N=H.amount;H.received=L,L>=N?H.returned=L-N:H.returned=0},qe=ue=>{const H=K.value[ue];if(!H)return;const L=w.value+ye.value;console.log("PaymentDialog - Validating payment amount:",{paymentIndex:ue,totalInCents:L,totalInDollars:xe.toDollars(L),currentPayment:{...H}}),H.displayAmount=xe.toDollars(L).toString(),H.amount=L,Ve(H.method_id)&&(H.fees=b(H.method_id,H.amount));const N=S.value.find(fe=>fe.id===H.method_id);if((N==null?void 0:N.only_cash)===1){const fe=xe.toCents(H.displayReceived);console.log("PaymentDialog - Cash payment received:",{displayReceived:H.displayReceived,receivedInCents:fe,paymentAmount:H.amount}),H.received=fe,H.returned=Math.max(0,H.received-H.amount)}else H.displayReceived=H.displayAmount,H.received=H.amount,H.returned=0},Ct=()=>{K.value.push({method_id:null,amount:0,displayAmount:xe.toDollars(w.value+ye.value).toString(),received:0,displayReceived:"0",returned:0,fees:0})},ce=ue=>{K.value.splice(ue,1),K.value.forEach((H,L)=>qe(L))},le=()=>{J.value||(Z.value=!1)},Ue=ue=>{$.value=ue,ge.value=""},Ie=()=>{$.value=null},wt=()=>{ve.value=!1,$.value=null,ge.value=""},pt=()=>{ye.value=ie.value,Pe.value="percentage",ve.value=!1,K.value.forEach((ue,H)=>qe(H))},tn=async()=>{var ue,H,L,N,fe,nt,Jt,Nt,dn,Lt,Un,Kn,Yn,Cr,ot,cn,Ht,Jn,ra,fr,Zn,Mn,Qn,xr,rt,$t,Lr,Ta,Ur,Da,Ea,Aa;if(!(!Y.value||J.value)){J.value=!0;try{const Sr=K.value.filter(et=>{const Ut=h(et.method_id);return Ut.add_payment_gateway===1&&Ut.account_accepted==="T"});for(const et of Sr){const Ut=h(et.method_id);if(!Ut.settings_id)throw new Error(`Terminal settings not configured for ${Ut.name}`);const In=await To.getDefaultTerminalSetting(Ut.settings_id);if(!In.success||!((ue=In.data)!=null&&ue.data))throw new Error("Failed to get terminal settings");const Pn=In.data.data;console.log("Terminal settings response:",{settingsResponse:In,terminalSettings:Pn,status:Pn.status,terminal_status:Pn.terminal_status,enabled:Pn.enabled});const oa=Pn.status||Pn.terminal_status;if(oa!==1&&oa!=="Online")throw new Error(`Terminal ${Ut.name} is not ready for payments. Current status: ${oa}`)}const je=x.invoice.invoice;if(!je)throw console.error("No invoice data provided",{propsInvoice:x.invoice,holdInvoice:je}),new Error("Invoice data not provided");if(!je.id||!je.total)throw console.error("Invalid invoice data",{id:je.id,total:je.total,invoice:je}),new Error("Invalid invoice data");const Mr=w.value+ye.value;console.log(" [Payment] Prepared hold invoice data:",{id:je.id,total:Mr,originalTotal:je.total,tipAmount:ye.value});const Vo=$.value||Number(ge.value)||0;je.tip=String(Math.round(Vo)),je.tip_type="percentage",je.tip_val=ye.value,je.total=Mr,je.due_amount=Mr,je.sub_total=w.value,console.log("Tip values:",{percentage:je.tip,type:je.tip_type,amount:je.tip_val,total:je.total}),je.is_hold_invoice=!1,je.is_invoice_pos=1,je.is_pdf_pos=!0,je.package_bool=!1,je.print_pdf=!1,je.save_as_draft=!1,je.send_email=!1,je.not_charge_automatically=!1,je.avalara_bool=!1,je.banType=!0;const Na=new Date;je.invoice_date=Na.toISOString().split("T")[0];const zr=new Date(Na);zr.setDate(zr.getDate()+7),je.due_date=zr.toISOString().split("T")[0],console.log(" [Payment] Converting held order to invoice...");const at=await Qu(je);if(console.log(" [Payment] Invoice creation result:",at),!at.success)throw console.error(" [Payment] Failed to create invoice:",at),new Error("Failed to create invoice");if(console.log("Created invoice:",at),x.createInvoiceOnly)try{const et={...at.invoice,is_hold_invoice:!0,status:"HELD",description:at.invoice.description||"Delivery Order"};if(!(await _n.holdInvoice.create(et)).success)throw new Error("Failed to add invoice to held orders");(H=window.toastr)==null||H.success("Invoice created and added to held orders"),m("payment-complete",!0),Z.value=!1;return}catch(et){throw console.error("Failed to add to held orders:",et),new Error("Failed to add invoice to held orders")}const aa=K.value.map(et=>({method_id:et.method_id,amount:et.amount,received:et.received,returned:et.returned,fees:et.fees||0}));if(console.log(" [Payment] Formatted payments:",aa),aa.reduce((et,Ut)=>et+Ut.amount,0)!==Mr)throw new Error("Payment amount must match invoice total including tip");console.log(" [Payment] Creating payment...");const Le=await D(at.invoice,aa);console.log(" [Payment] Payment creation result:",Le);const $a=((fe=(N=(L=Le==null?void 0:Le.regularResults)==null?void 0:L[0])==null?void 0:N.payment)==null?void 0:fe.invoice_id)||(Le==null?void 0:Le.invoice_id)||((nt=at==null?void 0:at.invoice)==null?void 0:nt.id)||(at==null?void 0:at.id)||((Jt=x.invoice)==null?void 0:Jt.id);if($a){console.log("📄 [Invoice PDF] Starting PDF preparation",{paymentResult:Le,invoiceResult:at,invoiceId:$a,propsInvoice:x.invoice,regularResults:Le==null?void 0:Le.regularResults});const et=((Nt=Le==null?void 0:Le.invoice)==null?void 0:Nt.invoice)||(Le==null?void 0:Le.invoice)||((Un=(Lt=(dn=Le==null?void 0:Le.regularResults)==null?void 0:dn[0])==null?void 0:Lt.payment)==null?void 0:Un.invoice)||(at==null?void 0:at.invoice)||Le||x.invoice,Ut=(et==null?void 0:et.unique_hash)||((Kn=et==null?void 0:et.invoice)==null?void 0:Kn.unique_hash)||((Yn=Le==null?void 0:Le.invoice)==null?void 0:Yn.unique_hash);if(console.log("📄 [Invoice PDF] Invoice data sources:",{resultInvoice:Le==null?void 0:Le.invoice,paymentInvoice:(cn=(ot=(Cr=Le==null?void 0:Le.regularResults)==null?void 0:Cr[0])==null?void 0:ot.payment)==null?void 0:cn.invoice,invoiceResult:at==null?void 0:at.invoice,result:Le,propsInvoice:x.invoice}),!Ut){console.error("📄 [Invoice PDF] Missing invoice hash:",{result:Le,invoice:et,invoiceResult:at,propsInvoice:x.invoice,regularResults:Le==null?void 0:Le.regularResults,nestedInvoice:(Ht=Le==null?void 0:Le.invoice)==null?void 0:Ht.invoice}),(Jn=window.toastr)==null||Jn.error("Could not generate invoice PDF: Missing hash");return}if(!/^[a-zA-Z0-9.-]+$/.test(Ut)){console.error("📄 [Invoice PDF] Invalid hash format:",Ut),(ra=window.toastr)==null||ra.error("Invalid invoice hash format");return}const In="https://lajuanita.corebill.co/api/v1".replace("/api/v1",""),Pn=`${In}/invoices/pdf/${Ut}`;console.log("📄 [Invoice PDF] Using invoice details:",{invoiceId:et.id,invoiceHash:et.unique_hash,baseUrl:In,constructedUrl:Pn,fullInvoice:et}),console.log("📄 [Invoice PDF] Opening PDF viewer with URL:",Pn),re.value=Pn,T.value=!0}else console.error("💰 [Payment] Missing invoice ID in payment result:",Le),(fr=window.toastr)==null||fr.error("Could not get invoice PDF");if(at.invoice.type==="DINE_IN"&&((Zn=at.invoice.tables_selected)!=null&&Zn.length))try{await se(at.invoice.tables_selected)}catch(et){console.error("Failed to release tables:",et),(Mn=window.toastr)==null||Mn.warning("Payment successful, but failed to update table status")}const Va={...Le,invoiceId:((rt=(xr=(Qn=Le==null?void 0:Le.regularResults)==null?void 0:Qn[0])==null?void 0:xr.payment)==null?void 0:rt.invoice_id)||(Le==null?void 0:Le.invoice_id)||(($t=at==null?void 0:at.invoice)==null?void 0:$t.id)||(at==null?void 0:at.id)||((Lr=x.invoice)==null?void 0:Lr.id)};m("payment-complete",Va),Z.value=!1,console.log(" [Payment] Payment completed with result:",{success:!0,invoiceId:Va.invoiceId,paymentResult:Le})}catch(Sr){console.error(" [Payment] Payment failed:",Sr),(Ta=window.toastr)==null||Ta.error(Sr.message||"Failed to process payment"),o.track("PaymentFailed",{error:Sr.message,invoiceId:(Ur=x.invoice)==null?void 0:Ur.id,totalAmount:(Da=x.invoice)==null?void 0:Da.total})}finally{J.value=!1,o.track("PaymentCompleted",{success:!k.value,invoiceId:(Ea=x.invoice)==null?void 0:Ea.id,totalAmount:(Aa=x.invoice)==null?void 0:Aa.total})}}};return Be(()=>Z.value,async ue=>{var H,L;if(console.log("🪟 PaymentDialog - Watch triggered:",{newValue:ue}),ue)try{console.log("🪟 PaymentDialog - Initializing..."),K.value=[],J.value=!1,ye.value=0,$.value=null,ge.value="",console.log("Fetching company settings..."),await P(),console.log("Fetching payment methods...");const N=await E();console.log("Fetched payment methods:",N),(!N||N.length===0)&&(console.warn("No payment methods available"),(H=window.toastr)==null||H.warning("No payment methods available")),console.log("🪟 PaymentDialog - Initialization complete")}catch(N){console.error("🪟 PaymentDialog - Initialization failed:",N),(L=window.toastr)==null||L.error("Failed to initialize payment: "+(N.message||"Unknown error")),Z.value=!1}else console.log("🪟 PaymentDialog - Dialog closed")},{immediate:!0}),(ue,H)=>(B(),he("div",W1,[a(Vt,{modelValue:Z.value,"onUpdate:modelValue":H[2]||(H[2]=L=>Z.value=L),fullscreen:"",transition:"dialog-bottom-transition",scrim:!1,class:"payment-dialog"},{default:i(()=>[a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",elevation:1,class:"payment-toolbar"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium text-on-primary"},{default:i(()=>[a(Te,{icon:"mdi-cash-register",size:"large",class:"mr-2",color:"on-primary"}),H[6]||(H[6]=q(" Process Payment "))]),_:1}),a(It),a(pe,{icon:"",onClick:le,color:"on-primary"},{default:i(()=>[a(Te,null,{default:i(()=>H[7]||(H[7]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),y("div",K1,[U.value?(B(),he("div",Y1,[a(Nn,{indeterminate:"",color:"primary",size:"64"}),H[8]||(H[8]=y("div",{class:"text-h6 mt-4"},"Loading Payment Methods...",-1))])):(B(),Se(bn,{key:1,class:"payment-container"},{default:i(()=>[a(Ee,null,{default:i(()=>[a(we,{cols:"12",md:"4"},{default:i(()=>[a(Ze,{variant:"elevated",class:"invoice-summary-card mb-4",elevation:"2"},{default:i(()=>[a(Xi,null,{prepend:i(()=>[a(Te,{icon:"mdi-receipt",size:"large",color:"primary",class:"mr-4"})]),default:i(()=>[a(Rn,{class:"text-h6 pb-2"},{default:i(()=>H[9]||(H[9]=[q(" Invoice Summary ")])),_:1})]),_:1}),a(Ir),a(ht,{class:"py-4"},{default:i(()=>[y("div",J1,[H[10]||(H[10]=y("span",null,"Invoice Number:",-1)),y("strong",null,te(Ae.value),1)]),y("div",Z1,[H[11]||(H[11]=y("span",null,"Subtotal:",-1)),y("strong",null,te(de(w.value)),1)]),ye.value>0?(B(),he("div",Q1,[H[12]||(H[12]=y("span",null,"Tip:",-1)),y("strong",null,te(de(ye.value)),1)])):Ne("",!0),y("div",j1,[H[13]||(H[13]=y("span",null,"Total Amount:",-1)),y("strong",null,te(de(w.value+ye.value)),1)])]),_:1})]),_:1}),a(pe,{block:"",color:"primary",variant:"outlined",onClick:H[0]||(H[0]=L=>ve.value=!0),class:"mb-4 tip-button",height:"48"},{default:i(()=>[q(te(ye.value>0?`Update Tip (${de(ye.value)})`:"Add Tip"),1)]),_:1})]),_:1}),a(we,{cols:"12",md:"8"},{default:i(()=>[H[29]||(H[29]=y("div",{class:"text-subtitle-1 mb-3 font-weight-medium"},"Select Payment Method",-1)),oe(S).length>0?(B(),Se(Ee,{key:0,class:"payment-methods-grid"},{default:i(()=>[(B(!0),he(gt,null,en(oe(S),L=>(B(),Se(we,{key:L.id,cols:"6",sm:"4"},{default:i(()=>[a(pe,{block:"",color:tt(L.id)?"primary":void 0,variant:tt(L.id)?"flat":"outlined",class:"payment-method-btn",height:"64",onClick:N=>mt(L.id),disabled:dt(L.id)},{default:i(()=>[a(Te,{icon:At(L.name),class:"mr-2"},null,8,["icon"]),q(" "+te(L.name),1)]),_:2},1032,["color","variant","onClick","disabled"])]),_:2},1024))),128))]),_:1})):(B(),Se(sn,{key:1,type:"warning",variant:"tonal",class:"mb-4"},{default:i(()=>H[14]||(H[14]=[q(" No payment methods available. Please configure payment methods in settings. ")])),_:1})),K.value.length>0?(B(),he("div",X1,[(B(!0),he(gt,null,en(K.value,(L,N)=>(B(),he("div",{key:N,class:"payment-section"},[a(Ze,{variant:"outlined",class:"pa-4"},{default:i(()=>{var fe,nt,Jt;return[y("div",e_,[a(Te,{icon:At((fe=oe(h)(L.method_id))==null?void 0:fe.name),class:"mr-2"},null,8,["icon"]),y("span",t_,te((nt=oe(h)(L.method_id))==null?void 0:nt.name),1),a(It),a(pe,{icon:"mdi-close",variant:"text",density:"comfortable",onClick:Nt=>ce(N)},null,8,["onClick"])]),y("div",n_,[H[17]||(H[17]=y("div",{class:"amount-display__label"},"Amount",-1)),y("div",{class:Gt(["amount-display__value-container",{"is-error":!Xe(L)}])},[y("div",r_,[H[15]||(H[15]=y("span",{class:"amount-display__currency"},"$",-1)),q(te(oe(xe).toDollars(L.amount).toFixed(2)),1)])],2),a(Oo,{name:"fade"},{default:i(()=>[Xe(L)?Ne("",!0):(B(),he("div",a_,[a(Te,{icon:"mdi-alert-circle",size:"small",color:"error",class:"mr-1"}),H[16]||(H[16]=q(" Full payment amount is required "))]))]),_:2},1024)]),oe(I)(L.method_id)?(B(),he(gt,{key:0},[(Jt=oe(g)(L.method_id))!=null&&Jt.length?(B(),he("div",o_,[H[18]||(H[18]=y("div",{class:"text-subtitle-2 mb-2"},"Quick Amount Selection",-1)),a(Ee,null,{default:i(()=>[(B(!0),he(gt,null,en(oe(g)(L.method_id),Nt=>(B(),Se(we,{key:Nt.id,cols:"4",class:"pa-1"},{default:i(()=>[a(pe,{block:"",variant:"outlined",class:"denomination-btn",size:"small",onClick:dn=>lt(Nt,N)},{default:i(()=>[q(te(de(oe(xe).toCents(Nt.amount))),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)])):Ne("",!0),y("div",i_,[H[21]||(H[21]=y("div",{class:"amount-display__label"},"Amount Received",-1)),y("div",{class:Gt(["amount-display__value-container",{"is-error":!ne(L)}])},[y("div",s_,[H[19]||(H[19]=y("span",{class:"amount-display__currency"},"$",-1)),ns(y("input",{"onUpdate:modelValue":Nt=>L.displayReceived=Nt,type:"number",class:"amount-display__input",step:"0.01",min:"0",onInput:Nt=>Ke(N)},null,40,l_),[[Yu,L.displayReceived]])])],2),a(Oo,{name:"fade"},{default:i(()=>[ne(L)?Ne("",!0):(B(),he("div",u_,[a(Te,{icon:"mdi-alert-circle",size:"small",color:"error",class:"mr-1"}),H[20]||(H[20]=q(" Received amount must be greater than or equal to payment amount "))]))]),_:2},1024)])],64)):Ne("",!0),Ve(L.method_id)?(B(),he("div",d_,[y("div",c_,[H[22]||(H[22]=y("span",null,"Service Fee:",-1)),y("strong",null,te(de(L.fees)),1)]),y("div",f_,te(Pt(L.method_id,L.amount)),1)])):Ne("",!0),y("div",m_,[H[23]||(H[23]=y("span",null,"Payment Amount:",-1)),y("strong",null,"$"+te(oe(xe).toDollars(L.amount).toFixed(2)),1)]),L.displayReceived?(B(),he("div",p_,[H[24]||(H[24]=y("span",null,"Amount Received:",-1)),y("strong",null,"$"+te(Number(L.displayReceived).toFixed(2)),1)])):Ne("",!0),L.returned>0?(B(),he("div",v_,[H[25]||(H[25]=y("span",null,"Change:",-1)),y("strong",null,"$"+te(oe(xe).toDollars(L.returned).toFixed(2)),1)])):Ne("",!0),L.fees?(B(),he("div",g_,[H[26]||(H[26]=y("span",null,"Fees:",-1)),y("strong",null,te(de(L.fees)),1)])):Ne("",!0),N<K.value.length-1?(B(),Se(Ir,{key:5,class:"my-4"})):Ne("",!0)]}),_:2},1024)]))),128)),Ce.value?(B(),Se(pe,{key:0,block:"",color:"primary",variant:"outlined",onClick:Ct,class:"mt-4",height:"48"},{default:i(()=>[a(Te,{start:""},{default:i(()=>H[27]||(H[27]=[q("mdi-plus")])),_:1}),H[28]||(H[28]=q(" Add Another Payment Method "))]),_:1})):Ne("",!0)])):Ne("",!0)]),_:1})]),_:1}),k.value?(B(),Se(sn,{key:0,type:"error",variant:"tonal",closable:"",class:"error-alert","onClick:close":H[1]||(H[1]=L=>k.value=null)},{default:i(()=>[q(te(k.value),1)]),_:1})):Ne("",!0),y("div",y_,[a(pe,{color:"primary",size:"large",block:"",height:"56",onClick:tn,loading:J.value,disabled:!Y.value||J.value,class:"process-payment-btn"},{default:i(()=>[a(Te,{start:""},{default:i(()=>H[30]||(H[30]=[q("mdi-cash-register")])),_:1}),H[31]||(H[31]=q(" Process Payment "))]),_:1},8,["loading","disabled"])])]),_:1}))])]),_:1})]),_:1},8,["modelValue"]),a(Vt,{modelValue:ve.value,"onUpdate:modelValue":H[4]||(H[4]=L=>ve.value=L),"max-width":"400px"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(Rn,{class:"text-h6"},{default:i(()=>H[32]||(H[32]=[q(" Select Tip Amount ")])),_:1}),a(ht,null,{default:i(()=>[H[34]||(H[34]=y("p",{class:"text-subtitle-2 mb-4"},"Choose a tip percentage or enter a custom amount.",-1)),a(Ee,{class:"mb-4"},{default:i(()=>[(B(),he(gt,null,en(me,L=>a(we,{key:L,cols:"3"},{default:i(()=>[a(pe,{block:"",variant:$.value===L?"flat":"outlined",color:$.value===L?"primary":void 0,onClick:N=>Ue(L)},{default:i(()=>[q(te(L)+"% ",1)]),_:2},1032,["variant","color","onClick"])]),_:2},1024)),64))]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(ft,{modelValue:ge.value,"onUpdate:modelValue":H[3]||(H[3]=L=>ge.value=L),label:"Custom %",type:"number",min:"0",max:"100","append-inner-text":"%",onInput:Ie},null,8,["modelValue"])]),_:1})]),_:1}),ie.value>0?(B(),Se(Ee,{key:0},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[y("div",h_,[H[33]||(H[33]=y("span",null,"Tip Amount:",-1)),y("strong",null,te(de(ie.value)),1)])]),_:1})]),_:1})):Ne("",!0)]),_:1}),a(wn,null,{default:i(()=>[a(It),a(pe,{color:"grey",variant:"text",onClick:wt},{default:i(()=>H[35]||(H[35]=[q(" Cancel ")])),_:1}),a(pe,{color:"primary",onClick:pt},{default:i(()=>H[36]||(H[36]=[q(" Confirm Tip ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a($o,{modelValue:T.value,"onUpdate:modelValue":H[5]||(H[5]=L=>T.value=L),"pdf-url":re.value,title:"Invoice",onClosed:M},null,8,["modelValue","pdf-url"])]))}},rs=_t(__,[["__scopeId","data-v-e75d4416"]]);const w_={class:"payment-content"},b_={class:"d-flex justify-space-between mb-2"},I_={class:"d-flex justify-space-between mb-2"},P_={key:0,class:"d-flex justify-space-between mb-2"},C_={class:"d-flex justify-space-between"},x_={class:"d-flex align-center mb-4"},S_={class:"text-h6"},O_={class:"amount-display"},T_={class:"amount-display__amount"},D_={key:0,class:"amount-display__error"},E_={key:0,class:"mb-4"},A_={class:"amount-display"},N_={class:"amount-display__amount"},$_=["onUpdate:modelValue","onInput"],V_={key:0,class:"amount-display__error"},F_={class:"d-flex justify-space-between align-center"},k_={class:"text-h5 font-weight-bold"},R_={key:1,class:"text-caption mb-2"},L_={class:"d-flex justify-space-between"},U_={class:"text-grey"},M_={class:"d-flex justify-space-between mb-2"},z_={class:"d-flex justify-space-between mb-2"},q_={class:"d-flex justify-space-between"},G_={class:"d-flex justify-space-between"},H_={__name:"PaymentInvoiceDialog",props:{modelValue:Boolean,createInvoiceOnly:{type:Boolean,default:!1},invoice:{type:Object,required:!1,default:()=>({invoice:{},invoicePrefix:"",nextInvoiceNumber:""})}},emits:["update:modelValue","payment-complete"],setup(s,{emit:u}){const o=Yt();Ln();const v=s,m=u,{loading:x,error:w,paymentMethods:p,settings:V,createPayment:C,fetchPaymentMethods:S,fetchSettings:G,getDenominations:D,calculateFees:E,getPaymentMethod:P,isCashOnly:g}=Ao(),{loading:b,error:h,releaseTablesAfterPayment:I}=No(),F=_e(()=>x.value||b.value),j=_e(()=>w.value||h.value),se=z(!1),U=z([]),k=_e(()=>{var L,N;return["DRAFT","SENT"].includes((N=(L=v.invoice)==null?void 0:L.invoice)==null?void 0:N.status)}),J=async()=>{var L,N;try{await o.loadInvoice(v.invoice.invoice),(L=window.toastr)==null||L.success("Invoice loaded to cart successfully"),ie.value=!1}catch(fe){console.error("Failed to load invoice to cart:",fe),(N=window.toastr)==null||N.error("Failed to load invoice to cart")}},K=z(!1),T=[15,18,20,25],re=z(null),M=z(""),ve=z(0),me=z("percentage"),$=z(!1),ge=z(""),ye=_e(()=>{var L,N,fe,nt;return((N=(L=v.invoice)==null?void 0:L.invoice)==null?void 0:N.invoice_number)||`${(fe=v.invoice)==null?void 0:fe.invoicePrefix}-${(nt=v.invoice)==null?void 0:nt.nextInvoiceNumber}`||""}),Pe=_e(()=>{var L,N;return xe.normalizePrice(((N=(L=v.invoice)==null?void 0:L.invoice)==null?void 0:N.total)||0)}),Ae=_e(()=>{const L=re.value||Number(M.value)||0;return Math.round(Pe.value*L/100)}),ie=_e({get:()=>v.modelValue,set:L=>m("update:modelValue",L)}),Z=_e(()=>{const L=U.value.reduce((N,fe)=>N+xe.normalizePrice(fe.amount),0);return xe.normalizePrice(Pe.value+ve.value-L)}),$e=_e(()=>U.value.reduce((L,N)=>L+N.amount,0)),Ce=_e(()=>U.value.reduce((L,N)=>L+(N.fees||0),0)),Xe=_e(()=>Z.value>0&&U.value.length<p.value.length),ne=L=>!L.displayAmount||Number(L.displayAmount)<=0?!1:Number(L.displayAmount)===xe.toDollars(Pe.value+ve.value),Y=L=>L.displayReceived?Number(L.displayReceived)>=Number(L.displayAmount):!1,de=_e(()=>U.value.every(L=>!(!L.method_id||!L.amount||g(L.method_id)&&!L.received||!ne(L)||g(L.method_id)&&!Y(L)))&&Z.value===0),Ve=L=>xe.formatInvoiceAmount(L),Pt=()=>{$.value=!1,ge.value=""},At=L=>{const N=P(L);return(N==null?void 0:N.IsPaymentFeeActive)==="YES"},tt=(L,N)=>{const fe=P(L);if(!(fe!=null&&fe.registrationdatafees))return"";const nt=fe.registrationdatafees;switch(nt.type){case"FIXED":return`Fixed fee: ${Ve(nt.value)}`;case"PERCENTAGE":return`${nt.value}% of transaction amount`;case"FIXED_PLUS_PERCENTAGE":return`${Ve(nt.value.fixed)} + ${nt.value.percentage}% of transaction amount`;default:return""}},dt=L=>({Cash:"mdi-cash","Credit Card":"mdi-credit-card","Debit Card":"mdi-credit-card-outline",Check:"mdi-checkbox-marked-circle-outline","Gift Card":"mdi-gift","Mobile Payment":"mdi-cellphone","Bank Transfer":"mdi-bank"})[L]||"mdi-currency-usd",mt=L=>U.value.some(N=>N.method_id===L),lt=L=>mt(L)||U.value.length>=p.value.length,Ke=L=>{if(mt(L)||lt(L))return;const N=Z.value,fe=(N/100).toString();U.value.push({method_id:L,amount:N,displayAmount:fe,received:N,displayReceived:fe,returned:0,fees:0}),ce(U.value.length-1)},qe=(L,N)=>{const fe=U.value[N];fe.displayReceived=L.amount.toString(),fe.received=Math.round(Number(L.amount)*100),Ct(N)},Ct=L=>{const N=U.value[L];if(!N.displayReceived||!N.displayAmount)return;const fe=Math.round(Number(N.displayReceived)*100),nt=N.amount;N.received=fe,fe>=nt?N.returned=fe-nt:N.returned=0},ce=L=>{const N=U.value[L];N.displayAmount&&(N.displayAmount=((Pe.value+ve.value)/100).toString(),N.amount=Math.round(Number(N.displayAmount)*100),At(N.method_id)&&(N.fees=E(N.method_id,N.amount)),g(N.method_id)&&(N.displayReceived=N.displayAmount,N.received=N.amount,N.returned=0))},le=()=>{U.value.push({method_id:null,amount:0,displayAmount:((Pe.value+ve.value)/100).toString(),received:0,displayReceived:"0",returned:0,fees:0})},Ue=L=>{U.value.splice(L,1),U.value.forEach((N,fe)=>ce(fe))},Ie=()=>{se.value||(ie.value=!1)},wt=L=>{re.value=L,M.value=""},pt=()=>{re.value=null},tn=()=>{K.value=!1,re.value=null,M.value=""},ue=()=>{ve.value=Ae.value,me.value="percentage",K.value=!1,U.value.forEach((L,N)=>ce(N))},H=async()=>{var L,N,fe,nt,Jt,Nt,dn,Lt,Un,Kn,Yn,Cr;if(console.log("PaymentDialog: Starting payment processing",{isValid:de.value,processing:se.value,invoiceTotal:Pe.value,tipAmount:ve.value,payments:U.value,invoice:v.invoice}),!de.value||se.value){console.log("PaymentDialog: Cannot process - validation failed or already processing");return}se.value=!0;try{console.log("PaymentDialog: Starting invoice creation with props:",{invoice:v.invoice,hasInvoiceData:!!((L=v.invoice)!=null&&L.invoice),invoiceTotal:Pe.value,tipAmount:ve.value});let ot;const cn=((N=v.invoice)==null?void 0:N.invoice)||v.invoice;if(!cn)throw new Error("Invoice data not provided");console.log("PaymentDialog: Processing invoice data:",{invoiceData:cn,isHoldInvoice:cn.is_hold_invoice,total:cn.total,dueAmount:cn.due_amount});const Ht=Pe.value+ve.value,Jn=re.value||Number(M.value)||0;if(cn.is_hold_invoice){console.log("PaymentDialog: Processing hold invoice conversion");const rt={...cn,tip:String(Math.round(Jn)),tip_type:"percentage",tip_val:ve.value,total:Ht,due_amount:Ht,sub_total:Pe.value},$t=await Qu(rt);if(!$t.success)throw console.error("Hold invoice conversion failed:",$t.error),new Error($t.error||"Failed to create invoice from hold order");console.log("Hold invoice converted successfully:",{holdInvoiceId:rt.id,newInvoiceId:$t.invoice.id,invoiceNumber:$t.invoice.invoice_number}),ot={invoice:{...$t.invoice,id:$t.invoice.id,invoice_number:$t.invoice.invoice_number,hold_invoice_id:rt.id,tip:String(Math.round(Jn)),tip_type:"percentage",tip_val:ve.value,total:Ht,due_amount:Ht,sub_total:Pe.value}}}else ot={invoice:{...cn,tip:String(Math.round(Jn)),tip_type:"percentage",tip_val:ve.value,total:Ht,due_amount:Ht,sub_total:Pe.value}};if(v.createInvoiceOnly)try{const rt={...ot,is_hold_invoice:!0,status:"HELD",description:ot.description||"Delivery Order"};if(!(await _n.holdInvoice.create(rt)).success)throw new Error("Failed to add invoice to held orders");(fe=window.toastr)==null||fe.success("Invoice created and added to held orders"),m("payment-complete",!0),ie.value=!1;return}catch(rt){throw console.error("Failed to add to held orders:",rt),new Error("Failed to add invoice to held orders")}const ra=Ln(),fr=U.value.map(rt=>({method_id:rt.method_id,name:P(rt.method_id).name,amount:rt.amount,received:rt.received,returned:rt.returned,valid:!0})),Zn=fr.reduce((rt,$t)=>rt+$t.amount,0);if(console.log("Payment validation:",{totalPaymentAmount:Zn,totalWithTip:Ht,difference:Math.abs(Zn-Ht)}),Math.abs(Zn-Ht)>1)throw new Error(`Payment amount (${Zn}) must match invoice total including tip (${Ht})`);console.log("Final invoice for payment:",ot);const Mn=((nt=ot.invoice)==null?void 0:nt.id)||ot.id,Qn=((Jt=ot.invoice)==null?void 0:Jt.invoice_number)||ot.invoice_number||Mn;if(!Mn)throw new Error("Invalid invoice: missing ID");console.log("PaymentDialog: Final invoice details:",{invoiceId:Mn,invoiceNumber:Qn,total:ot.total||((Nt=ot.invoice)==null?void 0:Nt.total),dueAmount:ot.due_amount||((dn=ot.invoice)==null?void 0:dn.due_amount)}),console.log("Processing payment with:",{invoiceId:Mn,invoiceNumber:Qn,finalInvoice:ot,payments:fr});const xr=await C({...ot,id:Mn,invoice_number:Qn},fr);if(ot.type==="DINE_IN"&&((Lt=ot.tables_selected)!=null&&Lt.length))try{await I(invoiceResult.invoice.tables_selected)}catch(rt){console.error("Failed to release tables:",rt),(Un=window.toastr)==null||Un.warning("Payment successful, but failed to update table status")}try{const rt=((Kn=ot==null?void 0:ot.invoice)==null?void 0:Kn.invoice)||(ot==null?void 0:ot.invoice);if(!(rt!=null&&rt.unique_hash))throw console.error("📄 [Invoice PDF] Missing invoice hash:",rt),new Error("Could not generate invoice PDF: Missing invoice hash");const $t=rt.invoicePdfUrl||`${"https://lajuanita.corebill.co/api/v1".replace("/api/v1","")}/invoices/pdf/${rt.unique_hash}`;console.log("📄 [Invoice PDF] Opening PDF viewer with URL:",$t),ge.value=$t,$.value=!0,m("payment-complete",{...xr,invoicePdfUrl:$t}),ie.value=!1}catch(rt){console.error("📄 [Invoice PDF] Failed to display invoice:",rt),(Yn=window.toastr)==null||Yn.error(rt.message||"Failed to display invoice PDF"),m("payment-complete",xr),ie.value=!1}}catch(ot){console.error("Payment processing error:",ot),(Cr=window.toastr)==null||Cr.error(ot.message||"Failed to process payment")}finally{se.value=!1}};return Be(()=>ie.value,async L=>{var N;if(L)try{await G(),U.value=[],se.value=!1,ve.value=0,re.value=null,M.value="",await S()}catch(fe){console.error("Failed to initialize payment dialog:",fe),(N=window.toastr)==null||N.error("Failed to initialize payment"),ie.value=!1}}),(L,N)=>(B(),he(gt,null,[a(Vt,{modelValue:ie.value,"onUpdate:modelValue":N[2]||(N[2]=fe=>ie.value=fe),fullscreen:"",transition:"dialog-bottom-transition",scrim:!1,class:"payment-dialog"},{default:i(()=>[a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",elevation:1},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>[a(Te,{icon:"mdi-cash-register",size:"large",class:"mr-2"}),N[5]||(N[5]=q(" Process Payment "))]),_:1}),a(It),a(pe,{color:"primary",variant:"text",class:"mr-2",onClick:J,disabled:!k.value},{default:i(()=>[a(Te,{start:""},{default:i(()=>N[6]||(N[6]=[q("mdi-cart-arrow-down")])),_:1}),N[7]||(N[7]=q(" Load to Cart "))]),_:1},8,["disabled"]),a(pe,{icon:"mdi-close",variant:"text",onClick:Ie,class:"ml-2",size:"large"})]),_:1}),y("div",w_,[a(bn,{class:"payment-container"},{default:i(()=>[F.value?(B(),Se(Ee,{key:0},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(by,{class:"pa-3"},{default:i(()=>[a(Iy,{type:"article, actions",class:"mx-auto"})]),_:1})]),_:1})]),_:1})):(B(),he(gt,{key:1},[a(Ee,null,{default:i(()=>[a(we,{cols:"12",md:"4"},{default:i(()=>[a(Ze,{variant:"elevated",class:"invoice-summary-card mb-4",elevation:"2"},{default:i(()=>[a(Xi,null,{prepend:i(()=>[a(Te,{icon:"mdi-receipt",size:"large",color:"primary",class:"mr-4"})]),default:i(()=>[a(Rn,{class:"text-h6 pb-2"},{default:i(()=>N[8]||(N[8]=[q(" Invoice Summary ")])),_:1})]),_:1}),a(Ir),a(ht,{class:"py-4"},{default:i(()=>[y("div",b_,[N[9]||(N[9]=y("span",null,"Invoice Number:",-1)),y("strong",null,te(ye.value),1)]),y("div",I_,[N[10]||(N[10]=y("span",null,"Subtotal:",-1)),y("strong",null,te(Ve(Pe.value)),1)]),ve.value>0?(B(),he("div",P_,[N[11]||(N[11]=y("span",null,"Tip:",-1)),y("strong",null,te(Ve(ve.value)),1)])):Ne("",!0),y("div",C_,[N[12]||(N[12]=y("span",null,"Total Amount:",-1)),y("strong",null,te(Ve(Pe.value+ve.value)),1)])]),_:1})]),_:1}),a(pe,{block:"",color:"primary",variant:"outlined",onClick:N[0]||(N[0]=fe=>K.value=!0),class:"mb-4"},{default:i(()=>[q(te(ve.value>0?`Update Tip (${Ve(ve.value/100)})`:"Add Tip"),1)]),_:1})]),_:1}),a(we,{cols:"12",md:"8"},{default:i(()=>[N[13]||(N[13]=y("div",{class:"text-subtitle-1 mb-3 font-weight-medium"},"Select Payment Method",-1)),a(Ee,{class:"payment-methods-grid"},{default:i(()=>[(B(!0),he(gt,null,en(oe(p),fe=>(B(),Se(we,{key:fe.id,cols:"6",sm:"4"},{default:i(()=>[a(pe,{block:"",color:mt(fe.id)?"primary":void 0,variant:mt(fe.id)?"flat":"outlined",class:"payment-method-btn",height:"64",disabled:lt(fe.id),onClick:nt=>Ke(fe.id)},{default:i(()=>[a(Te,{icon:dt(fe.name),class:"mr-2"},null,8,["icon"]),q(" "+te(fe.name),1)]),_:2},1032,["color","variant","disabled","onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),U.value.length>0?(B(),Se(Ee,{key:0},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[(B(!0),he(gt,null,en(U.value,(fe,nt)=>(B(),he("div",{key:nt,class:"payment-section mb-4"},[a(Ze,{variant:"outlined",class:"pa-4"},{default:i(()=>{var Jt,Nt,dn;return[y("div",x_,[a(Te,{icon:dt((Jt=oe(P)(fe.method_id))==null?void 0:Jt.name),class:"mr-2"},null,8,["icon"]),y("span",S_,te((Nt=oe(P)(fe.method_id))==null?void 0:Nt.name),1),a(It),a(pe,{icon:"mdi-close",variant:"text",density:"comfortable",onClick:Lt=>Ue(nt)},null,8,["onClick"])]),y("div",O_,[N[16]||(N[16]=y("div",{class:"amount-display__label"},"Amount",-1)),y("div",{class:Gt(["amount-display__value-container",{"is-error":!ne(fe)}])},[y("div",T_,[N[14]||(N[14]=y("span",{class:"amount-display__currency"},"$",-1)),q(te(oe(xe).toDollars(fe.amount).toFixed(2)),1)])],2),a(Oo,{name:"fade"},{default:i(()=>[ne(fe)?Ne("",!0):(B(),he("div",D_,[a(Te,{icon:"mdi-alert-circle",size:"small",color:"error",class:"mr-1"}),N[15]||(N[15]=q(" Full payment amount is required "))]))]),_:2},1024)]),oe(g)(fe.method_id)?(B(),he(gt,{key:0},[(dn=oe(D)(fe.method_id))!=null&&dn.length?(B(),he("div",E_,[N[17]||(N[17]=y("div",{class:"text-subtitle-2 mb-2"},"Quick Amount Selection",-1)),a(Ee,null,{default:i(()=>[(B(!0),he(gt,null,en(oe(D)(fe.method_id),Lt=>(B(),Se(we,{key:Lt.id,cols:"4",class:"pa-1"},{default:i(()=>[a(pe,{block:"",variant:"outlined",size:"small",onClick:Un=>qe(Lt,nt)},{default:i(()=>[q(te(Ve(oe(xe).toCents(Lt.amount))),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:2},1024)])):Ne("",!0),y("div",A_,[N[20]||(N[20]=y("div",{class:"amount-display__label"},"Amount Received",-1)),y("div",{class:Gt(["amount-display__value-container",{"is-error":!Y(fe)}])},[y("div",N_,[N[18]||(N[18]=y("span",{class:"amount-display__currency"},"$",-1)),ns(y("input",{"onUpdate:modelValue":Lt=>fe.displayReceived=Lt,type:"number",class:"amount-display__input",step:"0.01",min:"0",onInput:Lt=>Ct(nt)},null,40,$_),[[Yu,fe.displayReceived]])])],2),a(Oo,{name:"fade"},{default:i(()=>[Y(fe)?Ne("",!0):(B(),he("div",V_,[a(Te,{icon:"mdi-alert-circle",size:"small",color:"error",class:"mr-1"}),N[19]||(N[19]=q(" Received amount must be greater than or equal to payment amount "))]))]),_:2},1024)]),fe.returned>0?(B(),Se(Ze,{key:1,color:"primary",class:"change-amount-card mb-2"},{default:i(()=>[a(ht,{class:"pa-3"},{default:i(()=>[y("div",F_,[N[21]||(N[21]=y("span",{class:"text-h6 font-weight-medium"},"Change Due:",-1)),y("span",k_,te(Ve(fe.returned/100)),1)])]),_:2},1024)]),_:2},1024)):Ne("",!0)],64)):Ne("",!0),At(fe.method_id)?(B(),he("div",R_,[y("div",L_,[N[22]||(N[22]=y("span",null,"Service Fee:",-1)),y("strong",null,te(Ve(fe.fees/100)),1)]),y("div",U_,te(tt(fe.method_id,fe.amount)),1)])):Ne("",!0),nt<U.value.length-1?(B(),Se(Ir,{key:2,class:"my-4"})):Ne("",!0)]}),_:2},1024)]))),128)),Xe.value?(B(),Se(pe,{key:0,color:"primary",variant:"outlined",size:"small",class:"mt-2",onClick:le},{default:i(()=>N[23]||(N[23]=[q(" Add Payment Method ")])),_:1})):Ne("",!0),Ce.value>0?(B(),Se(Ze,{key:1,variant:"outlined",class:"mt-4"},{default:i(()=>[a(ht,null,{default:i(()=>[y("div",M_,[N[24]||(N[24]=y("span",null,"Subtotal:",-1)),y("strong",null,te(Ve($e.value/100)),1)]),y("div",z_,[N[25]||(N[25]=y("span",null,"Service Fees:",-1)),y("strong",null,te(Ve(Ce.value/100)),1)]),y("div",q_,[N[26]||(N[26]=y("span",null,"Total:",-1)),y("strong",null,te(Ve(($e.value+Ce.value)/100)),1)])]),_:1})]),_:1})):Ne("",!0)]),_:1})]),_:1})):Ne("",!0),j.value?(B(),Se(Ee,{key:1},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(sn,{type:"error",variant:"tonal"},{default:i(()=>[q(te(j.value),1)]),_:1})]),_:1})]),_:1})):Ne("",!0)],64))]),_:1}),a($o,{modelValue:$.value,"onUpdate:modelValue":N[1]||(N[1]=fe=>$.value=fe),pdfUrl:ge.value,onClosed:Pt},null,8,["modelValue","pdfUrl"])]),a(wn,{class:"pa-4"},{default:i(()=>[a(pe,{block:"",color:"primary",variant:"flat",size:"large",height:"56",loading:se.value,disabled:!de.value||se.value,onClick:H,class:"process-payment-btn"},{default:i(()=>N[27]||(N[27]=[q(" Process Payment ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Vt,{modelValue:K.value,"onUpdate:modelValue":N[4]||(N[4]=fe=>K.value=fe),"max-width":"400px"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(Rn,{class:"text-h6"},{default:i(()=>N[28]||(N[28]=[q(" Select Tip Amount ")])),_:1}),a(ht,null,{default:i(()=>[N[30]||(N[30]=y("p",{class:"text-subtitle-2 mb-4"},"Choose a tip percentage or enter a custom amount.",-1)),a(Ee,{class:"mb-4"},{default:i(()=>[(B(),he(gt,null,en(T,fe=>a(we,{key:fe,cols:"3"},{default:i(()=>[a(pe,{block:"",variant:re.value===fe?"flat":"outlined",color:re.value===fe?"primary":void 0,onClick:nt=>wt(fe)},{default:i(()=>[q(te(fe)+"% ",1)]),_:2},1032,["variant","color","onClick"])]),_:2},1024)),64))]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(ft,{modelValue:M.value,"onUpdate:modelValue":N[3]||(N[3]=fe=>M.value=fe),label:"Custom %",type:"number",min:"0",max:"100","append-inner-text":"%",onInput:pt},null,8,["modelValue"])]),_:1})]),_:1}),Ae.value>0?(B(),Se(Ee,{key:0},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[y("div",G_,[N[29]||(N[29]=y("span",null,"Tip Amount:",-1)),y("strong",null,te(Ve(Ae.value/100)),1)])]),_:1})]),_:1})):Ne("",!0)]),_:1}),a(wn,null,{default:i(()=>[a(It),a(pe,{color:"grey",variant:"text",onClick:tn},{default:i(()=>N[31]||(N[31]=[q(" Cancel ")])),_:1}),a(pe,{color:"primary",onClick:ue},{default:i(()=>N[32]||(N[32]=[q(" Confirm Tip ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},B_=_t(H_,[["__scopeId","data-v-681bd7dc"]]);const W_={class:"table-container"},K_={class:"text-truncate"},Y_={class:"text-right"},J_={class:"actions-wrapper"},Z_={key:0,class:"pagination-container"},Q_={class:"mb-2"},j_={class:"mb-2"},X_={class:"mb-2"},ew={class:"mb-2"},tw={class:"mb-2"},nw={class:"mb-2"},rw={class:"mb-2"},aw={class:"text-right"},ow={class:"text-right"},iw={class:"text-right"},sw={class:"d-flex justify-space-between mb-2"},lw={class:"d-flex justify-space-between mb-2"},uw={class:"d-flex justify-space-between"},dw={__name:"OrderInvoicesTable",props:{invoices:{type:Array,required:!0,default:()=>[]},loading:{type:Boolean,default:!1},page:{type:Number,default:1},totalPages:{type:Number,default:1},getOrderType:{type:Function,required:!1},getOrderTypeColor:{type:Function,required:!1},formatDate:{type:Function,required:!1},showPagination:{type:Boolean,default:!1},selectedFilter:{type:String,default:"all"}},emits:["invoice-paid","page-change"],setup(s,{emit:u}){const o=s,v=Yt();console.log("OrderInvoicesTable - Initial props:",{invoicesCount:o.invoices.length,loading:o.loading,page:o.page,totalPages:o.totalPages}),Be(()=>o.invoices,(U,k)=>{console.log("OrderInvoicesTable - Invoices changed:",{oldCount:(k==null?void 0:k.length)||0,newCount:U.length,invoices:U.map(J=>({id:J.id,invoice_number:J.invoice_number,status:J.status,paid_status:J.paid_status,total:J.total,formatted_total:xe.format(J.total)}))})},{deep:!0});const m=u,x=z(!1),w=z(!1),p=z(null),V=z(!1),C=z(null),S=z(!1),G=z("");_e(()=>o.totalPages>1);const D=U=>new Date(U).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),E=U=>{if(!U)return 0;const k=typeof U=="string"?parseFloat(U):U;return k>1e3?xe.toDollars(k):k},P=()=>{S.value=!1,G.value=""},g=async U=>{var J,K,T,re;const k={...U,total:E(U.total),hold_items:(J=U.items)==null?void 0:J.map(M=>({item_id:M.item_id||M.id,name:M.name,description:M.description,price:E(M.price),total:E(M.total),quantity:M.quantity,unit_name:M.unit_name})),type:U.type||"DINE_IN"};console.log("OrderInvoicesTable - Loading invoice to cart:",{id:k.id,invoice_number:k.invoice_number,total:k.total,formatted_total:xe.format(k.total),items:(K=k.hold_items)==null?void 0:K.map(M=>({id:M.item_id,name:M.name,price:M.price,formatted_price:xe.format(M.price),quantity:M.quantity}))});try{await v.loadInvoice(k),(T=window.toastr)==null||T.success("Invoice loaded to cart successfully"),console.log("OrderInvoicesTable - Invoice loaded to cart successfully:",{invoice_id:k.id,invoice_number:k.invoice_number}),m("page-change",1)}catch(M){console.error("OrderInvoicesTable - Failed to load invoice to cart:",M),(re=window.toastr)==null||re.error("Failed to load invoice to cart")}},b=U=>{const k={DRAFT:"grey",SENT:"info",VIEWED:"warning",EXPIRED:"error",DECLINED:"error",ACCEPTED:"success",COMPLETED:"success"}[U==null?void 0:U.toUpperCase()]||"grey";return console.log("OrderInvoicesTable - Status color:",{status:U,color:k}),k},h=U=>{const k={PAID:"success",PARTIALLY_PAID:"warning",UNPAID:"error"}[U==null?void 0:U.toUpperCase()]||"error";return console.log("OrderInvoicesTable - Paid status color:",{status:U,color:k}),k},I=async U=>{console.log("OrderInvoicesTable - Showing invoice details:",{id:U.id,invoice_number:U.invoice_number,status:U.status,paid_status:U.paid_status,total:U.total,formatted_total:xe.format(U.total)}),C.value=U,V.value=!0},F=U=>{console.log("OrderInvoicesTable - Pay clicked:",{id:U.id,invoice_number:U.invoice_number,total:U.total,formatted_total:xe.format(U.total)}),p.value=U,w.value=!0},j=()=>{var U,k;console.log("OrderInvoicesTable - Payment confirmed:",{invoice_id:(U=p.value)==null?void 0:U.id,invoice_number:(k=p.value)==null?void 0:k.invoice_number}),w.value=!1,x.value=!0},se=async U=>{var k,J,K;try{console.log("OrderInvoicesTable - Payment completed:",{result:U,invoice_id:(k=p.value)==null?void 0:k.id,invoice_number:(J=p.value)==null?void 0:J.invoice_number}),U!=null&&U.invoicePdfUrl?(console.log("📄 [Invoice PDF] Opening PDF viewer with URL:",U.invoicePdfUrl),G.value=U.invoicePdfUrl,S.value=!0):console.warn("📄 [Invoice PDF] No payment PDF URL provided in result:",U),x.value=!1,p.value=null,m("invoice-paid",U)}catch(T){console.error("📄 [Invoice PDF] Failed to display invoice:",T),(K=window.toastr)==null||K.error(T.message||"Failed to display invoice PDF"),x.value=!1,p.value=null,m("invoice-paid",U)}};return(U,k)=>{var J,K;return B(),he(gt,null,[y("div",{class:Gt(["order-invoices-table",U.$attrs.class])},[y("div",W_,[a(Qi,{"fixed-header":"",class:"invoices-table"},{default:i(()=>[k[13]||(k[13]=y("thead",null,[y("tr",null,[y("th",{class:"text-left date-col"},"Date"),y("th",{class:"text-left invoice-col"},"Invoice #"),y("th",{class:"text-left customer-col"},"Customer"),y("th",{class:"text-left status-col"},"Status"),y("th",{class:"text-left payment-col"},"Payment"),y("th",{class:"text-right total-col"},"Total"),y("th",{class:"text-center actions-col"},"Actions")])],-1)),y("tbody",null,[(B(!0),he(gt,null,en(s.invoices,T=>{var re;return B(),he("tr",{key:T.id},[y("td",null,te(T!=null&&T.created_at?D(T.created_at):"N/A"),1),y("td",null,te((T==null?void 0:T.invoice_number)||"N/A"),1),y("td",K_,te(((re=T==null?void 0:T.contact)==null?void 0:re.name)||(T==null?void 0:T.first_name)||(T==null?void 0:T.name)||"Walk-in Customer"),1),y("td",null,[a(lr,{color:b(T.status),size:"small",variant:"flat",class:"status-chip"},{default:i(()=>[q(te(T.status),1)]),_:2},1032,["color"])]),y("td",null,[a(lr,{color:h(T.paid_status),size:"small",variant:"flat",class:"status-chip"},{default:i(()=>[q(te(T.paid_status||"UNPAID"),1)]),_:2},1032,["color"])]),y("td",Y_,te(oe(xe).format(T.total)),1),y("td",null,[y("div",J_,[T.paid_status==="UNPAID"?(B(),Se(pe,{key:0,color:"success",size:"small",variant:"flat",onClick:M=>F(T)},{default:i(()=>[a(Te,{size:"small",class:"mr-1"},{default:i(()=>k[7]||(k[7]=[q("mdi-cash-register")])),_:1}),k[8]||(k[8]=q(" PAY "))]),_:2},1032,["onClick"])):Ne("",!0),a(pe,{color:"info",size:"small",variant:"flat",onClick:M=>I(T)},{default:i(()=>[a(Te,{size:"small",class:"mr-1"},{default:i(()=>k[9]||(k[9]=[q("mdi-information")])),_:1}),k[10]||(k[10]=q(" DETAILS "))]),_:2},1032,["onClick"]),["DRAFT","SENT"].includes(T.status)?(B(),Se(pe,{key:1,color:"primary",size:"small",variant:"flat",onClick:M=>g(T)},{default:i(()=>[a(Te,{size:"small",class:"mr-1"},{default:i(()=>k[11]||(k[11]=[q("mdi-cart-arrow-down")])),_:1}),k[12]||(k[12]=q(" LOAD TO CART "))]),_:2},1032,["onClick"])):Ne("",!0)])])])}),128))])]),_:1})]),s.showPagination?(B(),he("div",Z_,[a(Eo,{"model-value":s.page,"onUpdate:modelValue":k[0]||(k[0]=T=>U.$emit("page-change",T)),length:s.totalPages,"total-visible":5},null,8,["model-value","length"])])):Ne("",!0)],2),a(Vt,{modelValue:w.value,"onUpdate:modelValue":k[2]||(k[2]=T=>w.value=T),"max-width":"400"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(Rn,{class:"text-h6"},{default:i(()=>k[14]||(k[14]=[q(" Confirm Payment ")])),_:1}),a(ht,null,{default:i(()=>{var T;return[q(" Are you sure you want to process payment for invoice #"+te((T=p.value)==null?void 0:T.invoice_number)+"? ",1)]}),_:1}),a(wn,null,{default:i(()=>[a(It),a(pe,{color:"grey-darken-1",variant:"text",onClick:k[1]||(k[1]=T=>w.value=!1)},{default:i(()=>k[15]||(k[15]=[q(" Cancel ")])),_:1}),a(pe,{color:"success",onClick:j},{default:i(()=>k[16]||(k[16]=[q(" Proceed to Payment ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(B_,{modelValue:x.value,"onUpdate:modelValue":k[3]||(k[3]=T=>x.value=T),invoice:{invoice:p.value,invoicePrefix:((J=p.value)==null?void 0:J.invoice_prefix)||"INV",nextInvoiceNumber:(K=p.value)==null?void 0:K.id},onPaymentComplete:se},null,8,["modelValue","invoice"]),a($o,{modelValue:S.value,"onUpdate:modelValue":k[4]||(k[4]=T=>S.value=T),pdfUrl:G.value,onClosed:P},null,8,["modelValue","pdfUrl"]),a(Vt,{modelValue:V.value,"onUpdate:modelValue":k[6]||(k[6]=T=>V.value=T),"max-width":"700"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(ln,{color:"primary",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6"},{default:i(()=>k[17]||(k[17]=[q(" Invoice Details ")])),_:1}),a(It),a(pe,{icon:"mdi-close",variant:"text",onClick:k[5]||(k[5]=T=>V.value=!1)})]),_:1}),a(ht,{class:"pa-4"},{default:i(()=>[C.value?(B(),he(gt,{key:0},[a(Ee,null,{default:i(()=>[a(we,{cols:"12",sm:"6"},{default:i(()=>[k[22]||(k[22]=y("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Basic Information",-1)),y("div",Q_,[k[18]||(k[18]=y("strong",null,"Invoice Number:",-1)),q(" "+te(C.value.invoice_number),1)]),y("div",j_,[k[19]||(k[19]=y("strong",null,"Date:",-1)),q(" "+te(D(C.value.created_at)),1)]),y("div",X_,[k[20]||(k[20]=y("strong",null,"Status:",-1)),a(lr,{color:b(C.value.status),size:"small",class:"text-uppercase ml-2"},{default:i(()=>[q(te(C.value.status),1)]),_:1},8,["color"])]),y("div",ew,[k[21]||(k[21]=y("strong",null,"Payment Status:",-1)),a(lr,{color:h(C.value.paid_status),size:"small",class:"text-uppercase ml-2"},{default:i(()=>[q(te(C.value.paid_status||"UNPAID"),1)]),_:1},8,["color"])])]),_:1}),a(we,{cols:"12",sm:"6"},{default:i(()=>{var T,re,M,ve;return[k[26]||(k[26]=y("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Customer Information",-1)),y("div",tw,[k[23]||(k[23]=y("strong",null,"Name:",-1)),q(" "+te(((T=C.value.contact)==null?void 0:T.name)||C.value.first_name||C.value.name||"N/A"),1)]),y("div",nw,[k[24]||(k[24]=y("strong",null,"Phone:",-1)),q(" "+te(((re=C.value.contact)==null?void 0:re.phone)||((M=C.value.customer)==null?void 0:M.phone)||C.value.phone||"N/A"),1)]),y("div",rw,[k[25]||(k[25]=y("strong",null,"Email:",-1)),q(" "+te(((ve=C.value.contact)==null?void 0:ve.email)||C.value.email||"N/A"),1)])]}),_:1})]),_:1}),a(Ee,{class:"mt-4"},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[k[28]||(k[28]=y("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Order Items",-1)),a(Qi,{density:"comfortable"},{default:i(()=>[k[27]||(k[27]=y("thead",null,[y("tr",null,[y("th",null,"Item"),y("th",{class:"text-right"},"Quantity"),y("th",{class:"text-right"},"Price"),y("th",{class:"text-right"},"Total")])],-1)),y("tbody",null,[(B(!0),he(gt,null,en(C.value.items,T=>(B(),he("tr",{key:T.id},[y("td",null,te(T.name),1),y("td",aw,te(T.quantity),1),y("td",ow,te(oe(xe).format(E(T.price))),1),y("td",iw,te(oe(xe).format(E(T.total))),1)]))),128))])]),_:1})]),_:1})]),_:1}),a(Ee,{class:"mt-4"},{default:i(()=>[a(we,{cols:"12",sm:"6","offset-sm":"6"},{default:i(()=>[y("div",sw,[k[29]||(k[29]=y("strong",null,"Subtotal:",-1)),y("span",null,te(oe(xe).format(E(C.value.sub_total))),1)]),y("div",lw,[k[30]||(k[30]=y("strong",null,"Tax:",-1)),y("span",null,te(oe(xe).format(E(C.value.tax))),1)]),a(Ir,{class:"my-2"}),y("div",uw,[k[31]||(k[31]=y("strong",null,"Total:",-1)),y("span",null,te(oe(xe).format(E(C.value.total))),1)])]),_:1})]),_:1}),C.value.notes?(B(),Se(Ee,{key:0,class:"mt-4"},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[k[32]||(k[32]=y("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Notes",-1)),a(Ze,{variant:"outlined",class:"pa-3"},{default:i(()=>[q(te(C.value.notes),1)]),_:1})]),_:1})]),_:1})):Ne("",!0)],64)):Ne("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},Fu=_t(dw,[["__scopeId","data-v-b5ebf6d6"]]);const cw={class:"held-orders-container"},fw={class:"filters-container"},mw={class:"filters-container"},pw={__name:"HeldOrdersModal",props:{modelValue:{type:Boolean,required:!0},disabled:{type:Boolean,default:!1}},emits:["update:model-value"],setup(s,{emit:u}){const o=s,v=u,m=z(!1),x=z(!1),w=z(null),p=z("active"),V=z(""),C=z("ALL"),S=z(""),G=z("COMPLETED"),D=z("PAID"),E=z(1),P=z(10),g=z(""),b=z("SENT"),h=z("UNPAID"),I=z(1),F=z(!1),j=ce=>{v("update:model-value",ce)},{loading:se,loadingOrder:U,deletingOrder:k,convertingOrder:J,holdInvoices:K,getOrderType:T,getOrderTypeColor:re,formatDate:M,formatCurrency:ve,convertToInvoice:me,loadOrder:$,deleteOrder:ge,fetchHoldInvoices:ye,showPaymentDialog:Pe,currentInvoice:Ae,handlePaymentComplete:ie,clearOrderHistory:Z}=P1(),{loading:$e,invoices:Ce,error:Xe,pagination:ne,fetchInvoices:Y}=C1();_e(()=>se||$e);const de=_e(()=>K.value.filter(ce=>ce.paid_status===Bn.UNPAID)),Ve=_e(()=>{let ce=de.value;if(C.value!=="ALL"&&(ce=ce.filter(Ie=>Ie.paid_status===C.value)),V.value){const Ie=V.value.toLowerCase();ce=ce.filter(wt=>{var pt,tn;return((pt=wt.description)==null?void 0:pt.toLowerCase().includes(Ie))||((tn=wt.id)==null?void 0:tn.toString().includes(Ie))})}const le=(E.value-1)*P.value;return ce.slice(le,le+P.value)}),Pt=_e(()=>ne.value.lastPage||1),At=_e(()=>{if(!Array.isArray(Ce.value))return d.warn("Invoices is not an array:",Ce.value),[];let ce=Ce.value;if(b.value!=="ALL"&&(ce=ce.filter(le=>(le==null?void 0:le.status)===b.value)),h.value!=="ALL"&&(ce=ce.filter(le=>(le==null?void 0:le.paid_status)===h.value)),g.value){const le=g.value.toLowerCase();ce=ce.filter(Ue=>{var Ie,wt,pt,tn;return((Ie=Ue==null?void 0:Ue.invoice_number)==null?void 0:Ie.toLowerCase().includes(le))||((pt=(wt=Ue==null?void 0:Ue.customer)==null?void 0:wt.name)==null?void 0:pt.toLowerCase().includes(le))||((tn=Ue==null?void 0:Ue.id)==null?void 0:tn.toString().includes(le))})}return d.debug("Filtered delivery orders:",{total:Ce.value.length,filtered:ce.length,filters:{status:b.value,paymentStatus:h.value,search:g.value}}),ce}),tt=_e(()=>ne.value.lastPage||1),dt=_e(()=>{if(!Array.isArray(Ce.value))return d.warn("Invoices is not an array:",Ce.value),[];let ce=Ce.value;if(G.value!=="ALL"&&(ce=ce.filter(le=>(le==null?void 0:le.status)===G.value)),D.value!=="ALL"&&(ce=ce.filter(le=>(le==null?void 0:le.paid_status)===D.value)),S.value){const le=S.value.toLowerCase();ce=ce.filter(Ue=>{var Ie,wt,pt,tn;return((Ie=Ue==null?void 0:Ue.invoice_number)==null?void 0:Ie.toLowerCase().includes(le))||((pt=(wt=Ue==null?void 0:Ue.customer)==null?void 0:wt.name)==null?void 0:pt.toLowerCase().includes(le))||((tn=Ue==null?void 0:Ue.id)==null?void 0:tn.toString().includes(le))})}return d.debug("Filtered invoice orders:",{total:Ce.value.length,filtered:ce.length,filters:{status:G.value,search:S.value}}),ce}),mt=async ce=>{var Ue,Ie;d.info("Loading order:",{id:ce.id,description:ce.description,type:ce.type}),await $(ce)?((Ue=window.toastr)==null||Ue.success("Order loaded successfully"),j(!1)):(Ie=window.toastr)==null||Ie.error("Failed to load order")},lt=async ce=>{var Ie,wt;console.log("HeldOrdersModal - Initial invoice data:",{id:ce.id,description:ce.description,rawTotal:ce.total,items:(Ie=ce.hold_items)==null?void 0:Ie.length,holdItems:(wt=ce.hold_items)==null?void 0:wt.map(pt=>({name:pt.name,price:pt.price,quantity:pt.quantity}))});let le=xe.ensureCents(ce.total);console.log("HeldOrdersModal - Normalized total:",{originalTotal:ce.total,finalTotal:le,asDollars:xe.toDollars(le)}),ce.total=le,ce.hold_items&&(ce.hold_items=ce.hold_items.map(pt=>({...pt,price:pt.price%1!==0?xe.ensureCents(pt.price):pt.price})));const Ue=await me(ce);console.log("HeldOrdersModal - Convert to invoice result:",{success:Ue.success,finalTotal:ce.total,asDollars:xe.toDollars(ce.total)}),Ue.success?console.log("HeldOrdersModal - Conversion successful"):console.error("HeldOrdersModal - Conversion failed:",Ue.error)},Ke=ce=>{var le;if(!(ce!=null&&ce.id)){(le=window.toastr)==null||le.error("Invalid order selected");return}w.value=ce,m.value=!0},qe=async()=>{var ce,le,Ue,Ie;if(!((ce=w.value)!=null&&ce.id)){(le=window.toastr)==null||le.error("Invalid order selected");return}try{x.value=!0,await ge(w.value.id)&&(m.value=!1,await ye(),(Ue=window.toastr)==null||Ue.success("Order deleted successfully"))}catch(wt){(Ie=window.toastr)==null||Ie.error(wt.message||"Failed to delete order")}finally{x.value=!1,w.value=null}},Ct=ce=>{d.info("Order loaded to cart:",{id:ce.id,invoice_number:ce.invoice_number}),j(!1)};return Be(()=>o.modelValue,async ce=>{ce&&await Promise.all([ye(),Y()])}),Be(p,async ce=>{if(ce==="invoices")await Y({status:G.value!=="ALL"?G.value:"",invoiceNumber:S.value});else if(ce==="delivery"){F.value=!0;try{await Y({type:["DELIVERY","PICKUP"],status:b.value!=="ALL"?b.value:"",invoiceNumber:g.value,page:I.value,orderByField:"invoice_number",orderBy:"desc"})}finally{F.value=!1}}}),Be([g,b,h,I],async()=>{if(p.value==="delivery"){F.value=!0;try{const ce={type:["DELIVERY","PICKUP"],invoiceNumber:g.value,page:I.value,orderByField:"invoice_number",orderBy:"desc",per_page:10};b.value!=="ALL"&&(ce.status=b.value),h.value!=="ALL"&&(ce.paid_status=h.value),await Y(ce)}finally{F.value=!1}}}),Be([S,G,E],async()=>{p.value==="invoices"&&await Y({status:G.value!=="ALL"?G.value:"",invoiceNumber:S.value,page:E.value,orderByField:"invoice_number",orderBy:"desc"})}),Be(Pe,async ce=>{console.log("HeldOrdersModal: Payment dialog state changed:",{showPaymentDialog:ce,hasCurrentInvoice:!!Ae.value}),ce||Ae.value&&(console.log("HeldOrdersModal: Payment dialog closed with current invoice, refreshing list"),await ye(),j(!1))}),ye(),(ce,le)=>{var Ue;return B(),he("div",cw,[a(pe,{color:"primary","prepend-icon":"mdi-clipboard-list",onClick:le[0]||(le[0]=Ie=>j(!0)),disabled:s.disabled,class:"text-none px-6 text-capitalize",rounded:"pill",elevation:ce.$vuetify.display.mobile?1:2,size:"large",block:ce.$vuetify.display.mobile},{default:i(()=>le[14]||(le[14]=[y("span",{class:"text-subtitle-1 font-weight-medium"},"ORDERS",-1)])),_:1},8,["disabled","elevation","block"]),a(Vt,{"model-value":s.modelValue,"onUpdate:modelValue":j,fullscreen:"",transition:"dialog-bottom-transition",scrim:!1},{default:i(()=>[a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>le[15]||(le[15]=[q(" Orders Management ")])),_:1}),a(It),a(pe,{icon:"",onClick:le[1]||(le[1]=Ie=>j(!1))},{default:i(()=>[a(Te,null,{default:i(()=>le[16]||(le[16]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),a(Hu,{modelValue:p.value,"onUpdate:modelValue":le[2]||(le[2]=Ie=>p.value=Ie),"bg-color":"transparent",class:"orders-tabs px-2","show-arrows":!1},{default:i(()=>[a(Co,{value:"active",class:Gt(["tab-item flex-1 dine-in-tab",{"tab-active":p.value==="active"}])},{default:i(()=>[a(Te,{start:""},{default:i(()=>le[17]||(le[17]=[q("mdi-silverware")])),_:1}),le[18]||(le[18]=q(" DINE IN | TOGO "))]),_:1},8,["class"]),a(Co,{value:"delivery",class:Gt(["tab-item flex-1 delivery-tab",{"tab-active":p.value==="delivery"}])},{default:i(()=>[a(Te,{start:""},{default:i(()=>le[19]||(le[19]=[q("mdi-bike-fast")])),_:1}),le[20]||(le[20]=q(" DELIVERY | PICKUP "))]),_:1},8,["class"]),a(Co,{value:"invoices",class:Gt(["tab-item flex-1 history-tab",{"tab-active":p.value==="invoices"}])},{default:i(()=>[a(Te,{start:""},{default:i(()=>le[21]||(le[21]=[q("mdi-history")])),_:1}),le[22]||(le[22]=q(" ORDER HISTORY "))]),_:1},8,["class"])]),_:1},8,["modelValue"]),a(Py,{modelValue:p.value,"onUpdate:modelValue":le[11]||(le[11]=Ie=>p.value=Ie),class:"window-content"},{default:i(()=>[a(Wi,{value:"active",class:"window-item"},{default:i(()=>[a(L1,{invoices:Ve.value,"loading-order":oe(U),"converting-order":oe(J),"deleting-order":oe(k),"get-order-type":oe(T),"get-order-type-color":oe(re),"format-date":oe(M),"format-currency":oe(ve),onLoad:mt,onConvert:lt,onDelete:Ke,onOrderLoaded:Ct,class:"table-component"},null,8,["invoices","loading-order","converting-order","deleting-order","get-order-type","get-order-type-color","format-date","format-currency"])]),_:1}),a(Wi,{value:"delivery",class:"window-item"},{default:i(()=>[a(Ee,{"no-gutters":""},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[y("div",fw,[a(Ee,null,{default:i(()=>[a(we,{cols:"12",sm:"4"},{default:i(()=>[a(ft,{modelValue:g.value,"onUpdate:modelValue":le[3]||(le[3]=Ie=>g.value=Ie),label:"Search",density:"comfortable","hide-details":"","prepend-inner-icon":"mdi-magnify",variant:"outlined",class:"mb-2"},null,8,["modelValue"])]),_:1}),a(we,{cols:"12",sm:"4"},{default:i(()=>[a(hn,{modelValue:b.value,"onUpdate:modelValue":le[4]||(le[4]=Ie=>b.value=Ie),items:["ALL","DRAFT","SENT","COMPLETED"],label:"Status",density:"comfortable","hide-details":"",variant:"outlined",class:"mb-2"},null,8,["modelValue"])]),_:1}),a(we,{cols:"12",sm:"4"},{default:i(()=>[a(hn,{modelValue:h.value,"onUpdate:modelValue":le[5]||(le[5]=Ie=>h.value=Ie),items:["ALL","PAID","UNPAID"],label:"Payment Status",density:"comfortable","hide-details":"",variant:"outlined",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),a(we,{cols:"12"},{default:i(()=>[a(Fu,{loading:F.value,invoices:At.value,"get-order-type":oe(T),"get-order-type-color":oe(re),"format-date":oe(M),"show-pagination":!0,page:I.value,"total-pages":tt.value,"onUpdate:page":le[6]||(le[6]=Ie=>I.value=Ie),onRefresh:oe(Y),onLoad:mt,onOrderLoaded:Ct,class:"table-component"},null,8,["loading","invoices","get-order-type","get-order-type-color","format-date","page","total-pages","onRefresh"])]),_:1})]),_:1})]),_:1}),a(Wi,{value:"invoices",class:"window-item"},{default:i(()=>[a(Ee,{"no-gutters":""},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[y("div",mw,[a(Ee,null,{default:i(()=>[a(we,{cols:"12",sm:"4"},{default:i(()=>[a(ft,{modelValue:S.value,"onUpdate:modelValue":le[7]||(le[7]=Ie=>S.value=Ie),label:"Search",density:"comfortable","hide-details":"","prepend-inner-icon":"mdi-magnify",variant:"outlined",class:"mb-2"},null,8,["modelValue"])]),_:1}),a(we,{cols:"12",sm:"4"},{default:i(()=>[a(hn,{modelValue:G.value,"onUpdate:modelValue":le[8]||(le[8]=Ie=>G.value=Ie),items:["ALL","DRAFT","SENT","COMPLETED"],label:"Status",density:"comfortable","hide-details":"",variant:"outlined",class:"mb-2"},null,8,["modelValue"])]),_:1}),a(we,{cols:"12",sm:"4"},{default:i(()=>[a(hn,{modelValue:D.value,"onUpdate:modelValue":le[9]||(le[9]=Ie=>D.value=Ie),items:["ALL","PAID","UNPAID"],label:"Payment Status",density:"comfortable","hide-details":"",variant:"outlined",class:"mb-2"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),a(we,{cols:"12"},{default:i(()=>[a(Fu,{loading:oe($e),invoices:dt.value,"get-order-type":oe(T),"get-order-type-color":oe(re),"format-date":oe(M),"show-pagination":!0,page:E.value,"total-pages":Pt.value,"onUpdate:page":le[10]||(le[10]=Ie=>E.value=Ie),onRefresh:oe(Y),onLoad:mt,onOrderLoaded:Ct,class:"table-component"},null,8,["loading","invoices","get-order-type","get-order-type-color","format-date","page","total-pages","onRefresh"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model-value"]),a(z1,{modelValue:m.value,"onUpdate:modelValue":le[12]||(le[12]=Ie=>m.value=Ie),loading:x.value,"order-description":(Ue=w.value)==null?void 0:Ue.description,onConfirm:qe},null,8,["modelValue","loading","order-description"]),a(rs,{modelValue:oe(Pe),"onUpdate:modelValue":le[13]||(le[13]=Ie=>Sa(Pe)?Pe.value=Ie:null),invoice:oe(Ae)||{},onPaymentComplete:oe(ie)},null,8,["modelValue","invoice","onPaymentComplete"])])}}},vw=_t(pw,[["__scopeId","data-v-534fe6bc"]]);const gw={class:"d-flex justify-space-between align-center"},yw={key:0,class:"d-flex flex-column align-center"},hw={class:"d-flex align-center justify-center"},_w={class:"mx-2 text-h6"},ww={key:1,class:"d-flex align-center justify-center"},bw={class:"text-body-1"},Iw={key:2,class:"d-flex align-center justify-center"},Pw={__name:"DineInModal",props:{disabled:{type:Boolean,default:!1}},setup(s,{expose:u}){const o=dr(),v=Yt(),m=Ln(),{loading:x,error:w,getTables:p,isTableOccupied:V,setTableOccupancy:C,currentCashRegister:S}=No(),G=_e(()=>m.selectedStore),D=_e(()=>m.selectedCashier);_e(()=>{const me=!!G.value,$=!!D.value,ge=!v.isEmpty;return d.debug("[DineInModal] Order prerequisites:",{hasStore:me,hasCashier:$,hasItems:ge,selectedStore:G.value,selectedCashier:D.value,companyStoreState:{store:m.selectedStore,cashier:m.selectedCashier}}),me&&$&&ge});const{setOrderType:E,setCustomerInfo:P,canCreateOrder:g}=Oa(),b=z(!1),h=_e(()=>x.value),I=z(!1),F=z([]),j=z([]),se=me=>!V(me.id)||U(me.id),U=me=>j.value.some($=>$.id===me),k=me=>{const $=j.value.find(ge=>ge.id===me);return $?$.quantity:1},J=me=>{var ge;if(!se(me)){(ge=window.toastr)==null||ge.warning("This table is currently occupied");return}const $=j.value.findIndex(ye=>ye.id===me.id);$>=0?j.value.splice($,1):j.value.push({id:me.id,name:me.name,quantity:1})},K=me=>{const $=j.value.find(ge=>ge.id===me);$&&$.quantity++},T=me=>{const $=j.value.find(ge=>ge.id===me);$&&$.quantity>1&&$.quantity--},re=async()=>{var me;try{F.value=await p()}catch($){d.error("Failed to retry loading tables:",$),(me=window.toastr)==null||me.error("Failed to load tables")}},M=async()=>{var me,$,ge,ye;if(!(!j.value.length||!g.value)){if(!G.value||!D.value){(me=window.toastr)==null||me.error("Please select both store and cashier"),d.warn("[DineInModal] Missing store or cashier selection",{store:G.value,cashier:D.value});return}I.value=!0,d.info("[DineInModal] Processing order with store/cashier:",{store:G.value,cashier:D.value});try{E(St.DINE_IN);const Pe=j.value.map(Ce=>({id:Ce.id,table_id:Ce.id,name:Ce.name,quantity:Ce.quantity,in_use:1})),Ae=Pe.map(Ce=>Ce.name).join(", "),ie=Pe.reduce((Ce,Xe)=>Ce+Xe.quantity,0);P({tableNumbers:Ae,tables:Pe,customerCount:ie}),v.setSelectedTables(Pe);const Z={orderInfo:{customer:{tableNumbers:Ae,customerCount:ie},tables:Pe}};v.setNotes(JSON.stringify(Z));const $e={...v.prepareHoldInvoiceData(G.value,D.value,`DINE_IN_Table_${Ae}`),tables_selected:Pe.map(Ce=>({id:Ce.id,table_id:Ce.id,name:Ce.name,quantity:Ce.quantity,in_use:1})),hold_tables:Pe.map(Ce=>({id:Ce.id,table_id:Ce.id,name:Ce.name,quantity:Ce.quantity,in_use:1}))};try{await o.holdOrder($e),Pe.forEach(Ce=>{C(Ce.table_id,!0)}),await p(),v.clearCart(),b.value=!1,($=window.toastr)==null||$.success("Dine-in order held successfully")}catch(Ce){d.error("Hold order error:",Ce),await new Promise(ne=>setTimeout(ne,500)),await o.fetchHoldInvoices(),o.holdInvoices.some(ne=>{var Y;return ne.type===St.DINE_IN&&((Y=ne.description)==null?void 0:Y.includes(`DINE_IN_Table_${Ae}`))})&&(Pe.forEach(ne=>{C(ne.table_id,!0)}),await p(),v.clearCart(),b.value=!1,(ge=window.toastr)==null||ge.success("Dine-in order held successfully"))}}catch(Pe){d.error("Failed to hold dine-in order:",Pe),(ye=window.toastr)==null||ye.error("Failed to create dine-in order")}finally{I.value=!1}}},ve=()=>{I.value||(b.value=!1,j.value=[])};return cr(()=>{d.info("[DineInModal] Component mounted"),(async()=>{try{m.isInitialized||(d.debug("[DineInModal] Initializing company store"),await m.initializeStore()),d.info("[DineInModal] Store state after mount:",{store:G.value,cashier:D.value,companyStore:{selectedStore:m.selectedStore,selectedCashier:m.selectedCashier}})}catch($){d.error("[DineInModal] Initialization error:",$),w.value="Failed to initialize store selections"}})()}),Be(b,async me=>{var $;if(me)try{E(St.DINE_IN),F.value=await p()}catch(ge){d.error("Failed to initialize dine-in modal:",ge),($=window.toastr)==null||$.error("Failed to load tables")}else j.value=[]}),u({dialog:b}),(me,$)=>(B(),Se(Vt,{modelValue:b.value,"onUpdate:modelValue":$[0]||($[0]=ge=>b.value=ge),fullscreen:"",transition:"dialog-bottom-transition",scrim:!1},{activator:i(({props:ge})=>[a(pe,Wn({color:"primary"},ge,{"prepend-icon":"mdi-table-furniture",loading:h.value,disabled:s.disabled||oe(v).isEmpty,class:"text-none px-6",rounded:"pill",elevation:me.$vuetify.display.mobile?1:2,size:"large",block:me.$vuetify.display.mobile}),{default:i(()=>$[1]||($[1]=[y("span",{class:"text-subtitle-1 font-weight-medium"},"DINE IN",-1)])),_:2},1040,["loading","disabled","elevation","block"])]),default:i(()=>[a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>$[2]||($[2]=[q(" Table Selection ")])),_:1}),a(It),a(pe,{icon:"",onClick:ve},{default:i(()=>[a(Te,null,{default:i(()=>$[3]||($[3]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),a(ht,{class:"pa-0 fill-height d-flex flex-column"},{default:i(()=>[a(bn,{fluid:"",class:"flex-grow-1 pa-4"},{default:i(()=>[h.value?(B(),Se(Ee,{key:0,class:"fill-height"},{default:i(()=>[a(we,{cols:"12",class:"d-flex align-center justify-center"},{default:i(()=>[a(Nn,{indeterminate:"",size:"64"})]),_:1})]),_:1})):oe(w)?(B(),Se(Ee,{key:1,class:"fill-height"},{default:i(()=>[a(we,{cols:"12",class:"d-flex align-center justify-center"},{default:i(()=>[a(sn,{type:"error",variant:"tonal",width:"100%","max-width":"500"},{append:i(()=>[a(pe,{color:"error",variant:"text",onClick:re},{default:i(()=>$[4]||($[4]=[q(" Retry ")])),_:1})]),default:i(()=>[q(te(oe(w))+" ",1)]),_:1})]),_:1})]),_:1})):F.value.length?(B(),Se(Ee,{key:3,class:"table-grid"},{default:i(()=>[(B(!0),he(gt,null,en(F.value,ge=>(B(),Se(we,{key:ge.id,cols:"12",sm:"6",md:"4",lg:"3",class:"table-col pa-2"},{default:i(()=>[a(Cy,null,{default:i(({isHovering:ye,props:Pe})=>[a(Ze,Wn({ref_for:!0},Pe,{elevation:ye?4:1,class:["table-card","transition-swing",U(ge.id)?"selected":"",se(ge)?"available":"occupied"],onClick:Ae=>J(ge)}),{default:i(()=>[a(Xi,{class:"pa-2"},{default:i(()=>[y("div",gw,[a(Rn,{class:"text-h6 font-weight-bold pa-0"},{default:i(()=>[q(te(ge.name),1)]),_:2},1024),a(lr,{color:se(ge)?"success":"error",size:"small",class:"font-weight-medium text-caption",variant:"elevated"},{default:i(()=>[q(te(se(ge)?"Available":"In Use"),1)]),_:2},1032,["color"])])]),_:2},1024),a(ht,{class:"text-center pa-2"},{default:i(()=>[U(ge.id)?(B(),he("div",yw,[$[6]||($[6]=y("div",{class:"text-subtitle-2 mb-1"},"Number of People",-1)),y("div",hw,[a(pe,{icon:"mdi-minus",size:"small",variant:"text",density:"compact",onClick:Rr(Ae=>T(ge.id),["stop"]),disabled:k(ge.id)<=1},null,8,["onClick","disabled"]),y("span",_w,te(k(ge.id)),1),a(pe,{icon:"mdi-plus",size:"small",variant:"text",density:"compact",onClick:Rr(Ae=>K(ge.id),["stop"])},null,8,["onClick"])])])):se(ge)?(B(),he("div",Iw,[a(Te,{size:"small",color:"success",class:"mr-1"},{default:i(()=>$[8]||($[8]=[q("mdi-cursor-pointer")])),_:1}),$[9]||($[9]=y("span",{class:"text-body-2"},"Click to Select",-1))])):(B(),he("div",ww,[a(Te,{color:"error",size:"small",class:"mr-1"},{default:i(()=>$[7]||($[7]=[q("mdi-account-group")])),_:1}),y("span",bw,te(ge.quantity)+" People",1)]))]),_:2},1024)]),_:2},1040,["elevation","class","onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(B(),Se(Ee,{key:2,class:"fill-height"},{default:i(()=>[a(we,{cols:"12",class:"d-flex align-center justify-center"},{default:i(()=>[a(sn,{type:"info",variant:"tonal",width:"100%","max-width":"500"},{default:i(()=>$[5]||($[5]=[q(" No tables available for this cash register ")])),_:1})]),_:1})]),_:1}))]),_:1}),a(bn,{fluid:"",class:"pa-4 pt-0"},{default:i(()=>[a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(pe,{block:"",color:"primary",size:"large",loading:I.value,disabled:!j.value.length||I.value,onClick:M,class:"text-none"},{default:i(()=>$[10]||($[10]=[q(" CONFIRM AND HOLD ORDER ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Cw=_t(Pw,[["__scopeId","data-v-fb6d6b11"]]);const xw={__name:"ToGoModal",props:{disabled:{type:Boolean,default:!1}},setup(s){const u={track:(J,K={})=>{window.analytics?window.analytics.track(J,K):console.log(`[Analytics] ${J}:`,K)}},o={_data:new Map,get(J){return this._data.get(J)},set(J,K){this._data.set(J,K)},delete(J){this._data.delete(J)},clear(){this._data.clear()}},v=Uy(My({id:"togoOrder",initial:"idle",states:{idle:{on:{START_PROCESS:"processing"}},processing:{on:{VALIDATION_FAILED:"error",HOLD_CREATED:"holdCreated",HOLD_FAILED:"error"}},holdCreated:{on:{PAYMENT_READY:"paymentReady",PAYMENT_FAILED:"error"}},paymentReady:{on:{PAYMENT_COMPLETE:"complete",PAYMENT_FAILED:"error"}},complete:{type:"final"},error:{on:{RETRY:"idle"}}}}));v.start();const m=Yt(),x=Ln(),w=dr(),p=z(!1),V=z(!1),C=z(!1),S=z(null),G=z(null),D=z(!1),E=Pr({name:"",phone:"",email:"",notes:""}),P=Pr({name:"",phone:"",email:"",notes:""}),g=_e(()=>x.selectedStore),b=_e(()=>x.selectedCashier),h=J=>{var re;d.debug("Notes update triggered:",{event:J,type:typeof J});const K=((re=J==null?void 0:J.target)==null?void 0:re.value)||J;if(d.debug("Extracted value:",{value:K,type:typeof K}),K===m.notes){d.debug("Value unchanged, skipping update");return}d.debug("Updating customerInfo:",{oldValue:E.notes,newValue:K}),E.notes=K;const T={customerNotes:K,timestamp:new Date().toISOString(),orderType:St.TO_GO,orderInfo:{customer:{name:E.name.trim(),phone:E.phone.replace(/\D/g,""),email:E.email.trim(),notes:K,instructions:K}}};d.debug("Created notes object:",T),ky(()=>{d.debug("Updating cart store notes");const M=JSON.stringify(T);d.debug("Stringified notes:",M),m.setNotes(M)})};cr(()=>{if(d.debug("Component mounted"),m.notes)try{d.debug("Parsing initial cart notes:",m.notes);const J=ur(m.notes);J&&(d.debug("Setting initial notes:",J),E.notes=J)}catch(J){d.error("Failed to parse cart notes:",J)}});const I=()=>{j();let J=!0;return E.name.trim()||(P.name="Name is required",J=!1),E.phone.trim()||(P.phone="Phone number is required",J=!1),E.email&&!E.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)&&(P.email="Invalid email format",J=!1),J},F=J=>{P[J]=""},j=()=>{Object.keys(P).forEach(J=>{P[J]=""})},se=async()=>{var J,K,T,re,M,ve,me,$,ge,ye;if(v.send({type:"START_PROCESS"}),console.log("🚦 Starting TO-GO order process..."),!I()){console.error("❌ Form validation failed"),v.send({type:"VALIDATION_FAILED"});return}C.value=!0,S.value=null;try{console.log("📞 Formatting phone number...");const Pe=E.phone.replace(/\D/g,"");console.log("✅ Phone formatted:",Pe),console.log("📝 Preparing base invoice data...");const Ae=m.prepareHoldInvoiceData(g.value,b.value,`TO_GO_${E.name}`);console.log("📄 Base invoice data:",Ae),console.log("📦 Creating hold invoice data...");const ie=new Date().toISOString().replace(/[:.]/g,"-"),Z={...Ae,type:St.TO_GO,description:`TO_GO_${E.name}_${ie}`,cash_register_id:((J=x.selectedCashier)==null?void 0:J.id)||((K=x.company)==null?void 0:K.id)||1,hold_items:m.items.map(Y=>({item_id:Y.id,name:Y.name,description:Y.description||"",price:Y.price,quantity:Y.quantity,unit_name:Y.unit_name||"units",tax:Y.tax||0}))};if(console.log("📄 Hold invoice data:",Z),console.log("✂️ Removing unsupported tip fields..."),delete Z.tip,delete Z.tip_type,delete Z.tip_val,console.log("✅ Tip fields removed"),console.log("🛒 Validating cart items..."),!((T=Z.hold_items)!=null&&T.length))throw console.error("❌ No items found in cart"),new Error("No items found in cart");console.log(`✅ Cart contains ${Z.hold_items.length} items`),console.log("📝 Formatting order notes...");const $e={customerNotes:E.notes,timestamp:new Date().toISOString(),orderType:St.TO_GO,orderInfo:{customer:{name:E.name.trim(),phone:Pe,email:E.email.trim(),notes:E.notes,instructions:E.notes}}};console.log("📄 Notes object:",$e),Z.notes=JSON.stringify($e),console.log("✅ Notes added to invoice data"),d.debug("Processing TO-GO order with data:",{type:Z.type,description:Z.description,total:Z.total,items:(re=Z.hold_items)==null?void 0:re.length,notes:Z.notes}),console.log("📤 Creating hold order...");let Ce;try{Ce=await w.holdOrder(Z),console.log("📥 Hold order response:",Ce),v.send({type:"HOLD_CREATED"}),o.set(`holdInvoice_${Ce.id}`,Z)}catch(Y){throw console.error("❌ Hold order creation failed:",Y),v.send({type:"HOLD_FAILED"}),Y}if(!(Ce!=null&&Ce.success))throw console.error("❌ Hold order creation failed:",(result==null?void 0:result.message)||"No error message"),new Error((result==null?void 0:result.message)||"Failed to create hold order");console.log("✅ Hold order created successfully"),console.log("🔍 Fetching hold invoices..."),await w.fetchHoldInvoices(),console.log("🔎 Searching for new hold invoice...");const Xe=w.holdInvoices.find(Y=>Y.description.includes(ie)&&Y.type===St.TO_GO);if(!Xe)throw console.error("❌ Could not find newly created hold invoice"),new Error("Failed to retrieve created hold invoice");if(console.log("✅ Found hold invoice:",Xe),console.log("🔍 Validating hold invoice fields..."),!Xe.total||!((M=Xe.hold_items)!=null&&M.length))throw console.error("❌ Missing required hold invoice fields:",{total:Xe.total,items:(ve=Xe.hold_items)==null?void 0:ve.length}),new Error("Invalid hold invoice data: missing total or items");console.log("✅ Hold invoice validation passed"),console.log("📌 Storing hold invoice ID...");const ne=Xe.id;if(m.setHoldInvoiceId(ne),console.log("✅ Hold invoice ID stored:",ne),d.info("TO-GO hold order created successfully:",{holdInvoiceId:ne,description:Xe.description,total:Xe.total,items:(me=Xe.hold_items)==null?void 0:me.length}),console.log("📄 Setting current invoice..."),G.value={invoice:Xe,invoicePrefix:"TO-GO",nextInvoiceNumber:ne,description:Xe.description},console.log("✅ Current invoice set:",G.value),console.log("🔍 Validating invoice data..."),!(($=G.value.invoice)!=null&&$.total))throw console.error("❌ Invalid invoice data - missing total"),new Error("Invalid invoice data for payment");console.log("✅ Invoice data validation passed"),console.log("💳 Opening payment dialog..."),await new Promise(Y=>setTimeout(Y,300)),D.value=!0,console.log("✅ Payment flow ready"),v.send({type:"PAYMENT_READY"}),u.track("PaymentDialogOpened",{orderId:(ge=G.value)==null?void 0:ge.id,totalAmount:(ye=G.value)==null?void 0:ye.total}),d.debug("Dialogs state:",{togoDialog:p.value,paymentDialog:D.value,currentInvoice:G.value})}catch(Pe){console.error("❌ TO-GO order processing failed:",Pe),S.value=Pe.message||"Failed to process order",d.error("Failed to process TO-GO order:",Pe)}finally{console.log("🏁 Processing complete"),C.value=!1}},U=async J=>{var K,T,re,M,ve,me,$;try{if(d.startGroup("TO-GO: Handling payment completion"),d.info("Payment completed with result:",J),!(J!=null&&J.success))throw new Error("Payment was not successful");const ge=J.invoiceId;if(!ge)throw new Error("No invoice ID in payment result");try{d.debug("Attempting to persist order history..."),await w.persistOrderHistory({invoiceId:ge,type:St.TO_GO,customerInfo:E,total:((K=J.paymentResult)==null?void 0:K.total)||m.total}),d.debug("Order history persisted successfully")}catch(ye){d.error("Failed to persist order history:",ye),(T=window.toastr)==null||T.warning("Payment successful but failed to save order history")}D.value=!1,p.value=!1,Object.keys(E).forEach(ye=>{E[ye]=""});try{await m.clearCart(),d.debug("Cart cleared successfully")}catch(ye){throw d.error("Failed to clear cart:",ye),new Error("Payment succeeded but failed to clear cart")}(re=window.toastr)==null||re.success("Order completed successfully"),u.track("OrderCompleted",{invoiceId:ge,total:((M=J.paymentResult)==null?void 0:M.total)||m.total,paymentMethods:((me=(ve=J.paymentResult)==null?void 0:ve.regularResults)==null?void 0:me.length)||0})}catch(ge){d.error("Failed to handle payment completion:",ge),($=window.toastr)==null||$.error("Failed to complete order: "+(ge.message||"Unknown error"))}finally{d.endGroup()}},k=()=>{p.value=!1,S.value=null,Object.keys(E).forEach(J=>{E[J]=""}),D.value||m.clearCart()};return Be(D,J=>{J||m.clearCart()}),Be(p,J=>{if(J){if(!g.value||!b.value){S.value="Please select both store and cashier first",p.value=!1;return}try{const K=ur(m.notes);K&&(E.notes=K,d.debug("Initialized notes from cart store:",{notes:K}))}catch(K){d.error("Failed to parse cart notes:",K)}}}),(J,K)=>(B(),Se(Vt,{modelValue:p.value,"onUpdate:modelValue":K[9]||(K[9]=T=>p.value=T),fullscreen:"",transition:"dialog-bottom-transition",scrim:!1},{activator:i(({props:T})=>[a(pe,Wn({color:"primary"},T,{"prepend-icon":"mdi-shopping",loading:V.value,disabled:s.disabled||oe(m).isEmpty,class:"text-none px-6",rounded:"pill",elevation:J.$vuetify.display.mobile?1:2,size:"large",block:J.$vuetify.display.mobile}),{default:i(()=>K[10]||(K[10]=[y("span",{class:"text-subtitle-1 font-weight-medium"},"TO GO",-1)])),_:2},1040,["loading","disabled","elevation","block"])]),default:i(()=>[a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>[a(Te,{icon:"mdi-shopping",size:"large",class:"mr-2"}),K[11]||(K[11]=q(" To Go Order "))]),_:1}),a(It),a(pe,{icon:"",onClick:k},{default:i(()=>[a(Te,null,{default:i(()=>K[12]||(K[12]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),a(ht,{class:"pa-0 fill-height d-flex flex-column"},{default:i(()=>[a(bn,{fluid:"",class:"flex-grow-1 pa-4"},{default:i(()=>[a(Gu,null,{default:i(()=>[V.value?(B(),Se(Ee,{key:0},{default:i(()=>[a(we,{cols:"12",class:"text-center"},{default:i(()=>[a(Nn,{indeterminate:"",color:"primary",size:"64"})]),_:1})]),_:1})):S.value?(B(),Se(Ee,{key:1},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(sn,{type:"error",variant:"tonal",closable:"",class:"mb-4","onClick:close":K[0]||(K[0]=T=>S.value=null)},{default:i(()=>[q(te(S.value),1)]),_:1})]),_:1})]),_:1})):(B(),Se(xy,{key:2,onSubmit:Rr(se,["prevent"])},{default:i(()=>[a(Ee,null,{default:i(()=>[a(we,{cols:"12",md:"6"},{default:i(()=>[K[13]||(K[13]=y("div",{class:"text-subtitle-1 mb-2"},"Customer Information",-1)),a(ft,{modelValue:E.name,"onUpdate:modelValue":K[1]||(K[1]=T=>E.name=T),label:"Customer Name",variant:"outlined",density:"comfortable","error-messages":P.name,onInput:K[2]||(K[2]=T=>F("name")),required:"","prepend-inner-icon":"mdi-account",placeholder:"Enter customer name",class:"mb-4","bg-color":"surface"},null,8,["modelValue","error-messages"]),a(ft,{modelValue:E.phone,"onUpdate:modelValue":K[3]||(K[3]=T=>E.phone=T),label:"Phone Number",variant:"outlined",density:"comfortable","error-messages":P.phone,onInput:K[4]||(K[4]=T=>F("phone")),required:"","prepend-inner-icon":"mdi-phone",placeholder:"Enter phone number",class:"mb-4","bg-color":"surface"},null,8,["modelValue","error-messages"]),a(ft,{modelValue:E.email,"onUpdate:modelValue":K[5]||(K[5]=T=>E.email=T),label:"Email",variant:"outlined",density:"comfortable","error-messages":P.email,onInput:K[6]||(K[6]=T=>F("email")),"prepend-inner-icon":"mdi-email",placeholder:"Enter email address",class:"mb-4","bg-color":"surface"},null,8,["modelValue","error-messages"])]),_:1}),a(we,{cols:"12",md:"6"},{default:i(()=>[K[14]||(K[14]=y("div",{class:"text-subtitle-1 mb-2"},"Order Notes",-1)),a(es,{modelValue:E.notes,"onUpdate:modelValue":K[7]||(K[7]=T=>E.notes=T),label:"Special Instructions",variant:"outlined",density:"comfortable","error-messages":P.notes,onInput:h,"prepend-inner-icon":"mdi-note-text",placeholder:"Enter any special instructions",rows:"4","auto-grow":"","bg-color":"surface"},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1}),a(Ir),a(wn,{class:"pa-4"},{default:i(()=>[a(It),a(pe,{color:"primary",size:"large",loading:V.value,disabled:V.value,onClick:se,class:"px-6"},{default:i(()=>[a(Te,{start:""},{default:i(()=>K[15]||(K[15]=[q("mdi-cash-register")])),_:1}),K[16]||(K[16]=q(" Process Order "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),D.value?(B(),Se(rs,{key:0,modelValue:D.value,"onUpdate:modelValue":K[8]||(K[8]=T=>D.value=T),invoice:G.value,onPaymentComplete:U},null,8,["modelValue","invoice"])):Ne("",!0),a(ji,{"model-value":C.value,class:"align-center justify-center",persistent:""},{default:i(()=>[a(Nn,{size:"64",color:"primary",indeterminate:""})]),_:1},8,["model-value"])]),_:1},8,["modelValue"]))}},Sw=_t(xw,[["__scopeId","data-v-9eef1004"]]),Ow={async getStates(s="US"){try{return(await Tt.get(`/v1/states/${s}`)).data}catch(u){throw u}}},ju={__name:"StateDropdown",props:{modelValue:{type:String,required:!0},label:{type:String,default:"State"},required:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},error:{type:String,default:void 0},countryCode:{type:String,default:"US"}},emits:["update:modelValue","state-selected"],setup(s,{emit:u}){const o=s,v=u,m=z(!1),x=z([]),w=z(o.modelValue),p=async()=>{m.value=!0;try{const C=await Ow.getStates(o.countryCode);x.value=C.states,d.info(`Loaded ${x.value.length} states`)}catch(C){throw d.error("Failed to fetch states:",C),C}finally{m.value=!1}},V=C=>{const S=x.value.find(G=>G.code===C);S&&(v("update:modelValue",C),v("state-selected",S),d.debug("State selected:",S))};return Be(()=>o.modelValue,C=>{w.value=C}),cr(()=>{p()}),(C,S)=>(B(),Se(ts,{modelValue:w.value,"onUpdate:modelValue":[S[0]||(S[0]=G=>w.value=G),V],items:x.value,loading:m.value,"error-messages":s.error,label:s.label,required:s.required,disabled:s.disabled,"item-title":"name","item-value":"code",variant:"outlined",density:"comfortable",hint:m.value?"Loading states...":void 0,"persistent-hint":""},{"no-data":i(()=>[m.value?(B(),Se(na,{key:0},{default:i(()=>[a(xa,null,{default:i(()=>S[1]||(S[1]=[q(" Loading states... ")])),_:1})]),_:1})):(B(),Se(na,{key:1},{default:i(()=>[a(xa,null,{default:i(()=>S[2]||(S[2]=[q(" No states found ")])),_:1})]),_:1}))]),_:1},8,["modelValue","items","loading","error-messages","label","required","disabled","hint"]))}};function Tw(s){var u=typeof s;return s!=null&&(u=="object"||u=="function")}var Xu=Tw,Dw=typeof sr=="object"&&sr&&sr.Object===Object&&sr,Ew=Dw,Aw=Ew,Nw=typeof self=="object"&&self&&self.Object===Object&&self,$w=Aw||Nw||Function("return this")(),ed=$w,Vw=ed,Fw=function(){return Vw.Date.now()},kw=Fw,Rw=/\s/;function Lw(s){for(var u=s.length;u--&&Rw.test(s.charAt(u)););return u}var Uw=Lw,Mw=Uw,zw=/^\s+/;function qw(s){return s&&s.slice(0,Mw(s)+1).replace(zw,"")}var Gw=qw,Hw=ed,Bw=Hw.Symbol,td=Bw,ku=td,nd=Object.prototype,Ww=nd.hasOwnProperty,Kw=nd.toString,Ia=ku?ku.toStringTag:void 0;function Yw(s){var u=Ww.call(s,Ia),o=s[Ia];try{s[Ia]=void 0;var v=!0}catch{}var m=Kw.call(s);return v&&(u?s[Ia]=o:delete s[Ia]),m}var Jw=Yw,Zw=Object.prototype,Qw=Zw.toString;function jw(s){return Qw.call(s)}var Xw=jw,Ru=td,eb=Jw,tb=Xw,nb="[object Null]",rb="[object Undefined]",Lu=Ru?Ru.toStringTag:void 0;function ab(s){return s==null?s===void 0?rb:nb:Lu&&Lu in Object(s)?eb(s):tb(s)}var ob=ab;function ib(s){return s!=null&&typeof s=="object"}var sb=ib,lb=ob,ub=sb,db="[object Symbol]";function cb(s){return typeof s=="symbol"||ub(s)&&lb(s)==db}var fb=cb,mb=Gw,Uu=Xu,pb=fb,Mu=0/0,vb=/^[-+]0x[0-9a-f]+$/i,gb=/^0b[01]+$/i,yb=/^0o[0-7]+$/i,hb=parseInt;function _b(s){if(typeof s=="number")return s;if(pb(s))return Mu;if(Uu(s)){var u=typeof s.valueOf=="function"?s.valueOf():s;s=Uu(u)?u+"":u}if(typeof s!="string")return s===0?s:+s;s=mb(s);var o=gb.test(s);return o||yb.test(s)?hb(s.slice(2),o?2:8):vb.test(s)?Mu:+s}var wb=_b,bb=Xu,Ji=kw,zu=wb,Ib="Expected a function",Pb=Math.max,Cb=Math.min;function xb(s,u,o){var v,m,x,w,p,V,C=0,S=!1,G=!1,D=!0;if(typeof s!="function")throw new TypeError(Ib);u=zu(u)||0,bb(o)&&(S=!!o.leading,G="maxWait"in o,x=G?Pb(zu(o.maxWait)||0,u):x,D="trailing"in o?!!o.trailing:D);function E(U){var k=v,J=m;return v=m=void 0,C=U,w=s.apply(J,k),w}function P(U){return C=U,p=setTimeout(h,u),S?E(U):w}function g(U){var k=U-V,J=U-C,K=u-k;return G?Cb(K,x-J):K}function b(U){var k=U-V,J=U-C;return V===void 0||k>=u||k<0||G&&J>=x}function h(){var U=Ji();if(b(U))return I(U);p=setTimeout(h,g(U))}function I(U){return p=void 0,D&&v?E(U):(v=m=void 0,w)}function F(){p!==void 0&&clearTimeout(p),C=0,v=V=m=p=void 0}function j(){return p===void 0?w:I(Ji())}function se(){var U=Ji(),k=b(U);if(v=arguments,m=this,V=U,k){if(p===void 0)return P(V);if(G)return clearTimeout(p),p=setTimeout(h,u),E(V)}return p===void 0&&(p=setTimeout(h,u)),w}return se.cancel=F,se.flush=j,se}var Sb=xb;const rd=kh(Sb);function as(){const s=z([]),u=z(!1),o=z(null),v=z(""),m=rd(async w=>{var p,V;if(!w||w.length<3){s.value=[],o.value=null;return}if(w!==v.value){v.value=w,u.value=!0,o.value=null;try{const C=await Tt.get("/v1/customers",{params:{search:w,status_customer:"A",orderByField:"created_at",orderBy:"desc",page:1}});(V=(p=C.data)==null?void 0:p.customers)!=null&&V.data&&(s.value=C.data.customers.data.map(S=>{const G=S.phone?S.phone.replace(/(\d{3})(\d{3})(\d{4})/,"$1$2$3"):"No phone";return{title:S.name,subtitle:`${G} • ${S.email||""}`,value:S}}))}catch(C){d.error("Customer search failed:",C),o.value="Failed to search customers",s.value=[]}finally{u.value=!1}}},350);return{searchResults:s,isSearching:u,searchError:o,searchCustomers:m,createCustomer:async w=>{var p,V;try{return(await Tt.post("/v2/core-pos/customer",w)).data}catch(C){d.error("Customer creation failed:",C);const S=((V=(p=C.response)==null?void 0:p.data)==null?void 0:V.message)||C.message||"Failed to create customer";throw new Error(S)}}}}const Ob={__name:"CreateCustomerDialog",props:{modelValue:Boolean},emits:["update:modelValue","customer-created"],setup(s,{emit:u}){const o=s,v=u,{createCustomer:m}=as(),x=_e({get:()=>o.modelValue,set:h=>v("update:modelValue",h)}),w=Pr({name:"",phone:"",email:"",address:"",unit:"",city:"",state:"",state_id:null,zipCode:""}),p=h=>{w.state_id=h.id},V={...w},C=()=>{Object.assign(w,V),P()},S=Pr({name:"",phone:"",address:"",city:"",state:"",zipCode:""}),G=z(!1),D=()=>{let h=!0;return P(),w.name.trim()?w.name.trim().length<3?(S.name="Name must be at least 3 characters",h=!1):w.name.trim().length>100&&(S.name="Name must not exceed 100 characters",h=!1):(S.name="Name is required",h=!1),w.phone.trim()&&(w.phone.trim().length<3||w.phone.trim().length>25)&&(S.phone="Phone number must be between 3 and 25 characters",h=!1),w.address.trim()&&(w.address.trim().length<3||w.address.trim().length>120)&&(S.address="Address must be between 3 and 120 characters",h=!1),w.city.trim()?w.city.trim().length>50&&(S.city="City must not exceed 50 characters",h=!1):(S.city="City is required",h=!1),w.state.trim()?w.state.trim().length>2&&(S.state="Please use 2-letter state code",h=!1):(S.state="State is required",h=!1),w.zipCode.trim()?/^\d{5}(-\d{4})?$/.test(w.zipCode.trim())||(S.zipCode="Invalid ZIP code format",h=!1):(S.zipCode="ZIP code is required",h=!1),w.email.trim()&&(w.email.trim().length<5||w.email.trim().length>120?(S.email="Email must be between 5 and 120 characters",h=!1):/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w.email.trim())||(S.email="Please enter a valid email address",h=!1)),h},E=h=>{S[h]=""},P=()=>{Object.keys(S).forEach(h=>{S[h]=""})},g=async()=>{var h,I,F;if(D()){G.value=!0;try{const j={name:w.name.trim(),phone:w.phone.trim(),...w.email.trim()&&{email:w.email.trim()},address_street_1:w.address.trim(),address_street_2:w.unit.trim()||null,city:w.city.trim(),state:w.state.trim(),zip:w.zipCode.trim(),state_id:w.state_id,status_customer:"A",company_id:1,avalara_type:0,prepaid_option:0,notes:"",first_name:w.name.trim(),last_name:w.name.trim(),contact_name:w.name.trim(),customer_type:"R",role:"customer",sale_type:"Retail",language:"en",timezone:"America/Chicago",status_payment:"prepaid",type_vat_regime:1,incorporated:1,lfln:1};try{const se=await m(j);if(!(se!=null&&se.id))throw new Error("Invalid response from server");const U={id:se.id,...j};window.toastr&&window.toastr.success("Customer created successfully"),v("customer-created",U),C(),b()}catch(se){if((h=se.response)!=null&&h.data){const U=se.response.data;if(U.code==="DUPLICATE_ENTRY"){if(U.field==="phone")S.phone="This phone number is already registered";else if(U.field==="email")S.email="This email is already registered";else throw new Error(U.message||"Customer already exists");return}if(U.details){Object.keys(U.details).forEach(k=>{S.hasOwnProperty(k)&&(S[k]=U.details[k])});return}}throw se}}catch(j){console.error("Customer creation error:",j);const se=((F=(I=j.response)==null?void 0:I.data)==null?void 0:F.message)||j.message||"Failed to create customer";window.toastr?window.toastr.error(se):console.error(se)}finally{G.value=!1}}},b=()=>{G.value||(C(),x.value=!1)};return Be(()=>o.modelValue,h=>{!h&&G.value&&(x.value=!0)}),(h,I)=>(B(),Se(Vt,{modelValue:x.value,"onUpdate:modelValue":I[14]||(I[14]=F=>x.value=F),"max-width":"600",scrim:!0,transition:"dialog-bottom-transition",class:"rounded-lg"},{default:i(()=>[a(Ze,{class:"rounded-lg"},{default:i(()=>[a(ln,{color:"primary",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>I[15]||(I[15]=[q(" Create New Customer ")])),_:1}),a(It),a(pe,{icon:"mdi-close",variant:"text",onClick:b})]),_:1}),a(ht,null,{default:i(()=>[a(bn,null,{default:i(()=>[a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[I[16]||(I[16]=y("div",{class:"text-subtitle-1 mb-2"},"Customer Information",-1)),a(ft,{modelValue:w.name,"onUpdate:modelValue":I[0]||(I[0]=F=>w.name=F),label:"Full Name","error-messages":S.name,onInput:I[1]||(I[1]=F=>E("name")),required:"",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue","error-messages"]),a(ft,{modelValue:w.phone,"onUpdate:modelValue":I[2]||(I[2]=F=>w.phone=F),label:"Phone Number","error-messages":S.phone,onInput:I[3]||(I[3]=F=>E("phone")),required:"",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue","error-messages"]),a(ft,{modelValue:w.email,"onUpdate:modelValue":I[4]||(I[4]=F=>w.email=F),label:"Email (Optional)",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[I[17]||(I[17]=y("div",{class:"text-subtitle-1 mb-2"},"Address Information",-1)),a(ft,{modelValue:w.address,"onUpdate:modelValue":I[5]||(I[5]=F=>w.address=F),label:"Street Address","error-messages":S.address,onInput:I[6]||(I[6]=F=>E("address")),required:"",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12",sm:"6"},{default:i(()=>[a(ft,{modelValue:w.unit,"onUpdate:modelValue":I[7]||(I[7]=F=>w.unit=F),label:"Apt/Suite/Unit (Optional)",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue"])]),_:1}),a(we,{cols:"12",sm:"6"},{default:i(()=>[a(ft,{modelValue:w.zipCode,"onUpdate:modelValue":I[8]||(I[8]=F=>w.zipCode=F),label:"ZIP Code","error-messages":S.zipCode,onInput:I[9]||(I[9]=F=>E("zipCode")),required:"",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12",sm:"6"},{default:i(()=>[a(ft,{modelValue:w.city,"onUpdate:modelValue":I[10]||(I[10]=F=>w.city=F),label:"City","error-messages":S.city,onInput:I[11]||(I[11]=F=>E("city")),required:"",variant:"outlined",density:"comfortable",class:"mb-3"},null,8,["modelValue","error-messages"])]),_:1}),a(we,{cols:"12",sm:"6"},{default:i(()=>[a(ju,{modelValue:w.state,"onUpdate:modelValue":[I[12]||(I[12]=F=>w.state=F),I[13]||(I[13]=F=>E("state"))],error:S.state,onStateSelected:p,class:"mb-3"},null,8,["modelValue","error"])]),_:1})]),_:1})]),_:1})]),_:1}),a(wn,null,{default:i(()=>[a(bn,null,{default:i(()=>[a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(pe,{color:"primary",size:"large",block:"",height:"56",onClick:g,loading:G.value,disabled:G.value,elevation:"2"},{default:i(()=>[a(Te,{start:""},{default:i(()=>I[18]||(I[18]=[q("mdi-account-plus")])),_:1}),I[19]||(I[19]=q(" Create Customer "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ad=_t(Ob,[["__scopeId","data-v-fe2be40d"]]);const Tb={class:"text-h5 mb-4"},Db={class:"d-flex justify-space-between mb-2"},Eb={class:"d-flex justify-space-between mb-2"},Ab={__name:"DeliveryPaymentDialog",props:{modelValue:Boolean,invoice:{type:Object,required:!0,default:()=>({invoice:{},invoicePrefix:"",nextInvoiceNumber:""})}},emits:["update:modelValue","payment-complete"],setup(s,{emit:u}){const o=s,v=u;z(!1),z(!1),z(null);const m=_e({get:()=>o.modelValue,set:C=>v("update:modelValue",C)}),x=_e(()=>{var C,S,G,D;return((S=(C=o.invoice)==null?void 0:C.invoice)==null?void 0:S.invoice_number)||`${(G=o.invoice)==null?void 0:G.invoicePrefix}-${(D=o.invoice)==null?void 0:D.nextInvoiceNumber}`||""}),w=_e(()=>{var C,S;return((S=(C=o.invoice)==null?void 0:C.invoice)==null?void 0:S.total)||0}),p=C=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(C),V=()=>{v("payment-complete",!0),m.value=!1};return(C,S)=>(B(),Se(Vt,{modelValue:m.value,"onUpdate:modelValue":S[0]||(S[0]=G=>m.value=G),fullscreen:"",transition:"dialog-bottom-transition",scrim:!1,class:"payment-dialog"},{default:i(()=>[a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>{var G,D,E,P;return[a(Te,{icon:((D=(G=o.invoice)==null?void 0:G.invoice)==null?void 0:D.type)==="PICKUP"?"mdi-store-clock":"mdi-truck-delivery",size:"large",class:"mr-2"},null,8,["icon"]),q(" "+te(((P=(E=o.invoice)==null?void 0:E.invoice)==null?void 0:P.type)==="PICKUP"?"Process Pick Up Order":"Process Delivery Order"),1)]}),_:1}),a(It),a(pe,{icon:"",onClick:V},{default:i(()=>[a(Te,null,{default:i(()=>S[1]||(S[1]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),a(ht,{class:"pa-0 fill-height d-flex flex-column"},{default:i(()=>[a(bn,{fluid:"",class:"flex-grow-1 pa-4"},{default:i(()=>[a(Ee,null,{default:i(()=>[a(we,{cols:"12",class:"text-center"},{default:i(()=>{var G,D;return[a(Te,{icon:"mdi-check-circle",color:"success",size:"64",class:"mb-4"}),y("h2",Tb,te(((D=(G=o.invoice)==null?void 0:G.invoice)==null?void 0:D.type)==="PICKUP"?"Pick Up Order Created Successfully":"Delivery Order Created Successfully"),1),a(Ze,{variant:"outlined",class:"invoice-summary-card mb-4"},{default:i(()=>[a(ht,{class:"py-4"},{default:i(()=>[y("div",Db,[S[2]||(S[2]=y("span",null,"Invoice Number:",-1)),y("strong",null,te(x.value),1)]),y("div",Eb,[S[3]||(S[3]=y("span",null,"Total Amount:",-1)),y("strong",null,te(p(w.value/100)),1)])]),_:1})]),_:1})]}),_:1})]),_:1})]),_:1})]),_:1}),a(wn,{class:"pa-4"},{default:i(()=>[a(It),a(pe,{color:"primary",size:"large","min-width":"120",height:"48",onClick:V,class:"text-none px-6",rounded:"pill",elevation:"2"},{default:i(()=>[a(Te,{start:"",icon:"mdi-check",class:"mr-1"}),S[4]||(S[4]=q(" Done "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},od=_t(Ab,[["__scopeId","data-v-1c09a6e9"]]);class Nb{async getOrdersBySectionAndType(u,o,v="P"){var m;try{const x=await Tt.post("/v1/core-pos/listordersbysection",null,{params:{section_id:u,type:o,status:v}});if(!((m=x.data)!=null&&m.orders))throw new Error("Invalid response format");return x.data.orders.map(w=>({...w,type:w.type==="Invoice"?"Invoice":"holdInvoice",status:w.status||Ca.PENDING}))}catch(x){throw d.error("Failed to fetch orders by section",{sectionId:u,type:o,status:v,error:x}),x}}async getOrderDetails(u,o){var v;try{const m=await Tt.post("/v1/core-pos/getsectionanditem",null,{params:{id:u,type:o}});if(!((v=m.data)!=null&&v.data))throw new Error("Invalid response format");return m.data.data}catch(m){throw d.error("Failed to fetch order details",{orderId:u,type:o,error:m}),m}}async getAllOrdersForSection(u){d.debug("Fetching pending orders for section",{sectionId:u});try{const[o,v]=await Promise.all([this.getOrdersBySectionAndType(u,"HOLD"),this.getOrdersBySectionAndType(u,"INVOICE")]),m=[...o.map(V=>this.getOrderDetails(V.id,"HOLD")),...v.map(V=>this.getOrderDetails(V.id,"INVOICE"))],x=await Promise.all(m);return[...o,...v].map((V,C)=>{const G=x[C].flatMap(D=>D.items.map(E=>({...E,section_type:D.section.name.toLowerCase()})));return{...V,items:G}})}catch(o){throw d.error("Failed to fetch all orders for section",{sectionId:u,error:o}),o}}async updateOrderStatus(u,o,v){try{return(await Tt.post("/v1/core-pos/updateorderstatus",{id:u,type:o,status:v})).data}catch(m){throw d.error("Failed to update order status",{orderId:u,type:o,status:v,error:m}),m}}}const $b=new Nb,qu=Bu("sectionOrders",()=>{const s=z([]),u=z(!1),o=z(null),v=z(null),m=new Map,x=1e4,w=_e(()=>S=>s.value.filter(G=>{var D;return(D=G.items)==null?void 0:D.some(E=>E.section_type===S)})),p=rd(async S=>{await V(S)},1e3);async function V(S,G=!1){const D=`section_${S}`,E=Date.now(),P=m.get(D);if(!G&&P&&E-P.timestamp<x){s.value=P.data;return}if(!u.value){u.value=!0,o.value=null;try{const g=await $b.getAllOrdersForSection(S);s.value=g,v.value=new Date,m.set(D,{data:g,timestamp:E}),d.debug("Orders fetched and cached",{count:g.length,sectionId:S})}catch(g){o.value=g instanceof Error?g.message:"Failed to fetch orders",d.error("Failed to fetch section orders",{err:g})}finally{u.value=!1}}}function C(S){return V(S,!0)}return{orders:s,loading:u,error:o,lastUpdated:v,getOrdersBySection:w,fetchOrdersForSection:V,refreshOrders:C,debouncedFetch:p}}),Zi=[Ca.DINE_IN,Ca.TO_GO,Ca.DELIVERY,Ca.PICKUP],Vb=Bu("kitchen",()=>{const s=z([]),u=z(!1),o=z(null),v=_e(()=>s.value.filter(D=>!D.completed_at&&D.status!=="completed"&&D.status!=="cancelled")),m=_e(()=>s.value.filter(D=>D.completed_at||D.status==="completed"||D.status==="cancelled")),x=async(D=[],E=[])=>{const P=qu();u.value=!0;try{await P.fetchSections();const g=async(h,I)=>{if(!Zi.includes(h.type))return null;const F=await Promise.all((h.items||[]).map(async j=>{const U=(await P.getSectionsForItem(j.id))[0];return{...j,section_id:U==null?void 0:U.id,section_type:U==null?void 0:U.type,section_name:U==null?void 0:U.name}}));return F.some(j=>j.section_type==="kitchen")?{...h,items:F,source:I,completed_at:h.completed_at||null,status:h.status||"pending",created_at:h.created_at||new Date().toISOString(),type:h.type||"UNKNOWN"}:null},b=await Promise.all([...D.map(h=>g(h,"hold_invoice")),...E.map(h=>g(h,"direct_invoice"))]);s.value=b.filter(h=>h!==null).sort((h,I)=>new Date(I.created_at)-new Date(h.created_at)),d.info(`Initialized ${s.value.length} kitchen orders`),C()}catch(g){o.value="Failed to initialize kitchen orders",d.error("Error initializing kitchen orders:",g)}finally{u.value=!1}},w=async D=>{if(!Zi.includes(D.type)){d.debug("Ignoring non-kitchen order:",D.type);return}const E=qu();try{const P=await Promise.all((D.items||[]).map(async g=>{const h=(await E.getSectionsForItem(g.id))[0];return{...g,section_id:h==null?void 0:h.id,section_type:h==null?void 0:h.type,section_name:h==null?void 0:h.name}}));P.some(g=>g.section_type==="kitchen")?(s.value.unshift({...D,items:P,completed_at:null,status:"pending",created_at:new Date().toISOString()}),d.info(`Added new ${D.type} order to kitchen`),C()):d.debug("Ignoring order with no kitchen items")}catch(P){o.value="Failed to add kitchen order",d.error("Error adding kitchen order:",P)}},p=async D=>{u.value=!0,o.value=null;try{const E=s.value.findIndex(P=>P.id===D);if(E===-1)throw new Error(`Order #${D} not found`);return s.value[E]={...s.value[E],status:"completed",completed_at:new Date().toISOString()},C(),d.info(`Order #${D} marked as completed`),!0}catch(E){return o.value=E.message,d.error("Error completing order:",E),!1}finally{u.value=!1}},V="kitchen_orders",C=()=>{try{localStorage.setItem(V,JSON.stringify(s.value)),d.debug("Kitchen orders persisted to localStorage")}catch(D){d.error("Failed to persist kitchen orders:",D)}};return(()=>{try{const D=localStorage.getItem(V);D&&(s.value=JSON.parse(D),d.info(`Loaded ${s.value.length} kitchen orders from localStorage`))}catch(D){d.error("Failed to load persisted kitchen orders:",D)}})(),{orders:s,loading:u,error:o,activeOrders:v,completedOrders:m,initializeOrders:x,addOrder:w,addDirectInvoice:D=>{if(!D||!Zi.includes(D.type)){d.debug("Ignoring invalid invoice:",D==null?void 0:D.type);return}const E={...D,source:"direct_invoice",completed_at:null,status:"pending",created_at:new Date().toISOString()};s.value.unshift(E),d.info(`Added new ${D.type} order to kitchen`),C()},completeOrder:p}});const Fb={__name:"DeliveryModal",props:{disabled:{type:Boolean,default:!1}},setup(s){const{customerNotes:u}=Oa(),o=_e(()=>x.selectedStore),v=_e(()=>x.selectedCashier);dr();const m=Yt(),x=Ln(),w=Vb(),{setOrderType:p,processOrder:V,ORDER_TYPES:C,error:S,setCustomerInfo:G}=Oa(),{searchResults:D,isSearching:E,searchError:P,searchCustomers:g,createCustomer:b}=as(),h=z(!1),I=z(!1),F=z(!1),j=z(!1),se=z(!1),U=_e(()=>S.value||P.value),k=_e(()=>!m.isEmpty&&($.name||"").trim()&&($.phone||"").trim()&&($.address||"").trim()&&($.city||"").trim()&&($.state||"").trim()&&($.zipCode||"").trim()),J=z(""),K=z(null),T=z(!1),re=async ne=>{var Y;if(J.value=ne,ne&&ne.length>=3)try{const de=/^[\d\s\-()]+$/.test(ne),Ve=de?ne.replace(/[\s\-()]/g,""):ne,At=((Y=(await Tt.get("/v1/customers",{params:{search:Ve,status_customer:"A",orderByField:"created_at",orderBy:"desc",page:1}})).data.customers)==null?void 0:Y.data)||[];D.value=At.map(tt=>{const dt=tt.name||tt.customer_username||"Unknown",mt=tt.phone?tt.phone.replace(/(\d{3})(\d{3})(\d{4})/,"($1) $2-$3"):"No phone",lt=tt.email?` • ${tt.email}`:"";return{...tt,title:de?`${mt} - ${dt}`:dt,subtitle:de?lt:`${mt}${lt}`,value:tt.id}}),d.debug("Customer search results:",{searchTerm:Ve,isPhoneSearch:de,results:D.value})}catch(de){d.error("Customer search failed:",de),D.value=[]}else D.value=[]},M=async ne=>{var Y,de,Ve,Pt,At,tt,dt,mt;if(ne){d.debug("Customer selected:",ne);try{const Ke=(await Tt.get(`/v1/customers/${ne.id}`,{params:{include:"billing_address,addresses"}})).data.customer,qe=Ke.billing_address||{};d.debug("Full customer data:",Ke),d.debug("Billing address:",qe),$.name=((Y=Ke==null?void 0:Ke.name)==null?void 0:Y.trim())||((de=Ke==null?void 0:Ke.first_name)==null?void 0:de.trim())||"",$.phone=((Ve=Ke==null?void 0:Ke.phone)==null?void 0:Ve.trim())||"",$.email=((Pt=Ke==null?void 0:Ke.email)==null?void 0:Pt.trim())||"",$.address=((At=qe==null?void 0:qe.address_street_1)==null?void 0:At.trim())||"",$.unit=((tt=qe==null?void 0:qe.address_street_2)==null?void 0:tt.trim())||"",$.city=((dt=qe==null?void 0:qe.city)==null?void 0:dt.trim())||"",$.zipCode=((mt=qe==null?void 0:qe.zip)==null?void 0:mt.trim())||"",qe.state?($.state=qe.state.code||"",$.state_id=qe.state.id||null):($.state="",$.state_id=null),$.instructions=ne.notes||"",J.value=ne.name,d.debug("Customer selected:",ne),d.debug("Billing address:",qe),d.info("Customer data populated:",{customer:ne.id,fields:{...$}}),ie()}catch(lt){d.error("Error fetching customer details:",lt),window.toastr&&window.toastr.error("Failed to load customer details")}}},ve=()=>{K.value=null,J.value="",Object.keys($).forEach(ne=>{$[ne]=""})},me=async ne=>{try{d.info("New customer created:",ne),T.value=!1,K.value=ne,J.value=ne.name,$.name=ne.name,$.phone=ne.phone||"",$.email=ne.email||"",$.address=ne.address_street_1||"",$.unit=ne.address_street_2||"",$.city=ne.city||"",$.state=ne.state||"",$.zipCode=ne.zip||"",$.instructions=ne.notes||"",ie(),window.toastr&&window.toastr.success("Customer created and loaded successfully")}catch(Y){d.error("Error handling new customer:",Y),window.toastr&&window.toastr.error("Error loading customer data")}},$=Pr({name:"",phone:"",email:"",address:"",unit:"",city:"",state:"",zipCode:"",notes:""}),ge=ne=>{$.state_id=ne.id,$.state=ne.code},ye=Pr({name:"",phone:"",address:"",zip:"",city:"",state:""});Be(h,ne=>{ne?p(C.DELIVERY):(Object.keys($).forEach(Y=>{$[Y]=""}),ie())}),Be(h,ne=>{if(ne){if(!o.value||!v.value){U.value="Please select both store and cashier first",h.value=!1;return}try{const Y=ur(m.notes);Y&&($.notes=Y,d.debug("Initialized notes from cart store:",{notes:Y}))}catch(Y){d.error("Failed to parse cart notes:",Y)}}}),Be(()=>m.notes,ne=>{try{const Y=ur(ne);Y&&Y!==$.notes&&($.notes=Y,d.debug("Updated notes from cart store:",{notes:Y}))}catch(Y){d.error("Failed to parse cart notes:",Y)}}),Be(()=>u.value,ne=>{ne!==$.notes&&($.notes=ne,d.debug("Updated notes from customer notes:",{newNotes:ne}))});const Pe=()=>{var Y;let ne=!0;return ie(),(Y=K.value)!=null&&Y.id||(ye.name="Please select a customer from the search results",ne=!1),$.phone.trim()||(ye.phone="Phone number is required",ne=!1),$.address.trim()||(ye.address="Delivery address is required",ne=!1),ne},Ae=ne=>{ye[ne]=""},ie=()=>{Object.keys(ye).forEach(ne=>{ye[ne]=""})},Z=z({invoice:null,invoicePrefix:"",nextInvoiceNumber:""}),$e=async()=>{var ne,Y,de,Ve,Pt,At,tt,dt;if(Pe()){F.value=!0;try{const mt=[$.address.trim(),$.unit.trim(),$.zipCode.trim()].filter(Boolean).join(", "),lt={customer_id:((ne=K.value)==null?void 0:ne.id)||null,name:($.name||"").trim(),phone:($.phone||"").trim(),address:($.address||"").trim(),unit:($.unit||"").trim(),zip:($.zipCode||"").trim(),city:($.city||"").trim(),state:($.state||"").trim(),state_id:$.state_id,email:($.email||"").trim(),instructions:($.instructions||"").trim(),send_sms:j.value?1:0};G(lt);const Ke=new Date,qe=new Date(Ke);qe.setDate(qe.getDate()+7);const Ct={invoice_date:Ke.toISOString().split("T")[0],due_date:qe.toISOString().split("T")[0],invoice_number:`DEL-${Date.now()}`,sub_total:m.subtotal,total:m.total,tax:m.taxAmount,items:m.items.map(Ie=>({item_id:Ie.id,name:Ie.name,description:Ie.description||"",price:xe.normalizePrice(Ie.price),quantity:Ie.quantity,unit_name:Ie.unit_name||"units",total:xe.normalizePrice(Ie.total),sub_total:xe.normalizePrice(Ie.sub_total),tax:xe.normalizePrice(Ie.tax||0)})),avalara_bool:!1,banType:!0,package_bool:!1,print_pdf:!1,save_as_draft:!1,send_email:!1,not_charge_automatically:!1,is_hold_invoice:!0,is_invoice_pos:1,is_pdf_pos:!0,invoice_template_id:1,invoice_pbx_modify:0,store_id:(Y=x.selectedStore)==null?void 0:Y.id,cash_register_id:(de=x.selectedCashier)==null?void 0:de.id,user_id:((Ve=K.value)==null?void 0:Ve.id)||null,type:C.DELIVERY,status:"HELD",description:"Delivery Order",contact:{name:((Pt=K.value)==null?void 0:Pt.name)||$.name.trim(),last_name:"N/A",email:((At=K.value)==null?void 0:At.email)||$.email.trim(),phone:((tt=K.value)==null?void 0:tt.phone)||$.phone.trim(),second_phone:"N/A",identification:"N/A"},tables_selected:[],packages:[],taxes:[],discount:"0",discount_type:"fixed",discount_val:Math.round(0),discount_per_item:"NO",send_sms:j.value?1:0,notes:JSON.stringify({customerNotes:$.notes,timestamp:new Date().toISOString(),orderType:St.DELIVERY,orderInfo:{customer:{name:$.name.trim(),phone:$.phone.replace(/\D/g,""),email:$.email.trim(),address:$.address,unit:$.unit,city:$.city,state:$.state,zipCode:$.zipCode,notes:$.notes,instructions:$.notes}}}),hold_invoice_id:null,tip:"0",tip_type:"fixed",tip_val:0};d.debug("Creating hold order with data:",{...Ct,debugPrices:{subtotal:{raw:m.subtotal,cents:xe.toCents(m.subtotal)},total:{raw:m.total,cents:xe.toCents(m.total)},tax:{raw:m.taxAmount,cents:xe.toCents(m.taxAmount)}}});const ce=await _n.invoice.getNextNumber();if(!ce)throw new Error("Failed to get next invoice number");Ct.invoice_number=`${ce.prefix}-${ce.nextNumber}`;const le=await _n.invoice.create(Ct);if(!(le!=null&&le.invoice)){const Ie="No invoice data received";throw d.error("Failed to create invoice:",{result:le,orderData:Ct}),new Error(Ie)}w.addDirectInvoice(le.invoice),d.debug("Invoice created successfully:",le.invoice);const Ue={success:!0,invoice:le.invoice};if(!Ue.success)throw new Error("Failed to prepare invoice data");d.debug("Converted invoice data:",Ue),Z.value={invoice:Ue.invoice,invoicePrefix:ce.prefix,nextInvoiceNumber:ce.nextNumber},se.value=!0}catch(mt){d.error("Failed to prepare delivery order:",{error:mt,message:mt.message,data:{customerInfo:$}}),(dt=window.toastr)==null||dt.error(mt.message||"Failed to prepare delivery order")}finally{F.value=!1}}},Ce=async ne=>{var Y;ne&&(h.value=!1,(Y=window.toastr)==null||Y.success("Delivery order created successfully"))},Xe=()=>{F.value||(h.value=!1)};return(ne,Y)=>(B(),Se(Vt,{modelValue:h.value,"onUpdate:modelValue":Y[18]||(Y[18]=de=>h.value=de),fullscreen:"",transition:"dialog-bottom-transition",scrim:!1},{activator:i(({props:de})=>[a(pe,Wn({color:"primary"},de,{"prepend-icon":"mdi-truck-delivery",loading:I.value,disabled:s.disabled||oe(m).isEmpty,class:"text-none px-6",rounded:"pill",elevation:ne.$vuetify.display.mobile?1:2,size:"large",block:ne.$vuetify.display.mobile}),{default:i(()=>Y[19]||(Y[19]=[y("span",{class:"text-subtitle-1 font-weight-medium"},"DELIVERY",-1)])),_:2},1040,["loading","disabled","elevation","block"])]),default:i(()=>[a(od,{modelValue:se.value,"onUpdate:modelValue":Y[0]||(Y[0]=de=>se.value=de),invoice:Z.value,onPaymentComplete:Ce},null,8,["modelValue","invoice"]),a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>[a(Te,{icon:"mdi-truck-delivery",size:"large",class:"mr-2"}),Y[20]||(Y[20]=q(" Delivery Order "))]),_:1}),a(It),a(pe,{icon:"",onClick:Xe},{default:i(()=>[a(Te,null,{default:i(()=>Y[21]||(Y[21]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),a(ht,{class:"pa-0 fill-height d-flex flex-column"},{default:i(()=>[a(bn,{fluid:"",class:"flex-grow-1 pa-4"},{default:i(()=>[I.value?(B(),Se(Ee,{key:0},{default:i(()=>[a(we,{cols:"12",class:"text-center"},{default:i(()=>[a(Nn,{indeterminate:"",size:"64"})]),_:1})]),_:1})):U.value?(B(),Se(Ee,{key:1},{default:i(()=>[a(we,{cols:"12",class:"text-center"},{default:i(()=>[a(sn,{type:"error",variant:"tonal"},{default:i(()=>[q(te(U.value),1)]),_:1})]),_:1})]),_:1})):(B(),he(gt,{key:2},[a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[Y[25]||(Y[25]=y("div",{class:"text-subtitle-1 mb-2"},"Customer Information",-1)),a(ts,{modelValue:K.value,"onUpdate:modelValue":[Y[2]||(Y[2]=de=>K.value=de),M],search:J.value,"onUpdate:search":[Y[3]||(Y[3]=de=>J.value=de),re],items:oe(D),loading:oe(E),"error-messages":ye.name,label:"Search Customer","item-title":"title","item-value":"value",variant:"outlined",density:"comfortable","persistent-hint":"",hint:"Search by name, phone, or email (min. 3 characters)","return-object":""},{"append-inner":i(()=>[K.value?(B(),Se(Te,{key:0,color:"error",onClick:Rr(ve,["stop"])},{default:i(()=>Y[22]||(Y[22]=[q(" mdi-close ")])),_:1})):Ne("",!0)]),"no-data":i(()=>[a(na,null,{append:i(()=>[a(pe,{color:"primary",variant:"text",onClick:Y[1]||(Y[1]=de=>T.value=!0)},{default:i(()=>Y[24]||(Y[24]=[q(" Create New ")])),_:1})]),default:i(()=>[a(xa,null,{default:i(()=>Y[23]||(Y[23]=[q(" No customers found ")])),_:1})]),_:1})]),item:i(({props:de,item:Ve})=>[a(na,Ry(Ly(de)),{default:i(()=>[a(xa,null,{default:i(()=>[q(te(Ve.raw.name),1)]),_:2},1024),a(Au,null,{default:i(()=>[q(te(Ve.raw.phone||"No phone")+" "+te(Ve.raw.email?`• ${Ve.raw.email}`:""),1)]),_:2},1024),Ve.raw.address_street_1?(B(),Se(Au,{key:0},{default:i(()=>[q(te(Ve.raw.address_street_1)+" "+te(Ve.raw.address_street_2?`, ${Ve.raw.address_street_2}`:"")+" "+te(Ve.raw.city?`, ${Ve.raw.city}`:"")+" "+te(Ve.raw.state?` ${Ve.raw.state}`:"")+" "+te(Ve.raw.zip_code?` ${Ve.raw.zip_code}`:""),1)]),_:2},1024)):Ne("",!0)]),_:2},1040)]),_:1},8,["modelValue","search","items","loading","error-messages"]),a(ad,{modelValue:T.value,"onUpdate:modelValue":Y[4]||(Y[4]=de=>T.value=de),onCustomerCreated:me},null,8,["modelValue"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(ft,{modelValue:$.phone,"onUpdate:modelValue":Y[5]||(Y[5]=de=>$.phone=de),label:"Phone Number",variant:"outlined",density:"comfortable","error-messages":ye.phone,onInput:Y[6]||(Y[6]=de=>Ae("phone")),required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[Y[26]||(Y[26]=y("div",{class:"text-subtitle-1 mb-2"},"Delivery Address",-1)),a(ft,{modelValue:$.address,"onUpdate:modelValue":Y[7]||(Y[7]=de=>$.address=de),label:"Street Address",variant:"outlined",density:"comfortable","error-messages":ye.address,onInput:Y[8]||(Y[8]=de=>Ae("address")),required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12",sm:"6"},{default:i(()=>[a(ft,{modelValue:$.unit,"onUpdate:modelValue":Y[9]||(Y[9]=de=>$.unit=de),label:"Apt/Suite/Unit (Optional)",variant:"outlined",density:"comfortable"},null,8,["modelValue"])]),_:1}),a(we,{cols:"12",sm:"6"},{default:i(()=>[a(ft,{modelValue:$.zipCode,"onUpdate:modelValue":Y[10]||(Y[10]=de=>$.zipCode=de),label:"ZIP Code",variant:"outlined",density:"comfortable","error-messages":ye.zipCode,onInput:Y[11]||(Y[11]=de=>Ae("zipCode")),required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12",sm:"6"},{default:i(()=>[a(ft,{modelValue:$.city,"onUpdate:modelValue":Y[12]||(Y[12]=de=>$.city=de),label:"City",variant:"outlined",density:"comfortable","error-messages":ye.city,onInput:Y[13]||(Y[13]=de=>Ae("city")),required:""},null,8,["modelValue","error-messages"])]),_:1}),a(we,{cols:"12",sm:"6"},{default:i(()=>[a(ju,{modelValue:$.state,"onUpdate:modelValue":[Y[14]||(Y[14]=de=>$.state=de),Y[15]||(Y[15]=de=>Ae("state"))],error:ye.state,onStateSelected:ge},null,8,["modelValue","error"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(es,{modelValue:$.instructions,"onUpdate:modelValue":Y[16]||(Y[16]=de=>$.instructions=de),label:"Delivery Instructions (Optional)",variant:"outlined",density:"comfortable",rows:"2",hint:"Special instructions for delivery driver"},null,8,["modelValue"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(Wu,{modelValue:j.value,"onUpdate:modelValue":Y[17]||(Y[17]=de=>j.value=de),color:"primary",label:"Send invoice via SMS",hint:"Customer will receive an SMS with the invoice link","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),a(Ee,{class:"mt-4"},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(pe,{color:"primary",size:"large",block:"",height:"56",onClick:$e,loading:F.value,disabled:!k.value||F.value,elevation:"2"},{default:i(()=>[a(Te,{start:""},{default:i(()=>Y[27]||(Y[27]=[q("mdi-check-circle")])),_:1}),Y[28]||(Y[28]=q(" Process Order "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})],64))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},kb=_t(Fb,[["__scopeId","data-v-c442c7d0"]]);const Rb={__name:"PickupModal",props:{disabled:{type:Boolean,default:!1}},setup(s){const u=Yt(),o=Ln(),{setOrderType:v,setCustomerInfo:m,customerNotes:x}=Oa(),w=_e(()=>o.selectedStore),p=_e(()=>o.selectedCashier),V=z(!1),C=z(!1),S=z(!1),G=z(!1),D=z(!1),E=_e(()=>F.value),P=z(""),g=z(null),b=z(!1),{searchResults:h,isSearching:I,searchError:F,searchCustomers:j,createCustomer:se}=as(),U=async ie=>{if(!ie||ie.length<3){h.value=[];return}try{I.value=!0,await j(ie)}catch(Z){d.error("Error searching customers:",Z)}},k=async ie=>{var Z,$e,Ce,Xe;if(!ie){J();return}try{const ne=ie.value;if(ne){g.value=ne,T.name=ne.name||"",T.phone=ne.phone||"",T.email=ne.email||"",P.value=ne.name;const de=(await _n.get(`/v1/customers/${ne.id}`,{params:{include:"billing_address"}})).data.customer;d.debug("Full customer data:",de),T.name=((Z=de==null?void 0:de.name)==null?void 0:Z.trim())||(($e=de==null?void 0:de.first_name)==null?void 0:$e.trim())||ne.name||"",T.phone=((Ce=de==null?void 0:de.phone)==null?void 0:Ce.trim())||ne.phone||"",T.email=((Xe=de==null?void 0:de.email)==null?void 0:Xe.trim())||ne.email||"",g.value=de,d.debug("Customer selected:",de),d.info("Customer data populated:",{customer:ne.id,fields:{...T}}),$()}}catch(ne){d.error("Error selecting customer:",ne),window.toastr&&window.toastr.error("Failed to load customer details")}},J=()=>{g.value=null,T.name="",T.phone="",T.email="",T.pickupTime=""},K=ie=>{d.debug("[PickupModal] New customer created:",ie),g.value={id:ie.id,title:ie.name,phone:ie.phone,email:ie.email},b.value=!1,T.name=ie.name,T.phone=ie.phone,T.email=ie.email};Be(V,ie=>{if(ie&&u.notes)try{const Z=JSON.parse(u.notes);x.value=Z.customerNotes||""}catch{x.value=u.notes}}),Be(()=>u.notes,ie=>{if(ie)try{const Z=JSON.parse(ie);Z.customerNotes!==x.value&&(x.value=Z.customerNotes||"")}catch{ie!==x.value&&(x.value=ie)}else x.value=""},{immediate:!0}),Be(x,ie=>{if(ie)try{const Z={customerNotes:ie,orderInfo:{customer:T},timestamp:new Date().toISOString()};u.notes=JSON.stringify(Z)}catch(Z){d.error("Error syncing notes with cart:",Z)}else u.notes=""},{immediate:!0});const T=Pr({name:"",phone:"",email:"",pickupTime:""}),re=Pr({name:"",phone:"",pickupTime:""}),M=_e(()=>!u.isEmpty&&(T.name||"").trim()&&(T.phone||"").trim()&&(T.pickupTime||"").trim());Be(V,ie=>{ie?v(Kt.PICKUP):(Object.keys(T).forEach(Z=>{T[Z]=""}),$())});const ve=()=>{var Z;let ie=!0;return $(),(Z=g.value)!=null&&Z.id||(re.name="Please select a customer from the search results",ie=!1),T.phone.trim()||(re.phone="Phone number is required",ie=!1),T.pickupTime.trim()||(re.pickupTime="Pickup time is required",ie=!1),ie},me=ie=>{re[ie]=""},$=()=>{Object.keys(re).forEach(ie=>{re[ie]=""})},ge=z({invoice:null,invoicePrefix:"",nextInvoiceNumber:""}),ye=async()=>{var ie,Z,$e,Ce,Xe,ne,Y,de,Ve;if(ve()){S.value=!0;try{const Pt={customer_id:((ie=g.value)==null?void 0:ie.id)||null,name:(T.name||"").trim(),phone:(T.phone||"").trim(),email:(T.email||"").trim(),send_sms:G.value?1:0};m(Pt);const At=new Date,tt=new Date(At);tt.setDate(tt.getDate()+7);const dt=await _n.invoice.getNextNumber();if(!dt)throw new Error("Failed to get next invoice number");const mt=x.value?JSON.stringify({customerNotes:x.value,orderInfo:{customer:T,store:((Z=w.value)==null?void 0:Z.name)||"",cashier:(($e=p.value)==null?void 0:$e.name)||"",orderType:"pickup"},timestamp:new Date().toISOString()}):"",lt={invoice_date:At.toISOString().split("T")[0],due_date:tt.toISOString().split("T")[0],invoice_number:`${dt.prefix}-${dt.nextNumber}`,sub_total:u.subtotal,total:u.total,tax:u.taxAmount,items:u.items.map(qe=>({item_id:qe.id,name:qe.name,description:qe.description||"",price:xe.normalizePrice(qe.price),quantity:qe.quantity,unit_name:qe.unit_name||"units",total:xe.normalizePrice(qe.total),sub_total:xe.normalizePrice(qe.sub_total),tax:xe.normalizePrice(qe.tax||0)})),avalara_bool:!1,banType:!0,package_bool:!1,print_pdf:!1,save_as_draft:!1,send_email:!1,not_charge_automatically:!1,is_hold_invoice:!0,is_invoice_pos:1,is_pdf_pos:!0,invoice_template_id:1,invoice_pbx_modify:0,store_id:(Ce=o.selectedStore)==null?void 0:Ce.id,cash_register_id:(Xe=o.selectedCashier)==null?void 0:Xe.id,user_id:((ne=g.value)==null?void 0:ne.id)||null,type:Kt.PICKUP,status:"HELD",description:`Pick Up Order - ${T.pickupTime}`,contact:{name:((Y=g.value)==null?void 0:Y.name)||T.name.trim(),last_name:"N/A",email:((de=g.value)==null?void 0:de.email)||T.email.trim(),phone:((Ve=g.value)==null?void 0:Ve.phone)||T.phone.trim(),second_phone:"N/A",identification:"N/A"},tables_selected:[],packages:[],taxes:[],discount:"0",discount_type:"fixed",discount_val:Math.round(0),discount_per_item:"NO",send_sms:G.value?1:0,notes:mt,hold_invoice_id:null,tip:"0",tip_type:"fixed",tip_val:0};d.debug("Creating pickup order with data:",lt);const Ke=await _n.invoice.create(lt);if(!(Ke!=null&&Ke.invoice))throw new Error("No invoice data received");kitchenStore.addDirectInvoice(Ke.invoice),d.debug("Invoice created successfully:",Ke),ge.value={invoice:{...Ke.invoice,type:Kt.PICKUP},invoicePrefix:dt.prefix,nextInvoiceNumber:dt.nextNumber},D.value=!0}catch(Pt){d.error("Failed to prepare pickup order:",{error:Pt,message:Pt.message,data:{customerInfo:T}}),window.toastr&&window.toastr.error("Failed to create pickup order. Please try again.")}finally{S.value=!1}}},Pe=async ie=>{var Z;ie&&(V.value=!1,(Z=window.toastr)==null||Z.success("Pick up order created successfully"))},Ae=()=>{S.value||(V.value=!1)};return(ie,Z)=>(B(),Se(Vt,{modelValue:V.value,"onUpdate:modelValue":Z[11]||(Z[11]=$e=>V.value=$e),fullscreen:"",transition:"dialog-bottom-transition",scrim:!1},{activator:i(({props:$e})=>[a(pe,Wn({color:"primary"},$e,{"prepend-icon":"mdi-store-clock",loading:C.value,disabled:s.disabled||oe(u).isEmpty,class:"text-none px-6",rounded:"pill",elevation:ie.$vuetify.display.mobile?1:2,size:"large",block:ie.$vuetify.display.mobile}),{default:i(()=>Z[12]||(Z[12]=[y("span",{class:"text-subtitle-1 font-weight-medium"},"PICK UP",-1)])),_:2},1040,["loading","disabled","elevation","block"])]),default:i(()=>[a(od,{modelValue:D.value,"onUpdate:modelValue":Z[0]||(Z[0]=$e=>D.value=$e),invoice:ge.value,onPaymentComplete:Pe},null,8,["modelValue","invoice"]),a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",density:"comfortable"},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>[a(Te,{icon:"mdi-store-clock",size:"large",class:"mr-2"}),Z[13]||(Z[13]=q(" Pick Up Order "))]),_:1}),a(It),a(pe,{icon:"",onClick:Ae},{default:i(()=>[a(Te,null,{default:i(()=>Z[14]||(Z[14]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),a(ht,{class:"pa-0 fill-height d-flex flex-column"},{default:i(()=>[a(bn,{fluid:"",class:"flex-grow-1 pa-4"},{default:i(()=>[C.value?(B(),Se(Ee,{key:0},{default:i(()=>[a(we,{cols:"12",class:"text-center"},{default:i(()=>[a(Nn,{indeterminate:"",size:"64"})]),_:1})]),_:1})):E.value?(B(),Se(Ee,{key:1},{default:i(()=>[a(we,{cols:"12",class:"text-center"},{default:i(()=>[a(sn,{type:"error",variant:"tonal"},{default:i(()=>[q(te(E.value),1)]),_:1})]),_:1})]),_:1})):(B(),he(gt,{key:2},[a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[Z[18]||(Z[18]=y("div",{class:"text-subtitle-1 mb-2"},"Customer Information",-1)),a(ts,{modelValue:g.value,"onUpdate:modelValue":[Z[2]||(Z[2]=$e=>g.value=$e),k],search:P.value,"onUpdate:search":[Z[3]||(Z[3]=$e=>P.value=$e),U],items:oe(h),loading:oe(I),"error-messages":re.name,label:"Search Customer","item-title":"title","item-subtitle":"subtitle","item-value":"value",variant:"outlined",density:"comfortable","persistent-hint":"",hint:"Search by name, phone, or email (min. 3 characters)","return-object":""},{"append-inner":i(()=>[g.value?(B(),Se(Te,{key:0,color:"error",onClick:Rr(J,["stop"])},{default:i(()=>Z[15]||(Z[15]=[q(" mdi-close ")])),_:1})):Ne("",!0)]),"no-data":i(()=>[a(na,null,{append:i(()=>[a(pe,{color:"primary",variant:"text",onClick:Z[1]||(Z[1]=$e=>b.value=!0)},{default:i(()=>Z[17]||(Z[17]=[q(" Create New ")])),_:1})]),default:i(()=>[a(xa,null,{default:i(()=>Z[16]||(Z[16]=[q(" No customers found ")])),_:1})]),_:1})]),_:1},8,["modelValue","search","items","loading","error-messages"]),a(ad,{modelValue:b.value,"onUpdate:modelValue":Z[4]||(Z[4]=$e=>b.value=$e),onCustomerCreated:K},null,8,["modelValue"]),a(es,{modelValue:oe(x),"onUpdate:modelValue":Z[5]||(Z[5]=$e=>Sa(x)?x.value=$e:null),label:"Order Notes",variant:"outlined",density:"comfortable",rows:"3",class:"mt-4","hide-details":"",placeholder:"Add any special instructions or notes for this order"},null,8,["modelValue"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(ft,{modelValue:T.phone,"onUpdate:modelValue":Z[6]||(Z[6]=$e=>T.phone=$e),label:"Phone Number",variant:"outlined",density:"comfortable","error-messages":re.phone,onInput:Z[7]||(Z[7]=$e=>me("phone")),required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[Z[19]||(Z[19]=y("div",{class:"text-subtitle-1 mb-2"},"Pickup Time",-1)),a(ft,{modelValue:T.pickupTime,"onUpdate:modelValue":Z[8]||(Z[8]=$e=>T.pickupTime=$e),label:"Pickup Time",type:"time",variant:"outlined",density:"comfortable","error-messages":re.pickupTime,onInput:Z[9]||(Z[9]=$e=>me("pickupTime")),required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),a(Ee,null,{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(Wu,{modelValue:G.value,"onUpdate:modelValue":Z[10]||(Z[10]=$e=>G.value=$e),color:"primary",label:"Send invoice via SMS",hint:"Customer will receive an SMS with the invoice link","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1}),a(Ee,{class:"mt-4"},{default:i(()=>[a(we,{cols:"12"},{default:i(()=>[a(pe,{color:"primary",size:"large",block:"",height:"56",onClick:ye,loading:S.value,disabled:!M.value||S.value,elevation:"2"},{default:i(()=>[a(Te,{start:""},{default:i(()=>Z[20]||(Z[20]=[q("mdi-check-circle")])),_:1}),Z[21]||(Z[21]=q(" Process Order "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})],64))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Lb=_t(Rb,[["__scopeId","data-v-b19d5572"]]);const Ub={class:"payment-content"},Mb={key:1,class:"processing-state"},zb={key:3},qb={__name:"RetailPaymentDialog",props:{modelValue:Boolean},emits:["update:modelValue","payment-complete"],setup(s,{emit:u}){const o=T=>{const re=new Date(T),M=re.getFullYear(),ve=String(re.getMonth()+1).padStart(2,"0"),me=String(re.getDate()).padStart(2,"0");return`${M}-${ve}-${me}`},v=s,m=u,x=Yt(),w=Ln(),p=Sy();cr(async()=>{console.log("Component mounted, initializing company store...");try{await w.initializeStore(),console.log("Company data after initialization:",{selectedCustomer:w.selectedCustomer,currentStore:w.currentStore,isConfigured:w.isConfigured})}catch(T){console.error("Failed to initialize company store:",T)}});const{items:V}=kr(x),{user:C}=kr(p);console.log("Auth Store User:",C.value);const S=z(!1),G=z(null),D=z(null),E=z(!1),P=_e({get:()=>v.modelValue,set:T=>m("update:modelValue",T)}),g=_e(()=>V.value.length>0),b=_e(()=>g.value&&!S.value),h=z(!1),I=z("");_e(()=>{var T,re,M,ve;return((re=(T=D.value)==null?void 0:T.invoice)==null?void 0:re.invoice_number)||`${(M=D.value)==null?void 0:M.invoicePrefix}-${(ve=D.value)==null?void 0:ve.nextInvoiceNumber}`||""}),_e(()=>{var T;return((T=D.value)==null?void 0:T.total)||0});const F=()=>{h.value=!1,I.value=""},j=_e(()=>{var T,re;return((T=C.value)==null?void 0:T.id)||((re=w.currentStore)==null?void 0:re.default_user_id)||1}),se=T=>T.map(re=>({item_id:Number(re.id),name:re.name,description:re.description||"",price:re.price,quantity:re.quantity,unit_name:re.unit_name||"units",sub_total:re.price*re.quantity,total:re.price*re.quantity,discount:"0",discount_val:0,discount_type:"fixed",tax:Math.round(Number(re.tax||0)),retention_amount:0,retention_concept:null,retention_percentage:null,retentions_id:null})),U=async()=>{var T,re,M;d.startGroup("Creating Retail Invoice");try{w.isConfigured||await w.initializeStore();const ve=await _n.invoice.getNextNumber();d.debug("Next invoice number response:",ve);const me=new Date,$=o(me),ge=se(x.items),ye=w.currentStore;if(!ye)throw new Error("No store selected");const Pe={invoice_number:`${ve.prefix}-${ve.nextNumber}`,invoice_date:$,due_date:o(new Date(me.getTime()+7*24*60*60*1e3)),total:xe.toCents(x.total),sub_total:xe.toCents(x.subtotal),tax:xe.toCents(x.taxAmount),items:ge,hold_items:ge,taxes:[],packages:[],tables_selected:[],contact:{name:ye.company_name||"Walk-in Customer",company_name:ye.company_name||"Walk-in Customer",first_name:ye.company_name||"Walk-in",last_name:"Customer",email:ye.email||"walk-in@example.com",phone:ye.phone||"000-000-0000",second_phone:"N/A",identification:ye.tax_id||"N/A",type:"company"},type:St.TO_GO,status:"SENT",paid_status:Bn.UNPAID,description:"Retail Point of Sale Transaction",user_id:j.value,company_id:(T=w.company)==null?void 0:T.id,invoice_template_id:1,is_invoice_pos:1,is_pdf_pos:!0,is_hold_invoice:!1,avalara_bool:!1,banType:!0,package_bool:!1,print_pdf:!1,save_as_draft:!1,send_email:!1,not_charge_automatically:!1,invoice_pbx_modify:0,send_sms:0,discount:"0",discount_type:"fixed",discount_val:0,discount_per_item:"NO",tip:"0",tip_type:"fixed",tip_val:0,notes:"",hold_invoice_id:null,store_id:ye.id||0,cash_register_id:((re=w.selectedCashier)==null?void 0:re.id)||0},Ae=await _n.invoice.create(Pe);return D.value={invoice:{...Pe,id:((M=Ae==null?void 0:Ae.data)==null?void 0:M.id)||`${ve.prefix}-${ve.nextNumber}`,type:St.TO_GO,hold_items:ge,total:x.total,sub_total:x.subtotal,tax:x.taxAmount,is_prepared_data:!0}},E.value=!0,P.value=!1,d.endGroup(),D.value.invoice}catch(ve){throw d.error("Invoice Creation Failed:",ve),d.endGroup(),ve}},k=async()=>{if(!b.value){K();return}S.value=!0,G.value=null;try{if(!await U())throw new Error("Failed to create invoice")}catch(T){G.value=T.message||"Failed to process payment",d.error("Payment processing error:",T),K()}finally{S.value=!1}},J=async T=>{var re,M,ve,me,$,ge,ye,Pe,Ae,ie,Z,$e;if(d.info("Payment completion handler called with result:",T),T)try{try{await x.clearCart(),d.debug("Cart cleared successfully after payment")}catch(de){throw d.error("Failed to clear cart after payment:",de),new Error("Payment succeeded but failed to clear cart")}const Ce=((re=T==null?void 0:T.invoice)==null?void 0:re.invoice)||(T==null?void 0:T.invoice)||((me=(ve=(M=T==null?void 0:T.regularResults)==null?void 0:M[0])==null?void 0:ve.payment)==null?void 0:me.invoice)||T;if(!((Ce==null?void 0:Ce.unique_hash)||(($=Ce==null?void 0:Ce.invoice)==null?void 0:$.unique_hash)||((ge=T==null?void 0:T.invoice)==null?void 0:ge.unique_hash)))throw console.error("📄 [Invoice PDF] Missing invoice hash:",{result:T,invoice:Ce,regularResults:T==null?void 0:T.regularResults,payment:(Pe=(ye=T==null?void 0:T.regularResults)==null?void 0:ye[0])==null?void 0:Pe.payment,nestedInvoice:(Ae=T==null?void 0:T.invoice)==null?void 0:Ae.invoice}),new Error("Could not generate invoice PDF: Missing invoice hash");if(!/^[a-zA-Z0-9.-]+$/.test(Ce.unique_hash))throw console.error("📄 [Invoice PDF] Invalid hash format:",Ce.unique_hash),new Error("Invalid invoice hash format");const ne="https://lajuanita.corebill.co/api/v1".replace("/api/v1",""),Y=`${ne}/invoices/pdf/${Ce.unique_hash}`;if(console.log("📄 [Invoice PDF] Opening PDF viewer with URL:",{url:Y,hash:Ce.unique_hash,baseUrl:ne,invoice:Ce,payment:(Z=(ie=T==null?void 0:T.regularResults)==null?void 0:ie[0])==null?void 0:Z.payment}),!/^[a-zA-Z0-9.-]+$/.test(Ce.unique_hash))throw console.error("📄 [Invoice PDF] Invalid hash format:",Ce.unique_hash),new Error("Invalid invoice hash format");I.value=Y,h.value=!0,K(),m("payment-complete",T)}catch(Ce){console.error("📄 [Invoice PDF] Failed to display invoice:",Ce),($e=window.toastr)==null||$e.error(Ce.message||"Failed to display invoice PDF")}},K=()=>{S.value||(G.value=null,D.value=null,E.value=!1,m("update:modelValue",!1))};return(T,re)=>(B(),he("div",null,[a(Vt,{modelValue:P.value,"onUpdate:modelValue":re[1]||(re[1]=M=>P.value=M),fullscreen:"",transition:"dialog-bottom-transition",scrim:!1,class:"payment-dialog"},{default:i(()=>[a(Ze,{class:"modal-card"},{default:i(()=>[a(ln,{color:"primary",elevation:1},{default:i(()=>[a(un,{class:"text-h6 font-weight-medium"},{default:i(()=>[a(Te,{icon:"mdi-cash-register",size:"large",class:"mr-2"}),re[4]||(re[4]=q(" Process Payment "))]),_:1}),a(It),a(pe,{icon:"",onClick:K},{default:i(()=>[a(Te,null,{default:i(()=>re[5]||(re[5]=[q("mdi-close")])),_:1})]),_:1})]),_:1}),y("div",Ub,[G.value?(B(),Se(sn,{key:0,type:"error",variant:"tonal",closable:"",class:"error-alert","onClick:close":re[0]||(re[0]=M=>G.value=null)},{default:i(()=>[q(te(G.value),1)]),_:1})):Ne("",!0),S.value?(B(),he("div",Mb,[a(Nn,{indeterminate:"",color:"primary",size:"64"}),re[6]||(re[6]=y("div",{class:"text-h6 mt-4"},"Processing Payment...",-1))])):g.value?(B(),he("div",zb,te(k()),1)):(B(),Se(sn,{key:2,type:"warning",variant:"tonal",class:"mb-4"},{default:i(()=>re[7]||(re[7]=[q(" Please add items to cart before proceeding with payment. ")])),_:1}))])]),_:1})]),_:1},8,["modelValue"]),a(rs,{modelValue:E.value,"onUpdate:modelValue":re[2]||(re[2]=M=>E.value=M),invoice:D.value,onPaymentComplete:J},null,8,["modelValue","invoice"]),a($o,{modelValue:h.value,"onUpdate:modelValue":re[3]||(re[3]=M=>h.value=M),pdfUrl:I.value,onClosed:F},null,8,["modelValue","pdfUrl"])]))}},Gb=_t(qb,[["__scopeId","data-v-42f5f82e"]]);const Hb={class:"footer-content"},Bb={class:"order-types"},Wb={class:"order-actions"},Kb={__name:"PosFooter",emits:["print-order","submit-order"],setup(s){const u=Yt(),o=Ln();dr();const{isProcessingPayment:v}=Ao(),m=z(!1);z(null);const x=z(!1),{items:w,holdInvoiceId:p}=kr(u),{isConfigured:V}=kr(o),C=_e(()=>w.value.length===0),S=_e(()=>C.value||!V.value),G=_e(()=>{const E=!C.value&&V.value;return d.debug("Can pay computed:",{isEmpty:C.value,isConfigured:V.value,canPay:E}),E}),D=async E=>{var P,g;if(d.info("Payment completion handler called with result:",E),E)try{await u.clearCart(),(P=window.toastr)==null||P.success("Payment processed successfully")}catch(b){d.error("Failed to clear cart after payment:",b),(g=window.toastr)==null||g.error("Payment succeeded but failed to clear cart")}m.value=!1};return cr(()=>{d.debug("PosFooter mounted:",{isEmpty:C.value,isConfigured:V.value,holdInvoiceId:p.value,canPay:G.value,items:w.value.length})}),(E,P)=>(B(),Se(Oy,{app:"",class:"pos-footer"},{default:i(()=>[y("div",Hb,[y("div",Bb,[a(vw,{modelValue:x.value,"onUpdate:modelValue":P[0]||(P[0]=g=>x.value=g),disabled:!1},null,8,["modelValue"]),a(Cw,{disabled:S.value},null,8,["disabled"]),a(Sw,{disabled:S.value},null,8,["disabled"]),a(kb,{disabled:S.value},null,8,["disabled"]),a(Lb,{disabled:S.value},null,8,["disabled"])]),y("div",Wb,[a(pe,{color:"success","prepend-icon":"mdi-cash-register",onClick:P[1]||(P[1]=g=>m.value=!0),disabled:!G.value,loading:oe(v),class:"text-none action-btn",elevation:"2",size:"large"},{default:i(()=>[q(" PAY "+te(oe(xe).format(oe(u).total)),1)]),_:1},8,["disabled","loading"])])]),a(Gb,{modelValue:m.value,"onUpdate:modelValue":P[2]||(P[2]=g=>m.value=g),onPaymentComplete:D},null,8,["modelValue"])]),_:1}))}},Yb=_t(Kb,[["__scopeId","data-v-c7e18c7a"]]),Jb={__name:"ReferenceDialog",props:{modelValue:Boolean},emits:["update:modelValue","confirm"],setup(s,{emit:u}){const o=s,v=u,m=z(""),x=_e({get:()=>o.modelValue,set:V=>v("update:modelValue",V)}),w=()=>{x.value=!1,m.value=""},p=()=>{m.value&&(v("confirm",m.value),w())};return(V,C)=>(B(),Se(Vt,{modelValue:x.value,"onUpdate:modelValue":C[1]||(C[1]=S=>x.value=S),"max-width":"400"},{default:i(()=>[a(Ze,null,{default:i(()=>[a(Rn,null,{default:i(()=>C[2]||(C[2]=[q("Enter Reference Number")])),_:1}),a(ht,null,{default:i(()=>[a(ft,{modelValue:m.value,"onUpdate:modelValue":C[0]||(C[0]=S=>m.value=S),label:"Reference Number",rules:[S=>!!S||"Reference number is required"],required:"",density:"compact"},null,8,["modelValue","rules"])]),_:1}),a(wn,null,{default:i(()=>[a(It),a(pe,{color:"grey",variant:"text",onClick:w},{default:i(()=>C[3]||(C[3]=[q(" Cancel ")])),_:1}),a(pe,{color:"primary",disabled:!m.value,onClick:p},{default:i(()=>C[4]||(C[4]=[q(" Hold Order ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};function Zb(){const s=Yt(),u=Ln(),o=z(!1),v=z(null);return{showReferenceDialog:o,error:v,confirmHoldOrder:async p=>{if(p)try{const V=s.prepareHoldInvoiceData(u.selectedStore,u.selectedCashier,p);await Po.createHoldInvoice(V),s.clearCart()}catch(V){throw v.value=V.message,d.error("Failed to create hold invoice:",V),V}},printOrder:async(p=null)=>{try{if(p)await Po.printOrder(p);else{const V={items:s.items,total:s.total,subtotal:s.subtotal,tax:s.taxAmount},C=await Po.submitOrder(V);await Po.printOrder(C.invoice.id)}}catch(V){throw v.value=V.message,d.error("Failed to print order:",V),V}},submitOrder:()=>{o.value=!0}}}function Qb(){const s=z(null),u=z(!1),o=(m,x="")=>{const w=m.message||"An unexpected error occurred";return s.value=w,d.error(`Error in ${x}:`,m),w},v=()=>{s.value=null};return Be(u,m=>{m&&v()}),{error:s,loading:u,handleError:o,clearError:v}}const jb={class:"cart-container"},Xb={class:"products-container"},e0={__name:"PosView",setup(s){const u=Ln(),o=Ty(),v=Dy();z(!1),_e(()=>v.path==="/customer-display");const{showReferenceDialog:m,confirmHoldOrder:x,printOrder:w,submitOrder:p}=Zb(),{error:V,loading:C,clearError:S}=Qb();async function G(){try{if(d.startGroup("POS View: Initializing"),d.info("Starting POS initialization"),!u.isConfigured){o.push("/select-cashier");return}d.info("POS initialization complete:",{isConfigured:u.isConfigured,selectedCustomer:u.selectedCustomer,selectedStore:u.selectedStore,selectedCashier:u.selectedCashier})}catch(D){d.error("Failed to initialize POS view:",D),V.value="Failed to initialize POS. Please try refreshing the page."}finally{d.endGroup()}}return cr(async()=>{await G();try{d.info("🖥️ Attempting to open customer display window...");const D=await xo.openCustomerDisplay();if(!D){d.warn("⚠️ Failed to open customer display window - returned null");return}d.info("✅ Customer display window opened successfully"),D.addEventListener("load",()=>{d.info("🖥️ Customer display window loaded")}),D.addEventListener("error",E=>{d.error("❌ Customer display window error:",E)}),D.addEventListener("close",()=>{d.warn("⚠️ Customer display window closed")})}catch(D){d.error("❌ Error opening customer display:",{error:D.message,stack:D.stack})}}),(D,E)=>(B(),Se(Ey,{class:Gt(["pos-layout fill-height",{"mobile-layout":D.$vuetify.display.smAndDown}])},{default:i(()=>[oe(V)?(B(),Se(sn,{key:0,type:"error",closable:"",class:"ma-4","onClick:close":oe(S)},{default:i(()=>[q(te(oe(V)),1)]),_:1},8,["onClick:close"])):Ne("",!0),oe(u).isConfigured?(B(),he(gt,{key:1},[a(Ay,{class:"pos-main pa-0"},{default:i(()=>[a(bn,{fluid:"",class:"fill-height pos-container"},{default:i(()=>[a(Ee,{"no-gutters":"",class:"fill-height",style:{width:"100%",margin:"0"}},{default:i(()=>[a(we,{cols:"12",sm:"12",md:"5",lg:"4",xl:"3",class:Gt(["pos-cart border-r",{"pos-cart-mobile":D.$vuetify.display.smAndDown}])},{default:i(()=>[y("div",jb,[a(Fh)])]),_:1},8,["class"]),a(we,{cols:"12",sm:"12",md:"7",lg:"8",xl:"9",class:Gt(["pos-products",{"pos-products-mobile":D.$vuetify.display.smAndDown}])},{default:i(()=>[y("div",Xb,[a(y1)])]),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),a(Yb,{onPrintOrder:oe(w),onSubmitOrder:oe(p)},null,8,["onPrintOrder","onSubmitOrder"])],64)):Ne("",!0),a(Jb,{modelValue:oe(m),"onUpdate:modelValue":E[0]||(E[0]=P=>Sa(m)?m.value=P:null),onConfirm:oe(x)},null,8,["modelValue","onConfirm"]),a(ji,{"model-value":oe(C),class:"align-center justify-center"},{default:i(()=>[a(Nn,{size:"64",color:"primary",indeterminate:""})]),_:1},8,["model-value"])]),_:1},8,["class"]))}},o0=_t(e0,[["__scopeId","data-v-8bf96ffa"]]);export{o0 as default};
//# sourceMappingURL=PosView-120d68e1.js.map
