{"version":3,"file":"Login-d1b09381.js","sources":["../../src/utils/validation.js","../../src/views/auth/Login.vue"],"sourcesContent":["// src/utils/validation.js\r\nexport const validators = {\r\n    required: (value) => {\r\n      if (Array.isArray(value)) return value.length > 0\r\n      if (typeof value === 'string') return value.trim().length > 0\r\n      return value !== null && value !== undefined\r\n    },\r\n    \r\n    email: (value) => {\r\n      if (!value) return true\r\n      const regex = /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i\r\n      return regex.test(value)\r\n    },\r\n    \r\n    numeric: (value) => {\r\n      if (!value) return true\r\n      return !isNaN(parseFloat(value)) && isFinite(value)\r\n    },\r\n    \r\n    minLength: (value, min) => {\r\n      if (!value) return true\r\n      return String(value).length >= min\r\n    },\r\n    \r\n    maxLength: (value, max) => {\r\n      if (!value) return true\r\n      return String(value).length <= max\r\n    }\r\n  }\r\n  \r\n  export const validateForm = (data, rules) => {\r\n    const errors = {}\r\n    \r\n    Object.keys(rules).forEach(field => {\r\n      const fieldRules = rules[field]\r\n      const value = data[field]\r\n      \r\n      fieldRules.forEach(rule => {\r\n        if (typeof rule === 'string') {\r\n          if (!validators[rule](value)) {\r\n            errors[field] = errors[field] || []\r\n            errors[field].push(`Field fails ${rule} validation`)\r\n          }\r\n        } else if (typeof rule === 'object') {\r\n          const [validatorName, ...params] = rule\r\n          if (!validators[validatorName](value, ...params)) {\r\n            errors[field] = errors[field] || []\r\n            errors[field].push(`Field fails ${validatorName} validation`)\r\n          }\r\n        }\r\n      })\r\n    })\r\n    \r\n    return Object.keys(errors).length > 0 ? errors : null\r\n  }","<!-- src/views/auth/Login.vue -->\r\n<template>\r\n  <div class=\"login-page\">\r\n    <v-container fluid class=\"fill-height pa-0\">\r\n      <v-row align=\"center\" justify=\"center\" no-gutters class=\"fill-height\">\r\n        <v-col cols=\"12\" sm=\"8\" md=\"6\" lg=\"4\" xl=\"3\" class=\"pa-4\">\r\n          <v-card class=\"login-card\" elevation=\"2\" rounded=\"lg\">\r\n            <!-- Header -->\r\n            <div class=\"login-header\">\r\n              <div class=\"d-flex flex-column align-center pt-8 pb-6\">\r\n                <v-avatar\r\n                  color=\"primary\"\r\n                  size=\"64\"\r\n                  class=\"mb-6\"\r\n                >\r\n                  <v-icon\r\n                    icon=\"mdi-store\"\r\n                    size=\"32\"\r\n                    color=\"white\"\r\n                  />\r\n                </v-avatar>\r\n                <h1 class=\"text-h4 font-weight-bold mb-1 text-primary\">\r\n                  {{ appTitle }}\r\n                </h1>\r\n                <p class=\"text-subtitle-1 text-primary\">\r\n                  Sign in to your account\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            <v-card-text class=\"px-6 pt-8 pb-4\">\r\n              <v-form @submit.prevent=\"handleLogin\" ref=\"form\">\r\n                <!-- Email Field -->\r\n                <v-text-field\r\n                  v-model=\"formData.email\"\r\n                  :rules=\"[rules.required, rules.email]\"\r\n                  label=\"Email\"\r\n                  prepend-inner-icon=\"mdi-email\"\r\n                  variant=\"outlined\"\r\n                  :error-messages=\"errors.email\"\r\n                  @update:model-value=\"clearError('email')\"\r\n                  required\r\n                  autocomplete=\"username\"\r\n                  class=\"mb-4 login-field\"\r\n                  placeholder=\"Enter your email\"\r\n                  bg-color=\"surface\"\r\n                />\r\n\r\n                <!-- Password Field -->\r\n                <v-text-field\r\n                  v-model=\"formData.password\"\r\n                  :rules=\"[rules.required, rules.minLength]\"\r\n                  label=\"Password\"\r\n                  prepend-inner-icon=\"mdi-lock\"\r\n                  :append-inner-icon=\"showPassword ? 'mdi-eye' : 'mdi-eye-off'\"\r\n                  @click:append-inner=\"showPassword = !showPassword\"\r\n                  :type=\"showPassword ? 'text' : 'password'\"\r\n                  variant=\"outlined\"\r\n                  :error-messages=\"errors.password\"\r\n                  @update:model-value=\"clearError('password')\"\r\n                  required\r\n                  autocomplete=\"current-password\"\r\n                  class=\"mb-4 login-field\"\r\n                  placeholder=\"Enter your password\"\r\n                  bg-color=\"surface\"\r\n                />\r\n\r\n                <!-- Error Alert -->\r\n                <v-expand-transition>\r\n                  <v-alert\r\n                    v-if=\"error\"\r\n                    type=\"error\"\r\n                    variant=\"tonal\"\r\n                    class=\"mb-4\"\r\n                    closable\r\n                    density=\"compact\"\r\n                    @click:close=\"error = null\"\r\n                  >\r\n                    <template v-slot:prepend>\r\n                      <v-icon icon=\"mdi-alert-circle\" />\r\n                    </template>\r\n                    {{ error }}\r\n                  </v-alert>\r\n                </v-expand-transition>\r\n\r\n                <!-- Login Button -->\r\n                <v-btn\r\n                  color=\"primary\"\r\n                  :loading=\"loading\"\r\n                  :disabled=\"!formIsValid\"\r\n                  @click=\"handleLogin\"\r\n                  size=\"large\"\r\n                  block\r\n                  min-height=\"48\"\r\n                  class=\"mt-2\"\r\n                >\r\n                  Continue\r\n                </v-btn>\r\n              </v-form>\r\n            </v-card-text>\r\n          </v-card>\r\n        </v-col>\r\n      </v-row>\r\n    </v-container>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, computed } from 'vue'\r\nimport { useRouter, useRoute } from 'vue-router'\r\nimport { useAuthStore } from '@/stores/auth'\r\nimport { validateForm } from '@/utils/validation'\r\nimport { logger } from '@/utils/logger'\r\n\r\nconst router = useRouter()\r\nconst route = useRoute()\r\nconst authStore = useAuthStore()\r\n\r\nconst form = ref(null)\r\nconst showPassword = ref(false)\r\nconst loading = ref(false)\r\nconst error = ref(null)\r\nconst errors = reactive({\r\n  email: null,\r\n  password: null\r\n})\r\n\r\nconst appTitle = import.meta.env.VITE_APP_TITLE || 'CorePOS'\r\n\r\nconst formData = reactive({\r\n  email: '',\r\n  password: ''\r\n})\r\n\r\nconst rules = {\r\n  required: v => !!v || 'This field is required',\r\n  email: v => /.+@.+\\..+/.test(v) || 'Please enter a valid email',\r\n  minLength: v => v.length >= 6 || 'Password must be at least 6 characters'\r\n}\r\n\r\nconst formIsValid = computed(() => {\r\n  return formData.email && formData.password &&\r\n         !errors.email && !errors.password\r\n})\r\n\r\nfunction clearError(field) {\r\n  errors[field] = null\r\n  error.value = null\r\n}\r\n\r\nasync function handleLogin() {\r\n  if (!formIsValid.value) return\r\n\r\n  // Validate form\r\n  const validationErrors = validateForm(formData, {\r\n    email: ['required', 'email'],\r\n    password: ['required', ['minLength', 6]]\r\n  })\r\n\r\n  if (validationErrors) {\r\n    Object.assign(errors, validationErrors)\r\n    return\r\n  }\r\n\r\n  loading.value = true\r\n  error.value = null\r\n\r\n  try {\r\n    await authStore.login({\r\n      email: formData.email,\r\n      password: formData.password\r\n    })\r\n\r\n    logger.info('Login successful', { email: formData.email })\r\n    \r\n    // Navigate to the redirect path or default to POS\r\n    const redirectPath = route.query.redirect || '/pos'\r\n    router.push(redirectPath)\r\n  } catch (err) {\r\n    logger.error('Login failed', err)\r\n    \r\n    if (err.details) {\r\n      Object.assign(errors, err.details)\r\n      error.value = 'Please correct the errors below'\r\n    } else {\r\n      error.value = err.message || 'Login failed. Please try again.'\r\n    }\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.login-page {\r\n  min-height: 100vh;\r\n  background: rgb(var(--v-theme-surface));\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.login-card {\r\n  width: 100%;\r\n  max-width: 100%;\r\n  background: white;\r\n}\r\n\r\n.login-header {\r\n  background: rgb(var(--v-theme-primary-lighten-5, 237, 245, 255));\r\n}\r\n\r\n:deep(.v-field) {\r\n  border-radius: 4px;\r\n}\r\n\r\n:deep(.v-list-item) {\r\n  min-height: 48px;\r\n}\r\n\r\n:deep(.v-btn) {\r\n  text-transform: none;\r\n  font-weight: 500;\r\n}\r\n\r\n:deep(.v-alert) {\r\n  border-left: 4px solid currentColor;\r\n}\r\n</style>"],"names":["validators","value","min","max","validateForm","data","rules","errors","field","fieldRules","rule","validatorName","params","router","useRouter","route","useRoute","authStore","useAuthStore","form","ref","showPassword","loading","error","reactive","appTitle","formData","v","formIsValid","computed","clearError","handleLogin","validationErrors","logger","redirectPath","err"],"mappings":"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"}